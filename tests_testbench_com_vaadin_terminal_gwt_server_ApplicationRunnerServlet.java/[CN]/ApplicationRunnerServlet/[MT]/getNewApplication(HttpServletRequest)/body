{
  try {
    final Class<?> classToRun=getClassToRun();
    if (Root.class.isAssignableFrom(classToRun)) {
      return new RootRunnerApplication(classToRun);
    }
 else     if (Application.class.isAssignableFrom(classToRun)) {
      return (Application)classToRun.newInstance();
    }
 else {
      throw new ServletException(classToRun.getCanonicalName() + " is neither an Application nor a Root");
    }
  }
 catch (  final IllegalAccessException e) {
    throw new ServletException(e);
  }
catch (  final InstantiationException e) {
    throw new ServletException(e);
  }
catch (  final ClassNotFoundException e) {
    throw new ServletException(new InstantiationException("Failed to load application class: " + getApplicationRunnerApplicationClassName(request)));
  }
}

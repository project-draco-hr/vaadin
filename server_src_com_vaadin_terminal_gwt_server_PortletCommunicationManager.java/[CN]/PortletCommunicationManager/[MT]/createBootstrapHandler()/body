{
  return new BootstrapHandler(){
    @Override public boolean handleRequest(    Application application,    WrappedRequest request,    WrappedResponse response) throws IOException {
      PortletRequest portletRequest=WrappedPortletRequest.cast(request).getPortletRequest();
      if (portletRequest instanceof RenderRequest) {
        return super.handleRequest(application,request,response);
      }
 else {
        return false;
      }
    }
    @Override protected String getApplicationId(    BootstrapContext context){
      PortletRequest portletRequest=WrappedPortletRequest.cast(context.getRequest()).getPortletRequest();
      return "v-" + portletRequest.getWindowID();
    }
    @Override protected String getAppUri(    BootstrapContext context){
      return getRenderResponse(context).createActionURL().toString();
    }
    private RenderResponse getRenderResponse(    BootstrapContext context){
      PortletResponse response=((WrappedPortletResponse)context.getResponse()).getPortletResponse();
      RenderResponse renderResponse=(RenderResponse)response;
      return renderResponse;
    }
    @Override protected JSONObject getDefaultParameters(    BootstrapContext context) throws JSONException {
      JSONObject defaults=super.getDefaultParameters(context);
      ResourceURL portletResourceUrl=getRenderResponse(context).createResourceURL();
      portletResourceUrl.setResourceID(AbstractApplicationPortlet.RESOURCE_URL_ID);
      defaults.put(ApplicationConfiguration.PORTLET_RESOUCE_URL_BASE,portletResourceUrl.toString());
      defaults.put("pathInfo","");
      return defaults;
    }
    @Override protected void appendMainScriptTagContents(    BootstrapContext context,    StringBuilder builder) throws JSONException, IOException {
      String portalTheme=WrappedPortletRequest.cast(context.getRequest()).getPortalProperty(AbstractApplicationPortlet.PORTAL_PARAMETER_VAADIN_THEME);
      if (portalTheme != null && !portalTheme.equals(context.getThemeName())) {
        String portalThemeUri=getThemeUri(context,portalTheme);
        builder.append("vaadin.loadTheme('" + portalThemeUri + "');");
      }
      super.appendMainScriptTagContents(context,builder);
    }
    @Override protected String getMainDivStyle(    BootstrapContext context){
      DeploymentConfiguration deploymentConfiguration=context.getRequest().getDeploymentConfiguration();
      return deploymentConfiguration.getApplicationOrSystemProperty(AbstractApplicationPortlet.PORTLET_PARAMETER_STYLE,null);
    }
    @Override protected String getInitialUIDL(    WrappedRequest request,    Root root) throws PaintException, JSONException {
      return PortletCommunicationManager.this.getInitialUIDL(request,root);
    }
    @Override protected JSONObject getApplicationParameters(    BootstrapContext context) throws JSONException, PaintException {
      JSONObject parameters=super.getApplicationParameters(context);
      WrappedPortletResponse wrappedPortletResponse=(WrappedPortletResponse)context.getResponse();
      MimeResponse portletResponse=(MimeResponse)wrappedPortletResponse.getPortletResponse();
      ResourceURL resourceURL=portletResponse.createResourceURL();
      resourceURL.setResourceID("browserDetails");
      parameters.put("browserDetailsUrl",resourceURL.toString());
      return parameters;
    }
  }
;
}

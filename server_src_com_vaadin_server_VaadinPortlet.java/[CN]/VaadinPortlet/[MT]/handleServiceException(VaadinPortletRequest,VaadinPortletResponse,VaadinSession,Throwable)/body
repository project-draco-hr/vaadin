{
  ErrorHandler errorHandler=ErrorEvent.findErrorHandler(vaadinSession);
  if (getRequestType(request) == RequestType.UIDL) {
    SystemMessages ci=getService().getSystemMessages(ServletPortletHelper.findLocale(null,vaadinSession,request),request);
    criticalNotification(request,response,ci.getInternalErrorCaption(),ci.getInternalErrorMessage(),null,ci.getInternalErrorURL());
    if (errorHandler != null) {
      errorHandler.error(new ErrorEvent(e));
    }
  }
 else {
    if (errorHandler != null) {
      errorHandler.error(new ErrorEvent(e));
    }
 else {
      throw new PortletException(e);
    }
  }
}

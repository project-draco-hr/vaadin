{
  Application newApplication=createApplication(request);
  try {
    ServletPortletHelper.checkUiProviders(newApplication);
  }
 catch (  ApplicationClassException e) {
    throw new PortletException(e);
  }
  final PortletApplicationContext2 context=getApplicationContext(request.getPortletSession());
  context.setApplication(newApplication,new PortletCommunicationManager(newApplication));
  return newApplication;
}

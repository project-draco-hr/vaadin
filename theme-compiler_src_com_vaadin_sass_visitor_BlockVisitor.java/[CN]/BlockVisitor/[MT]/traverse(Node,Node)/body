{
  Node after=node;
  Set<Node> toBeDeleted=new HashSet<Node>();
  for (int pos=0; pos < node.getChildren().size(); pos++) {
    Node child=node.getChildren().get(pos);
    traverse(node,child);
    if (child instanceof BlockNode && node instanceof BlockNode && parent != null) {
      combineParentSelectorListToChild(node,child);
      toBeDeleted.add(child);
      parent.appendChild(child,after);
      after=child;
    }
 else     if (child instanceof BlockNode && child.getChildren().size() == 0) {
      toBeDeleted.add(child);
    }
  }
  for (  Node child : toBeDeleted) {
    node.removeChild(child);
  }
}

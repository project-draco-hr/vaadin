{
  super.paintContent(target);
  if (minDate != null) {
    target.addAttribute("min",String.valueOf(minDate.getTime()));
  }
  if (maxDate != null) {
    target.addAttribute("max",String.valueOf(maxDate.getTime()));
  }
  if (dataSource != null) {
    target.startTag("items");
    int month=new Date().getMonth();
    final Object value=getValue();
    if (value != null && value instanceof Date) {
      month=((Date)value).getMonth();
    }
    for (final Iterator it=dataSource.getItemIds().iterator(); it.hasNext(); ) {
      final Object itemId=it.next();
      final Item item=dataSource.getItem(itemId);
      Property p=item.getItemProperty(itemStartPropertyId);
      Date start=(Date)p.getValue();
      Date end=start;
      if (itemEndPropertyId != null) {
        p=item.getItemProperty(itemEndPropertyId);
        end=(Date)p.getValue();
        if (end == null) {
          end=start;
        }
 else         if (end.before(start)) {
          final Date tmp=start;
          start=end;
          end=tmp;
        }
      }
      if (start != null) {
        if ((start.getMonth() <= month || end.getMonth() >= month)) {
          target.startTag("item");
          target.addAttribute("id",itemId.hashCode());
          if (itemStyleNamePropertyId != null) {
            p=item.getItemProperty(itemStyleNamePropertyId);
            final String styleName=(String)p.getValue();
            target.addAttribute("styleName",styleName);
          }
          SimpleDateFormat sdf=new SimpleDateFormat("d MMM yyyy HH:mm:ss Z");
          target.addAttribute("Z",start.getTimezoneOffset());
          target.addAttribute("start","" + sdf.format(start));
          if (end != start) {
            target.addAttribute("end","" + sdf.format(end));
          }
          if (itemTitlePropertyId != null) {
            p=item.getItemProperty(itemTitlePropertyId);
            final Object val=p.getValue();
            if (val != null) {
              target.addAttribute("title",val.toString());
            }
          }
          if (itemDescriptionPropertyId != null) {
            p=item.getItemProperty(itemDescriptionPropertyId);
            final Object val=p.getValue();
            if (val != null) {
              target.addAttribute("description",val.toString());
            }
          }
          if (itemNotimePropertyId != null) {
            p=item.getItemProperty(itemNotimePropertyId);
            final Object val=p.getValue();
            if (val != null) {
              target.addAttribute("notime",((Boolean)val).booleanValue());
            }
          }
          target.endTag("item");
        }
      }
    }
    target.endTag("items");
  }
}

{
  Application application=context.getApplication();
  int rootId=context.getRootId();
  JSONObject appConfig=new JSONObject();
  appConfig.put(ApplicationConnection.ROOT_ID_PARAMETER,rootId);
  if (context.getThemeName() != null) {
    appConfig.put("themeUri",getThemeUri(context,context.getThemeName()));
  }
  JSONObject versionInfo=new JSONObject();
  versionInfo.put("vaadinVersion",AbstractApplicationServlet.VERSION);
  versionInfo.put("applicationVersion",application.getVersion());
  appConfig.put("versionInfo",versionInfo);
  appConfig.put("widgetset",context.getWidgetsetName());
  if (application.isRootInitPending(rootId)) {
    appConfig.put("initPending",true);
  }
 else {
    AbstractCommunicationManager manager=getCommunicationManager();
    Root root=Root.getCurrentRoot();
    manager.makeAllPaintablesDirty(root);
    StringWriter sWriter=new StringWriter();
    PrintWriter pWriter=new PrintWriter(sWriter);
    pWriter.print("{");
    if (manager.isXSRFEnabled(application)) {
      pWriter.print(manager.getSecurityKeyUIDL(context.getRequest()));
    }
    manager.writeUidlResponce(null,true,pWriter,root,false);
    pWriter.print("}");
    appConfig.put("uidl",sWriter.toString());
  }
  return appConfig;
}

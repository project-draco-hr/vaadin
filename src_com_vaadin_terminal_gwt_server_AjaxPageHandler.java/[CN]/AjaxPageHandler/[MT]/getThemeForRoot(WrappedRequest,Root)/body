{
  if (root == null) {
    return null;
  }
  String themeName;
  if (request.getParameter(AbstractApplicationServlet.URL_PARAMETER_THEME) != null) {
    themeName=request.getParameter(AbstractApplicationServlet.URL_PARAMETER_THEME);
  }
 else {
    themeName=root.getApplication().getThemeForRoot(root);
  }
  if (themeName == null) {
    themeName=AbstractApplicationServlet.getDefaultTheme();
  }
  themeName=AbstractApplicationServlet.stripSpecialChars(themeName);
  return themeName;
}

{
  String staticFileLocation=request.getStaticFileLocation();
  String widgetsetBase=staticFileLocation + "/" + AbstractApplicationServlet.WIDGETSET_DIRECTORY_PATH;
  Application.SystemMessages systemMessages=AbstractApplicationServlet.getSystemMessages(application.getClass());
  page.write("<script type=\"text/javascript\" src=\"");
  page.write(staticFileLocation);
  page.write("/VAADIN/vaadinBootstrap.js\"></script>\n");
  page.write("<script type=\"text/javascript\">\n");
  page.write("//<![CDATA[\n");
  JSONObject defaults=new JSONObject();
  JSONObject appConfig=new JSONObject();
  boolean isDebug=!application.isProductionMode();
  if (isDebug) {
    defaults.put("debug",true);
  }
  page.write("document.write('<iframe tabIndex=\"-1\" id=\"__gwt_historyFrame\" " + "style=\"position:absolute;width:0;height:0;border:0;overflow:" + "hidden;\" src=\"javascript:false\"></iframe>');\n");
  defaults.put("appUri",appUrl);
  appConfig.put(ApplicationConnection.ROOT_ID_PARAMETER,rootId);
  if (isStandalone()) {
    defaults.put("standalone",true);
  }
  appConfig.put("themeUri",themeUri);
  JSONObject versionInfo=new JSONObject();
  versionInfo.put("vaadinVersion",AbstractApplicationServlet.VERSION);
  versionInfo.put("applicationVersion",application.getVersion());
  appConfig.put("versionInfo",versionInfo);
  if (systemMessages != null) {
    JSONObject comErrMsg=new JSONObject();
    comErrMsg.put("caption",systemMessages.getCommunicationErrorCaption());
    comErrMsg.put("message",systemMessages.getCommunicationErrorMessage());
    comErrMsg.put("url",systemMessages.getCommunicationErrorURL());
    defaults.put("comErrMsg",comErrMsg);
    JSONObject authErrMsg=new JSONObject();
    authErrMsg.put("caption",systemMessages.getAuthenticationErrorCaption());
    authErrMsg.put("message",systemMessages.getAuthenticationErrorMessage());
    authErrMsg.put("url",systemMessages.getAuthenticationErrorURL());
    defaults.put("authErrMsg",authErrMsg);
  }
  defaults.put("widgetsetBase",widgetsetBase);
  appConfig.put("widgetset",widgetset);
  if (application.isRootInitPending(rootId)) {
    appConfig.put("initPending",true);
  }
  page.write("vaadin.setDefaults(");
  if (isDebug) {
    page.write(defaults.toString(4));
  }
 else {
    page.write(defaults.toString());
  }
  page.write(");\n");
  page.write("vaadin.initApplication(\"");
  page.write(appId);
  page.write("\",");
  if (isDebug) {
    page.write(appConfig.toString(4));
  }
 else {
    page.write(appConfig.toString());
  }
  page.write(");\n");
  page.write("//]]>\n</script>\n");
}

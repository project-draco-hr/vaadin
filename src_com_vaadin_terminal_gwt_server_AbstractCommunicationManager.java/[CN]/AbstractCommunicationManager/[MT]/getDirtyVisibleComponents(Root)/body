{
  final ArrayList<Paintable> resultset=new ArrayList<Paintable>(dirtyPaintables);
  for (final Iterator<Paintable> i=dirtyPaintables.iterator(); i.hasNext(); ) {
    final Paintable p=i.next();
    if (p instanceof Component) {
      final Component component=(Component)p;
      if (component.getApplication() == null) {
        resultset.remove(p);
        i.remove();
      }
 else {
        Root componentsRoot=component.getRoot();
        if (componentsRoot == null) {
          throw new IllegalStateException("component.getWindow() returned null for a component attached to the application");
        }
        if (componentsRoot != r) {
          resultset.remove(p);
        }
 else         if (component.getParent() != null && !component.getParent().isVisible()) {
          resultset.remove(p);
        }
      }
    }
  }
  return resultset;
}

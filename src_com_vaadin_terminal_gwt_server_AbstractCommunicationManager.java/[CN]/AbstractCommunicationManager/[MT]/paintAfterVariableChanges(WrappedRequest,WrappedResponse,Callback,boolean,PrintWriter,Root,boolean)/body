{
  if (repaintAll) {
    makeAllPaintablesDirty(root);
  }
  if (!application.isRunning()) {
    endApplication(request,response,application);
    return;
  }
  openJsonMessage(outWriter,response);
  Object writeSecurityTokenFlag=request.getAttribute(WRITE_SECURITY_TOKEN_FLAG);
  if (writeSecurityTokenFlag != null) {
    outWriter.print(getSecurityKeyUIDL(request));
  }
  writeUidlResponce(callback,repaintAll,outWriter,root,analyzeLayouts);
  closeJsonMessage(outWriter);
  outWriter.close();
}

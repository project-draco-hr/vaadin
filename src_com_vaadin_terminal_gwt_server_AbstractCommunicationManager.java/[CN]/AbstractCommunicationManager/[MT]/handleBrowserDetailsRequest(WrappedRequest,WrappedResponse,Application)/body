{
  boolean sendUIDL=Root.getCurrentRoot() == null;
  CombinedRequest combinedRequest=application.getCombinedRequest(request);
  try {
    Root root=application.getRootForRequest(combinedRequest);
    response.setContentType("application/json; charset=UTF-8");
    BootstrapHandler bootstrapHandler=getBootstrapHandler();
    BootstrapContext context=bootstrapHandler.createContext(combinedRequest,response,application,root.getRootId());
    String widgetset=context.getWidgetsetName();
    String theme=context.getThemeName();
    String themeUri=bootstrapHandler.getThemeUri(context,theme);
    JSONObject params=new JSONObject();
    params.put("widgetset",widgetset);
    params.put("themeUri",themeUri);
    params.put(ApplicationConnection.ROOT_ID_PARAMETER,root.getRootId());
    if (sendUIDL) {
      String initialUIDL=getInitialUIDL(combinedRequest,root);
      params.put("uidl",initialUIDL);
    }
    response.getWriter().write(params.toString());
  }
 catch (  RootRequiresMoreInformationException e) {
    throw new RuntimeException(e);
  }
catch (  JSONException e) {
    e.printStackTrace();
  }
}

{
  String pathInfo=request.getRequestPathInfo();
  int startOfData=pathInfo.indexOf(ServletPortletHelper.UPLOAD_URL_PREFIX) + ServletPortletHelper.UPLOAD_URL_PREFIX.length();
  String uppUri=pathInfo.substring(startOfData);
  String[] parts=uppUri.split("/",4);
  String rootId=parts[0];
  String connectorId=parts[1];
  String variableName=parts[2];
  Root root=application.getRootById(Integer.parseInt(rootId));
  Root.setCurrent(root);
  StreamVariable streamVariable=getStreamVariable(connectorId,variableName);
  String secKey=streamVariableToSeckey.get(streamVariable);
  if (secKey.equals(parts[3])) {
    ClientConnector source=getConnector(root,connectorId);
    String contentType=request.getContentType();
    if (contentType.contains("boundary")) {
      doHandleSimpleMultipartFileUpload(request,response,streamVariable,variableName,source,contentType.split("boundary=")[1]);
    }
 else {
      doHandleXhrFilePost(request,response,streamVariable,variableName,source,request.getContentLength());
    }
  }
 else {
    throw new InvalidUIDLSecurityKeyException("Security key in upload post did not match!");
  }
}

{
  final String[] ka=(String[])variables.get("selected");
  final String[] ranges=(String[])variables.get("selectedRanges");
  final LinkedList s=new LinkedList();
  for (int i=0; i < ka.length; i++) {
    final Object id=itemIdMapper.get(ka[i]);
    if (!isNullSelectionAllowed() && (id == null || id == getNullSelectionItemId())) {
      requestRepaint();
    }
 else     if (id != null && containsId(id)) {
      s.add(id);
    }
  }
  if (!isNullSelectionAllowed() && s.size() < 1) {
    requestRepaint();
    return;
  }
  for (  String range : ranges) {
    String[] limits=range.split("-");
    int start=Integer.valueOf(limits[0]);
    int end=Integer.valueOf(limits[1]);
    s.addAll(getItemIdsInRange(start,end));
  }
  setValue(s,true);
}

{
  if (window == null) {
    return;
  }
  if (window.getParent() != null) {
    throw new IllegalArgumentException("Window was already added inside another window" + " - it can not be added to application also.");
  }
  String name=window.getName();
  if (name != null && windows.containsKey(name)) {
    if (window == windows.get(name)) {
      return;
    }
    throw new IllegalArgumentException("Window with name '" + window.getName() + "' is already present in the application");
  }
  if (name == null) {
    boolean accepted=false;
    while (!accepted) {
synchronized (this) {
        name=String.valueOf(nextWindowId);
        nextWindowId++;
      }
      if (!windows.containsKey(name)) {
        accepted=true;
      }
    }
    window.setName(name);
  }
  windows.put(name,window);
  window.setApplication(this);
  fireWindowAttachEvent(window);
  if (getMainWindow() == null) {
    mainWindow=window;
  }
}

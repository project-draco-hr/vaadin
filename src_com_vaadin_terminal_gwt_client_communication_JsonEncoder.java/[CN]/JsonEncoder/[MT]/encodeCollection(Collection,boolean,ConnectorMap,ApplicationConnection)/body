{
  JSONArray jsonArray=new JSONArray();
  int idx=0;
  for (  Object o : collection) {
    JSONValue encodedObject=encode(o,restrictToInternalTypes,connectorMap,connection);
    jsonArray.set(idx++,encodedObject);
  }
  if (collection instanceof Set) {
    return combineTypeAndValue(VTYPE_SET,jsonArray);
  }
 else   if (collection instanceof List) {
    return combineTypeAndValue(VTYPE_LIST,jsonArray);
  }
 else {
    throw new RuntimeException("Unsupport collection type: " + collection.getClass().getName());
  }
}

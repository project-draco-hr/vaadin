{
  JSONObject jsonMap=new JSONObject();
  for (  Entry<?,?> entry : map.entrySet()) {
    String key=(String)entry.getKey();
    Object value=entry.getValue();
    if (restrictToInternalTypes) {
      value=new UidlValue(value);
    }
    JSONValue encodedValue=encode(value,restrictToInternalTypes,connectorMap,connection);
    jsonMap.put(key,encodedValue);
  }
  return jsonMap;
}

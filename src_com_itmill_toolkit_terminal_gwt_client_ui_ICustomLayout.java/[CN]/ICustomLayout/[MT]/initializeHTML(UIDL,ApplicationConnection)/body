{
  final String newTemplateContents=uidl.getStringAttribute("templateContents");
  final String newTemplate=uidl.getStringAttribute("template");
  currentTemplateName=null;
  hasTemplateContents=false;
  String template="";
  if (newTemplate != null) {
    template=client.getResource("layouts/" + newTemplate + ".html");
    if (template == null) {
      template="<em>Layout file layouts/" + newTemplate + ".html is missing. Components will be drawn for debug purposes.</em>";
    }
 else {
      currentTemplateName=newTemplate;
    }
  }
 else {
    hasTemplateContents=true;
    template=newTemplateContents;
  }
  template=extractBodyAndScriptsFromTemplate(template);
  String themeUri=client.getThemeUri();
  String relImgPrefix=themeUri + "/layouts/";
  template=template.replaceAll("<((?:img)|(?:IMG)) ([^>]*)src=\"((?![a-z]+:)[^/][^\"]+)\"","<$1 $2src=\"" + relImgPrefix + "$3\"");
  template=template.replaceAll("<((?:img)|(?:IMG)) ([^>]*)src=[^\"]((?![a-z]+:)[^/][^ />]+)[ />]","<$1 $2src=\"" + relImgPrefix + "$3\"");
  getElement().setInnerHTML(template);
  locationToElement.clear();
  scanForLocations(getElement());
  initImgElements();
  elementWithNativeResizeFunction=DOM.getFirstChild(getElement());
  if (elementWithNativeResizeFunction == null) {
    elementWithNativeResizeFunction=getElement();
  }
  publishResizedFunction(elementWithNativeResizeFunction);
}

{
  boolean firstRender=true;
  if (hourPanel == null) {
    hourPanel=new SimplePanel();
    hourPanel.setStyleName(CLASSNAME + "-hours");
    calPanel.getFlexCellFormatter().setColSpan(8,0,7);
    calPanel.setWidget(8,0,hourPanel);
  }
 else {
    firstRender=false;
    hourPanel.clear();
  }
  hourTable=new FlexTable();
  hourTable.addTableListener(ftListener);
  hourPanel.add(hourTable);
  hourTable.setCellSpacing(1);
  for (int i=0; i < 24; i++) {
    String style=(i % 2 == 0 ? "even" : "odd");
    if (realResolution >= RESOLUTION_HOUR) {
      if (this.date != null && this.date.getHours() == i) {
        style="selected";
      }
    }
    hourTable.getRowFormatter().setStyleName(i,CLASSNAME + "-row-" + style);
    String hstr=(i < 10 ? "0" : "") + i + ":00";
    if (dts.isTwelveHourClock()) {
      final String ampm=(i < 12 ? "am" : "pm");
      hstr=(i <= 12 ? i : i - 12) + ":00 " + ampm;
    }
    hourTable.setHTML(i,0,"<span>" + hstr + "</span>");
    hourTable.getCellFormatter().setStyleName(i,0,CLASSNAME + "-time");
  }
  final List entries=entrySource.getEntries(date,DateTimeService.RESOLUTION_DAY);
  int currentCol=1;
  for (final Iterator it=entries.iterator(); it.hasNext(); ) {
    final CalendarEntry entry=(CalendarEntry)it.next();
    int start=0;
    int hours=24;
    if (!entry.isNotime()) {
      Date d=entry.getStart();
      start=(d.getDate() < date.getDate() ? 0 : d.getHours());
      d=entry.getEnd();
      hours=(d.getDate() > date.getDate() ? 24 : d.getHours()) - start;
      if (hours == 0) {
        hours=1;
      }
    }
    int col=currentCol;
    if (col > 1) {
      while (!hourTable.isCellPresent(start,col - 1)) {
        col--;
      }
    }
    hourTable.setHTML(start,col,"<span>" + (entry.getTitle() != null ? entry.getTitle() : "&nbsp") + "</span>");
    hourTable.getFlexCellFormatter().setRowSpan(start,col,hours);
    hourTable.getFlexCellFormatter().setStyleName(start,col,CLASSNAME + "-entry");
    final String sn=entry.getStyleName();
    if (sn != null && !sn.equals("")) {
      hourTable.getFlexCellFormatter().addStyleName(start,col,CLASSNAME + "-" + entry.getStyleName());
    }
    final Element el=hourTable.getFlexCellFormatter().getElement(start,col);
    String tooltip;
    if (DateTimeService.isSameDay(entry.getStart(),entry.getEnd())) {
      tooltip=(start < 10 ? "0" : "") + start + ":00";
      if (dts.isTwelveHourClock()) {
        final String ampm=(start < 12 ? "am" : "pm");
        tooltip=(start <= 12 ? start : start - 12) + ":00 " + ampm;
      }
      tooltip+=" (" + hours + "h) ";
      if (entry.getTitle() != null) {
        tooltip+=entry.getTitle() + "\n ";
      }
    }
 else {
      tooltip=entry.getStringForDate(entry.getEnd()) + "\n ";
    }
    if (entry.getDescription() != null) {
      tooltip+="\"" + entry.getDescription() + "\"";
    }
    DOM.setElementProperty(el,"title",tooltip);
    currentCol++;
  }
  final int hour=this.date.getHours() + 1;
  final int h1=hourPanel.getOffsetHeight() / 2;
  final int oh=hourTable.getOffsetHeight();
  final int h2=(int)(hour / 24.0 * oh);
  final int scrollTop=h2 - h1;
  final Element el=hourPanel.getElement();
  setScrollTop(el,scrollTop);
}

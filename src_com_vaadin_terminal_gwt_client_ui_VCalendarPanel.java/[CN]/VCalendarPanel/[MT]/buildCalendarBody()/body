{
  setWidget(1,0,days);
  setCellPadding(0);
  setCellSpacing(0);
  getFlexCellFormatter().setColSpan(1,0,5);
  getFlexCellFormatter().setStyleName(1,0,VDateField.CLASSNAME + "-calendarpanel-body");
  days.getFlexCellFormatter().setStyleName(0,0,"v-first");
  days.getFlexCellFormatter().setStyleName(0,6,"v-last");
  days.getRowFormatter().setStyleName(0,VDateField.CLASSNAME + "-calendarpanel-weekdays");
  final int firstDay=datefield.getDateTimeService().getFirstDayOfWeek();
  for (int i=0; i < 7; i++) {
    int day=i + firstDay;
    if (day > 6) {
      day=0;
    }
    if (datefield.getCurrentResolution() > VDateField.RESOLUTION_MONTH) {
      days.setHTML(0,i,"<strong>" + datefield.getDateTimeService().getShortDay(day) + "</strong>");
    }
 else {
      days.setHTML(0,i,"");
    }
  }
  Date currentDate=datefield.getCurrentDate();
  Date showing=datefield.getShowingDate();
  boolean selected=(currentDate != null && currentDate.getMonth() == showing.getMonth() && currentDate.getYear() == showing.getYear());
  final int startWeekDay=datefield.getDateTimeService().getStartWeekDay(datefield.getShowingDate());
  final int numDays=DateTimeService.getNumberOfDaysInMonth(datefield.getShowingDate());
  int dayCount=0;
  final Date today=new Date();
  final Date curr=new Date(datefield.getShowingDate().getTime());
  for (int row=1; row < 7; row++) {
    for (int col=0; col < 7; col++) {
      if (!(row == 1 && col < startWeekDay)) {
        if (dayCount < numDays) {
          final int selectedDate=++dayCount;
          String title="";
          if (entrySource != null) {
            curr.setDate(dayCount);
            final List entries=entrySource.getEntries(curr,VDateField.RESOLUTION_DAY);
            if (entries != null) {
              for (final Iterator it=entries.iterator(); it.hasNext(); ) {
                final CalendarEntry entry=(CalendarEntry)it.next();
                title+=(title.length() > 0 ? ", " : "") + entry.getStringForDate(curr);
              }
            }
          }
          final String baseclass=VDateField.CLASSNAME + "-calendarpanel-day";
          String cssClass=baseclass;
          if (!isEnabledDate(curr)) {
            cssClass+=" " + baseclass + "-disabled";
          }
          if (selected && datefield.getShowingDate().getDate() == dayCount) {
            cssClass+=" " + baseclass + "-selected";
          }
          if (today.getDate() == dayCount && today.getMonth() == datefield.getShowingDate().getMonth() && today.getYear() == datefield.getShowingDate().getYear()) {
            cssClass+=" " + baseclass + "-today";
          }
          if (title.length() > 0) {
            cssClass+=" " + baseclass + "-entry";
          }
          days.setHTML(row,col,"<span title=\"" + title + "\" class=\""+ cssClass+ "\">"+ selectedDate+ "</span>");
        }
 else {
          break;
        }
      }
    }
  }
}

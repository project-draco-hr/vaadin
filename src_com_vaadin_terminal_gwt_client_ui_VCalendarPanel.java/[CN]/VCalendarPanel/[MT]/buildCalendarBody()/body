{
  Date currentDate=datefield.getCurrentDate();
  Date showing=datefield.getShowingDate();
  boolean selected=(currentDate != null && currentDate.getMonth() == showing.getMonth() && currentDate.getYear() == showing.getYear());
  final int startWeekDay=datefield.getDateTimeService().getStartWeekDay(datefield.getShowingDate());
  final int numDays=DateTimeService.getNumberOfDaysInMonth(datefield.getShowingDate());
  int dayCount=0;
  final Date today=new Date();
  final Date curr=new Date(datefield.getShowingDate().getTime());
  for (int row=2; row < 8; row++) {
    for (int col=0; col < 7; col++) {
      if (!(row == 2 && col < startWeekDay)) {
        if (dayCount < numDays) {
          final int selectedDate=++dayCount;
          String title="";
          if (entrySource != null) {
            curr.setDate(dayCount);
            final List entries=entrySource.getEntries(curr,VDateField.RESOLUTION_DAY);
            if (entries != null) {
              for (final Iterator it=entries.iterator(); it.hasNext(); ) {
                final CalendarEntry entry=(CalendarEntry)it.next();
                title+=(title.length() > 0 ? ", " : "") + entry.getStringForDate(curr);
              }
            }
          }
          final String baseclass=VDateField.CLASSNAME + "-calendarpanel-day";
          String cssClass=baseclass;
          if (!isEnabledDate(curr)) {
            cssClass+=" " + baseclass + "-disabled";
          }
          if (selected && datefield.getShowingDate().getDate() == dayCount) {
            cssClass+=" " + baseclass + "-selected";
          }
          if (today.getDate() == dayCount && today.getMonth() == datefield.getShowingDate().getMonth() && today.getYear() == datefield.getShowingDate().getYear()) {
            cssClass+=" " + baseclass + "-today";
          }
          if (title.length() > 0) {
            cssClass+=" " + baseclass + "-entry";
          }
          setHTML(row,col,"<span title=\"" + title + "\" class=\""+ cssClass+ "\">"+ selectedDate+ "</span>");
        }
 else {
          break;
        }
      }
    }
  }
}

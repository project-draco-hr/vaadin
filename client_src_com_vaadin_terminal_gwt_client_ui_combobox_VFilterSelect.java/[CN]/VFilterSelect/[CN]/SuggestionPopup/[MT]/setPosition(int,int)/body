{
  int top=-1;
  int left=-1;
  menu.setHeight("");
  if (currentPage > 0) {
    menu.fixHeightTo(pageLength);
  }
  offsetHeight=getOffsetHeight();
  final int desiredWidth=getMainWidth();
  int naturalMenuWidth=DOM.getElementPropertyInt(DOM.getFirstChild(menu.getElement()),"offsetWidth");
  if (popupOuterPadding == -1) {
    popupOuterPadding=Util.measureHorizontalPaddingAndBorder(getElement(),2);
  }
  if (naturalMenuWidth < desiredWidth) {
    menu.setWidth((desiredWidth - popupOuterPadding) + "px");
    DOM.setStyleAttribute(DOM.getFirstChild(menu.getElement()),"width","100%");
    naturalMenuWidth=desiredWidth;
  }
  if (BrowserInfo.get().isIE()) {
    int rootWidth=naturalMenuWidth - popupOuterPadding;
    DOM.setStyleAttribute(getContainerElement(),"width",rootWidth + "px");
  }
  if (offsetHeight + getPopupTop() > Window.getClientHeight() + Window.getScrollTop()) {
    top=getPopupTop() - offsetHeight - VFilterSelect.this.getOffsetHeight();
    if (top < 0) {
      top=0;
    }
  }
 else {
    top=getPopupTop();
    int topMargin=(top - topPosition);
    top-=topMargin;
  }
  offsetWidth=DOM.getElementPropertyInt(DOM.getFirstChild(menu.getElement()),"offsetWidth");
  if (offsetWidth + getPopupLeft() > Window.getClientWidth() + Window.getScrollLeft()) {
    left=VFilterSelect.this.getAbsoluteLeft() + VFilterSelect.this.getOffsetWidth() + Window.getScrollLeft() - offsetWidth;
    if (left < 0) {
      left=0;
    }
  }
 else {
    left=getPopupLeft();
  }
  setPopupPosition(left,top);
}

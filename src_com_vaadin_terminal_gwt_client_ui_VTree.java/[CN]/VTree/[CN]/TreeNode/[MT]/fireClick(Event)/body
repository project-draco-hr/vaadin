{
  if (!treeHasFocus) {
    focus();
  }
  final MouseEventDetails details=new MouseEventDetails(evt);
  ScheduledCommand command=new ScheduledCommand(){
    public void execute(){
      boolean imm=!immediate || !selectable || (!isNullSelectionAllowed && isSelected() && selectedIds.size() == 1);
      client.updateVariable(paintableId,"clickedKey",key,false);
      client.updateVariable(paintableId,"clickEvent",details.toString(),imm);
    }
  }
;
  if (treeHasFocus) {
    command.execute();
  }
 else {
    Scheduler.get().scheduleDeferred(command);
  }
}

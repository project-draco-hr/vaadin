{
  super.onBrowserEvent(event);
  if (disabled) {
    return;
  }
  final int type=DOM.eventGetType(event);
  final Element target=DOM.eventGetTarget(event);
  if (client.hasEventListeners(VTree.this,ITEM_CLICK_EVENT_ID) && target == nodeCaptionSpan && (type == Event.ONDBLCLICK || type == Event.ONMOUSEUP)) {
    fireClick(event);
  }
  if (type == Event.ONCLICK) {
    if (getElement() == target || ie6compatnode == target) {
      toggleState();
    }
 else     if (!readonly && target == nodeCaptionSpan) {
      toggleSelection();
    }
    DOM.eventCancelBubble(event,true);
  }
 else   if (type == Event.ONCONTEXTMENU) {
    showContextMenu(event);
  }
  if (dragMode != 0 || dropHandler != null) {
    if (type == Event.ONMOUSEDOWN) {
      if (nodeCaptionDiv.isOrHasChild(event.getTarget())) {
        if (dragMode > 0) {
          ApplicationConnection.getConsole().log("TreeNode m down");
          event.preventDefault();
          mouseDownEvent=event;
        }
      }
    }
 else     if (type == Event.ONMOUSEMOVE || type == Event.ONMOUSEOUT) {
      if (mouseDownEvent != null) {
        ApplicationConnection.getConsole().log("TreeNode drag start " + event.getType());
        VTransferable t=new VTransferable();
        t.setDragSource(VTree.this);
        t.setData("itemId",key);
        VDragEvent drag=VDragAndDropManager.get().startDrag(t,mouseDownEvent,true);
        drag.createDragImage(nodeCaptionDiv,true);
        event.stopPropagation();
        mouseDownEvent=null;
      }
    }
 else     if (type == Event.ONMOUSEUP) {
      mouseDownEvent=null;
    }
    if (type == Event.ONMOUSEOVER) {
      mouseDownEvent=null;
      currentMouseOverKey=key;
      event.stopPropagation();
    }
  }
}

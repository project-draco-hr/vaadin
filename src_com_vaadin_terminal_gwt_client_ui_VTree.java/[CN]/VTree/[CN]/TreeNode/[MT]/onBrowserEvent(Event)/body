{
  super.onBrowserEvent(event);
  final int type=DOM.eventGetType(event);
  final Element target=DOM.eventGetTarget(event);
  if (type == Event.ONLOAD && target == icon.getElement()) {
    if (onloadHandled) {
      return;
    }
    if (BrowserInfo.get().isIE6()) {
      fixWidth();
    }
    iconLoaded.trigger();
    onloadHandled=true;
  }
  if (disabled) {
    return;
  }
  final boolean inCaption=target == nodeCaptionSpan || (icon != null && target == icon.getElement());
  if (inCaption && client.hasEventListeners(VTree.this,ITEM_CLICK_EVENT_ID) && (type == Event.ONDBLCLICK || type == Event.ONMOUSEUP)) {
    fireClick(event);
  }
  if (type == Event.ONCLICK) {
    if (getElement() == target || ie6compatnode == target) {
      toggleState();
    }
 else     if (!readonly && inCaption && selectable) {
      if (handleClickSelection(event.getCtrlKey() || event.getMetaKey(),event.getShiftKey())) {
        event.preventDefault();
      }
    }
    event.stopPropagation();
  }
 else   if (type == Event.ONCONTEXTMENU) {
    showContextMenu(event);
  }
  if (dragMode != 0 || dropHandler != null) {
    if (type == Event.ONMOUSEDOWN) {
      if (nodeCaptionDiv.isOrHasChild(event.getTarget())) {
        if (dragMode > 0 && event.getButton() == NativeEvent.BUTTON_LEFT) {
          event.preventDefault();
          mouseDownEvent=event;
        }
      }
    }
 else     if (type == Event.ONMOUSEMOVE || type == Event.ONMOUSEOUT) {
      if (mouseDownEvent != null) {
        VTransferable t=new VTransferable();
        t.setDragSource(VTree.this);
        t.setData("itemId",key);
        VDragEvent drag=VDragAndDropManager.get().startDrag(t,mouseDownEvent,true);
        drag.createDragImage(nodeCaptionDiv,true);
        event.stopPropagation();
        mouseDownEvent=null;
      }
    }
 else     if (type == Event.ONMOUSEUP) {
      mouseDownEvent=null;
    }
    if (type == Event.ONMOUSEOVER) {
      mouseDownEvent=null;
      currentMouseOverKey=key;
      event.stopPropagation();
    }
  }
 else   if (type == Event.ONMOUSEDOWN && event.getButton() == NativeEvent.BUTTON_LEFT) {
    event.preventDefault();
  }
}

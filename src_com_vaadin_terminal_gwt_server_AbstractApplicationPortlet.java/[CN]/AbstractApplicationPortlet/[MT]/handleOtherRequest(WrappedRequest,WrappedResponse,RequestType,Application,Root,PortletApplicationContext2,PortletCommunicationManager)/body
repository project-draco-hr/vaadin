{
  if (root == null) {
    throw new PortletException(ERROR_NO_WINDOW_FOUND);
  }
  if (root.getTerminal() == null) {
    root.setTerminal(applicationContext.getBrowser());
  }
  if (requestType == RequestType.APPLICATION_RESOURCE) {
    if (!applicationManager.handleApplicationRequest(request,response)) {
      response.setStatus(404);
    }
  }
 else   if (requestType == RequestType.RENDER) {
    PortletRequest portletRequest=((WrappedPortletRequest)request).getPortletRequest();
    PortletResponse portletResponse=((WrappedPortletResponse)response).getPortletResponse();
    writeAjaxPage((RenderRequest)portletRequest,(RenderResponse)portletResponse,root,application);
  }
 else   if (requestType == RequestType.EVENT) {
  }
 else   if (requestType == RequestType.ACTION) {
  }
 else {
    throw new IllegalStateException("handleRequest() without anything to do - should never happen!");
  }
}

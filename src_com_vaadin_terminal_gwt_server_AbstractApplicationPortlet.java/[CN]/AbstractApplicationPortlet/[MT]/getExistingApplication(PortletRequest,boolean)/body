{
  final PortletSession session=request.getPortletSession(allowSessionCreation);
  if (session == null) {
    throw new SessionExpiredException();
  }
  PortletApplicationContext2 context=PortletApplicationContext2.getApplicationContext(session);
  Application application=context.getApplicationForWindowId(request.getWindowID());
  if (application == null) {
    return null;
  }
  if (application.isRunning()) {
    return application;
  }
  PortletApplicationContext2.getApplicationContext(session).removeApplication(application);
  return null;
}

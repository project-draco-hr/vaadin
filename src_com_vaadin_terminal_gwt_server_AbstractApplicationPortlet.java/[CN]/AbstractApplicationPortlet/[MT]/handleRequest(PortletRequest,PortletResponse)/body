{
  System.out.println("AbstractApplicationPortlet.handleRequest() " + System.currentTimeMillis());
  RequestType requestType=getRequestType(request);
  System.out.println("  RequestType: " + requestType);
  System.out.println("  WindowID: " + request.getWindowID());
  if (requestType == RequestType.UNKNOWN) {
    System.out.println("Unknown request type");
    return;
  }
 else   if (requestType == RequestType.STATIC_FILE) {
    serveStaticResources((ResourceRequest)request,(ResourceResponse)response);
    return;
  }
  Application application=null;
  try {
    application=findApplicationInstance(request,requestType);
    if (application == null) {
      return;
    }
    PortletApplicationContext2 applicationContext=PortletApplicationContext2.getApplicationContext(request.getPortletSession());
    CommunicationManager applicationManager=applicationContext.getApplicationManager(application);
    applicationContext.getBrowser().updateBrowserProperties(request);
    startApplication(request,application,applicationContext);
    applicationContext.startTransaction(application,request);
    if (requestType == RequestType.FILE_UPLOAD) {
      applicationManager.handleFileUpload((ActionRequest)request,(ActionResponse)response);
      return;
    }
 else     if (requestType == RequestType.UIDL) {
      applicationManager.handleUidlRequest((ResourceRequest)request,(ResourceResponse)response);
      return;
    }
 else     if (requestType == RequestType.RENDER) {
      if (!application.isRunning()) {
        endApplication(request,response,application);
        return;
      }
      Window window=application.getMainWindow();
      if (window == null) {
        throw new PortletException(ERROR_NO_WINDOW_FOUND);
      }
      if (window.getTerminal() == null) {
        window.setTerminal(applicationContext.getBrowser());
      }
      final Map<String,String[]> parameters=request.getParameterMap();
      if (window != null && parameters != null) {
        window.handleParameters(parameters);
      }
      writeAjaxPage((RenderRequest)request,(RenderResponse)response,window,application);
    }
  }
 catch (  final Throwable e) {
    e.printStackTrace();
  }
 finally {
    if (application != null) {
      ((PortletApplicationContext2)application.getContext()).endTransaction(application,request);
    }
  }
}

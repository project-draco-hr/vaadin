{
  response.setContentType("text/html");
  final BufferedWriter page=new BufferedWriter(new OutputStreamWriter(response.getPortletOutputStream(),"UTF-8"));
  String themeName=getThemeForRoot(request,root);
  writeAjaxPageHtmlVaadinScripts(request,response,page,application,themeName);
  String appClass="v-app-";
  try {
    appClass+=getApplicationClass().getSimpleName();
  }
 catch (  ClassNotFoundException e) {
    appClass+="unknown";
    logger.log(Level.SEVERE,"Could not find application class",e);
  }
  String themeClass="v-theme-" + themeName.replaceAll("[^a-zA-Z0-9]","");
  String classNames="v-app " + themeClass + " "+ appClass;
  String style=getApplicationProperty(PORTLET_PARAMETER_STYLE);
  String divStyle="";
  if (style != null) {
    divStyle="style=\"" + style + "\"";
  }
  writeAjaxPageHtmlMainDiv(request,response,page,getApplicationDomId(request),classNames,divStyle);
  page.close();
}

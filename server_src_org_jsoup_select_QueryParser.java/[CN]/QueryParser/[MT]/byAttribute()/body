{
  TokenQueue cq=new TokenQueue(tq.chompBalanced('[',']'));
  String key=cq.consumeToAny("=","!=","^=","$=","*=","~=");
  Validate.notEmpty(key);
  cq.consumeWhitespace();
  if (cq.isEmpty()) {
    if (key.startsWith("^")) {
      evals.add(new Evaluator.AttributeStarting(key.substring(1)));
    }
 else {
      evals.add(new Evaluator.Attribute(key));
    }
  }
 else {
    if (cq.matchChomp("=")) {
      evals.add(new Evaluator.AttributeWithValue(key,cq.remainder()));
    }
 else     if (cq.matchChomp("!=")) {
      evals.add(new Evaluator.AttributeWithValueNot(key,cq.remainder()));
    }
 else     if (cq.matchChomp("^=")) {
      evals.add(new Evaluator.AttributeWithValueStarting(key,cq.remainder()));
    }
 else     if (cq.matchChomp("$=")) {
      evals.add(new Evaluator.AttributeWithValueEnding(key,cq.remainder()));
    }
 else     if (cq.matchChomp("*=")) {
      evals.add(new Evaluator.AttributeWithValueContaining(key,cq.remainder()));
    }
 else     if (cq.matchChomp("~=")) {
      evals.add(new Evaluator.AttributeWithValueMatching(key,Pattern.compile(cq.remainder())));
    }
 else {
      throw new Selector.SelectorParseException("Could not parse attribute query '%s': unexpected token at '%s'",query,cq.remainder());
    }
  }
}

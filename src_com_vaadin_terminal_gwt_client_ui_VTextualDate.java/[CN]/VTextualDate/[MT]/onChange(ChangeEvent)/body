{
  if (!text.getText().equals("")) {
    try {
      DateTimeFormat format=DateTimeFormat.getFormat(getFormatString());
      if (lenient) {
        date=format.parse(text.getText());
        if (date != null) {
          text.setValue(DateTimeFormat.getFormat(getFormatString()).format(date),false);
        }
      }
 else {
        date=format.parseStrict(text.getText());
      }
      long stamp=date.getTime();
      if (stamp == 0) {
        date=null;
        addStyleName(PARSE_ERROR_CLASSNAME);
      }
 else {
        removeStyleName(PARSE_ERROR_CLASSNAME);
      }
    }
 catch (    final Exception e) {
      ClientExceptionHandler.displayError(e.getMessage());
      addStyleName(PARSE_ERROR_CLASSNAME);
      getClient().updateVariable(getId(),"lastInvalidDateString",text.getText(),false);
      date=null;
    }
  }
 else {
    date=null;
    removeStyleName(PARSE_ERROR_CLASSNAME);
  }
  getClient().updateVariable(getId(),"dateString",text.getText(),false);
  getClient().updateVariable(getId(),"year",date != null ? date.getYear() + 1900 : -1,currentResolution == VDateField.RESOLUTION_YEAR && immediate);
  if (currentResolution >= VDateField.RESOLUTION_MONTH) {
    getClient().updateVariable(getId(),"month",date != null ? date.getMonth() + 1 : -1,currentResolution == VDateField.RESOLUTION_MONTH && immediate);
  }
  if (currentResolution >= VDateField.RESOLUTION_DAY) {
    getClient().updateVariable(getId(),"day",date != null ? date.getDate() : -1,currentResolution == VDateField.RESOLUTION_DAY && immediate);
  }
  if (currentResolution >= VDateField.RESOLUTION_HOUR) {
    getClient().updateVariable(getId(),"hour",date != null ? date.getHours() : -1,currentResolution == VDateField.RESOLUTION_HOUR && immediate);
  }
  if (currentResolution >= VDateField.RESOLUTION_MIN) {
    getClient().updateVariable(getId(),"min",date != null ? date.getMinutes() : -1,currentResolution == VDateField.RESOLUTION_MIN && immediate);
  }
  if (currentResolution >= VDateField.RESOLUTION_SEC) {
    getClient().updateVariable(getId(),"sec",date != null ? date.getSeconds() : -1,currentResolution == VDateField.RESOLUTION_SEC && immediate);
  }
  if (currentResolution == VDateField.RESOLUTION_MSEC) {
    getClient().updateVariable(getId(),"msec",date != null ? getMilliseconds() : -1,immediate);
  }
}

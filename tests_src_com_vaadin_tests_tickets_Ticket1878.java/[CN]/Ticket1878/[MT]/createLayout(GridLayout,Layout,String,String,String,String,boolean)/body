{
  int dir;
  String type;
  if (newLayout instanceof VerticalLayout) {
    dir=OrderedLayout.ORIENTATION_VERTICAL;
    type="OL";
  }
 else   if (newLayout instanceof OrderedLayout) {
    dir=OrderedLayout.ORIENTATION_HORIZONTAL;
    type="OL";
  }
 else {
    dir=((GridLayout)newLayout).getColumns() == 1 ? OrderedLayout.ORIENTATION_VERTICAL : OrderedLayout.ORIENTATION_HORIZONTAL;
    type="GL";
  }
  String dirText=(dir == OrderedLayout.ORIENTATION_HORIZONTAL ? "H" : "V");
  String alignText=align ? "-A" : "";
  String cWidth=componentWidth == null ? "" : " - " + componentWidth;
  Panel p=new Panel(type + "/" + dirText+ alignText+ " "+ w+ "x"+ h+ cWidth,newLayout);
  p.setWidth(w);
  p.setHeight(h);
  newLayout.setSizeFull();
  String captions[]=new String[]{"TextField with caption",null};
  Resource icons[]=new Resource[]{new ThemeResource("icons/16/document-delete.png"),null};
  boolean required[]=new boolean[]{true,false};
  TextField fields[][]=new TextField[captions.length][icons.length];
  for (int caption=0; caption < captions.length; caption++) {
    for (int icon=0; icon < icons.length; icon++) {
      for (int req=0; req < required.length; req++) {
        TextField tf=createTextFieldWithError(captions[caption],icons[icon],required[req]);
        fields[caption][icon]=tf;
        if (componentWidth != null) {
          tf.setWidth(componentWidth);
          tf.setValue(tf.getValue() + " w:" + componentWidth);
        }
        if (componentHeight != null) {
          tf.setHeight(componentWidth);
          tf.setValue(tf.getValue() + " h:" + componentHeight);
        }
        p.addComponent(tf);
        if (align) {
          ((AlignmentHandler)newLayout).setComponentAlignment(tf,OrderedLayout.ALIGNMENT_RIGHT,OrderedLayout.ALIGNMENT_BOTTOM);
        }
      }
    }
  }
  parentLayout.addComponent(p);
}

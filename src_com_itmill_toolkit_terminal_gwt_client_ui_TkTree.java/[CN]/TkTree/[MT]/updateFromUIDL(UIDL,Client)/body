{
  this.client=client;
  id=uidl.getId();
  if (uidl.hasAttribute("caption"))   caption.setText(uidl.getStringAttribute("caption"));
  tree.clear();
  for (Iterator i=uidl.getChildIterator(); i.hasNext(); ) {
    UIDL childUidl=(UIDL)i.next();
    if (childUidl.getTag().equals("leaf"))     tree.addItem(childUidl.getStringAttribute("caption"));
    if (childUidl.getTag().equals("node")) {
      TreeNode childTree=new TreeNode();
      tree.addItem(childTree);
      childTree.updateFromUIDL(childUidl,client);
    }
  }
  String selectMode=uidl.getStringAttribute("selectmode");
  selectable=selectMode != null;
  multiselect="multi".equals(selectMode);
  tree.addTreeListener(new TreeListener(){
    public void onTreeItemStateChanged(    TreeItem item){
    }
    public void onTreeItemSelected(    TreeItem item){
      if (!selectable)       return;
      item.setSelected(true);
      String key=((TreeNode)item).key;
      if (key != null) {
        if (!multiselect)         selectedIds.clear();
        if (selectedIds.contains(key))         selectedIds.remove(key);
 else         selectedIds.add(key);
        TkTree.this.client.updateVariable(TkTree.this.id,"selected",selectedIds.toArray(),true);
      }
    }
  }
);
  selectedIds=uidl.getStringArrayVariableAsSet("selected");
}

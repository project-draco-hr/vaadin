{
  List<ComponentConnector> previousChildren=event.getOldChildren();
  int currentIndex=0;
  VAbstractOrderedLayout layout=getWidget();
  layout.setSpacing(getState().spacing);
  for (  ComponentConnector child : getChildComponents()) {
    Slot slot=layout.getSlot(child.getWidget());
    if (slot.getParent() != layout) {
      child.addStateChangeHandler(childStateChangeHandler);
    }
    layout.addOrMoveSlot(slot,currentIndex++);
  }
  for (  ComponentConnector child : previousChildren) {
    if (child.getParent() != this) {
      Slot slot=layout.getSlot(child.getWidget());
      hasVerticalAlignment.remove(child);
      hasRelativeHeight.remove(child);
      hasExpandRatio.remove(child);
      needsMeasure.remove(child.getWidget().getElement());
      childCaptionElementHeight.remove(child.getWidget().getElement());
      slot.setWidgetResizeListener(null);
      if (slot.hasCaption()) {
        slot.setCaptionResizeListener(null);
      }
      if (slot.getSpacingElement() != null) {
        slot.setSpacingResizeListener(null);
      }
      child.removeStateChangeHandler(childStateChangeHandler);
      layout.removeWidget(child.getWidget());
    }
  }
  if (needsExpand()) {
    getWidget().updateExpand();
  }
 else {
    getWidget().clearExpand();
  }
}

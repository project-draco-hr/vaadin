{
  int highestNonRelative=-1;
  int highestRelative=-1;
  LayoutManager layoutManager=getLayoutManager();
  for (  ComponentConnector child : getChildComponents()) {
    Slot slot=getWidget().getSlot(child.getWidget());
    Element captionElement=slot.getCaptionElement();
    CaptionPosition pos=slot.getCaptionPosition();
    Element childElement=child.getWidget().getElement();
    int h=layoutManager.getOuterHeight(childElement);
    if (h == -1) {
      return -1;
    }
    boolean hasRelativeHeight=slot.hasRelativeHeight();
    boolean includeCaptionHeight=captionElement != null && (pos == CaptionPosition.TOP || pos == CaptionPosition.BOTTOM);
    if (!hasRelativeHeight && !includeCaptionHeight && captionElement != null) {
      String sHeight=childElement.getStyle().getHeight();
      includeCaptionHeight=(sHeight == null || !sHeight.endsWith("%"));
    }
    if (includeCaptionHeight) {
      int captionHeight=layoutManager.getOuterHeight(captionElement) - getLayoutManager().getMarginHeight(captionElement);
      if (captionHeight == -1) {
        return -1;
      }
      h+=captionHeight;
    }
    if (!hasRelativeHeight) {
      if (h > highestNonRelative) {
        highestNonRelative=h;
      }
    }
 else {
      if (h > highestRelative) {
        highestRelative=h;
      }
    }
  }
  return highestNonRelative > -1 ? highestNonRelative : highestRelative;
}

{
  VaadinSession vaadinSession=findOrCreateVaadinSession(request);
  if (vaadinSession == null) {
    return null;
  }
  if (!vaadinSession.hasVaadinServiceData(this)) {
    vaadinSession.addVaadinServiceData(new VaadinServiceData(this));
    ServletPortletHelper.initDefaultUIProvider(vaadinSession,this);
    onVaadinSessionStarted(request,vaadinSession);
  }
  VaadinSession.setCurrent(vaadinSession);
  request.setAttribute(VaadinSession.class.getName(),vaadinSession);
  return vaadinSession;
}

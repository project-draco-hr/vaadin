{
  final VaadinSession session=vaadinSession;
  session.accessSynchronously(new Runnable(){
    @Override public void run(){
      if (!session.isClosing()) {
        closeSession(session);
      }
      ArrayList<UI> uis=new ArrayList<UI>(session.getUIs());
      for (      final UI ui : uis) {
        ui.accessSynchronously(new Runnable(){
          @Override public void run(){
            if (!ui.isClosing()) {
              ui.close();
            }
            session.removeUI(ui);
          }
        }
);
      }
      eventRouter.fireEvent(new SessionDestroyEvent(VaadinService.this,session),session.getErrorHandler());
    }
  }
);
}

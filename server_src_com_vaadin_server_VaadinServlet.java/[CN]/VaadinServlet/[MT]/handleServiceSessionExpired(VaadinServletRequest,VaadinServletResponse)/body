{
  try {
    SystemMessages ci=getService().getSystemMessages(ServletPortletHelper.findLocale(null,null,request),request);
    RequestType requestType=getRequestType(request);
    if (requestType == RequestType.UIDL) {
      request.getSession().invalidate();
      criticalNotification(request,response,ci.getSessionExpiredCaption(),ci.getSessionExpiredMessage(),null,ci.getSessionExpiredURL());
    }
 else     if (requestType == RequestType.HEARTBEAT) {
      response.sendError(HttpServletResponse.SC_GONE,"Session expired");
    }
 else {
      String sessionExpiredURL=ci.getSessionExpiredURL();
      if (sessionExpiredURL != null) {
        response.sendRedirect(sessionExpiredURL);
      }
 else {
        response.sendError(HttpServletResponse.SC_GONE,"Session expired");
      }
    }
  }
 catch (  SystemMessageException ee) {
    throw new ServletException(ee);
  }
}

{
  final HttpSession session=request.getSession(allowSessionCreation);
  if (session == null) {
    throw new SessionExpiredException();
  }
  ServletApplicationContext context=getApplicationContext(session);
  Application sessionApplication=context.getApplication();
  if (sessionApplication == null) {
    return null;
  }
  if (sessionApplication.isRunning()) {
    return sessionApplication;
  }
  getApplicationContext(session).removeApplication();
  return null;
}

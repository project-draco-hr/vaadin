{
  final HttpSession session=request.getSession(allowSessionCreation);
  if (session == null) {
    throw new SessionExpiredException();
  }
  VaadinSession sessionApplication=getApplicationContext(session);
  if (sessionApplication == null) {
    return null;
  }
  if (!sessionApplication.isRunning()) {
    sessionApplication.removeFromSession();
    return null;
  }
  return sessionApplication;
}

{
  try {
    SystemMessages ci=getService().getSystemMessages(request.getLocale(),request);
    if (ServletPortletHelper.isUIDLRequest(request)) {
      getService().writeStringResponse(response,JsonConstants.JSON_CONTENT_TYPE,VaadinService.createCriticalNotificationJSON(ci.getCommunicationErrorCaption(),ci.getCommunicationErrorMessage(),INVALID_SECURITY_KEY_MSG,ci.getCommunicationErrorURL()));
    }
 else     if (ServletPortletHelper.isHeartbeatRequest(request)) {
      response.sendError(HttpServletResponse.SC_FORBIDDEN,"Forbidden");
    }
 else {
      response.sendRedirect(ci.getCommunicationErrorURL());
    }
  }
 catch (  SystemMessageException ee) {
    throw new ServletException(ee);
  }
  log("Invalid security key received from " + request.getRemoteHost());
}

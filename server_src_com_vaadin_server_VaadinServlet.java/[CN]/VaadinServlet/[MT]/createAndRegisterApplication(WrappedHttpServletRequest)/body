{
  VaadinServletSession session=createVaadinSession(request);
  session.storeInSession(new WrappedHttpSession(request.getSession()));
  final URL applicationUrl=getApplicationUrl(request);
  Locale locale=request.getLocale();
  session.setLocale(locale);
  session.start(new SessionStartEvent(applicationUrl,getVaadinService().getDeploymentConfiguration(),createCommunicationManager(session)));
  onVaadinSessionStarted(request,session);
  return session;
}

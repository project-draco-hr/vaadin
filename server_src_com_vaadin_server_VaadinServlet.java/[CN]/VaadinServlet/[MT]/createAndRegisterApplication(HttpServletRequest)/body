{
  VaadinSession newApplication=createApplication(request);
  try {
    ServletPortletHelper.checkUiProviders(newApplication);
  }
 catch (  ApplicationClassException e) {
    throw new ServletException(e);
  }
  newApplication.storeInSession(new WrappedHttpSession(request.getSession()));
  final URL applicationUrl=getApplicationUrl(request);
  Locale locale=request.getLocale();
  newApplication.setLocale(locale);
  newApplication.start(new SessionStartEvent(applicationUrl,getVaadinService().getDeploymentConfiguration(),createCommunicationManager(newApplication)));
  addonContext.fireApplicationStarted(newApplication);
  return newApplication;
}

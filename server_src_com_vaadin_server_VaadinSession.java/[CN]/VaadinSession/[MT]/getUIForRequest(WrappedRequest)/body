{
  UI uI=UI.getCurrent();
  if (uI != null) {
    return uI;
  }
  Integer uiId=getUIId(request);
  getLock().lock();
  try {
    uI=uIs.get(uiId);
    if (uI == null) {
      uI=findExistingUi(request);
    }
  }
  finally {
    getLock().unlock();
  }
  UI.setCurrent(uI);
  return uI;
}

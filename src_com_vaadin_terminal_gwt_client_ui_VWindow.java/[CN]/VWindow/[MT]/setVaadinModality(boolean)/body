{
  vaadinModality=modality;
  if (vaadinModality) {
    modalityCurtain=DOM.createDiv();
    DOM.setElementProperty(modalityCurtain,"className",CLASSNAME + "-modalitycurtain");
    if (isAttached()) {
      showModalityCurtain();
      bringToFront();
    }
 else {
      Scheduler.get().scheduleDeferred(new Command(){
        public void execute(){
          bringToFront();
        }
      }
);
    }
  }
 else {
    if (modalityCurtain != null) {
      if (isAttached()) {
        hideModalityCurtain();
      }
      modalityCurtain=null;
    }
  }
}

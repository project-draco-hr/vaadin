{
  List<FrameworkMethod> tests=new LinkedList<FrameworkMethod>();
  if (!AbstractTB3Test.class.isAssignableFrom(getTestClass().getJavaClass())) {
    throw new RuntimeException(getClass().getName() + " only supports " + AbstractTB3Test.class.getName());
  }
  try {
    AbstractTB3Test testClassInstance=(AbstractTB3Test)getTestClass().getOnlyConstructor().newInstance();
    Collection<DesiredCapabilities> desiredCapabilites=testClassInstance.getBrowsersToTest();
    if (testClassInstance.getClass().getAnnotation(RunLocally.class) != null) {
      desiredCapabilites=new ArrayList<DesiredCapabilities>();
      desiredCapabilites.add(testClassInstance.getClass().getAnnotation(RunLocally.class).value().getDesiredCapabilities());
    }
    TestNameSuffix testNameSuffixProperty=findAnnotation(testClassInstance.getClass(),TestNameSuffix.class);
    for (    DesiredCapabilities capabilities : desiredCapabilites) {
      for (      FrameworkMethod m : getTestClass().getAnnotatedMethods(Test.class)) {
        TB3Method method=new TB3Method(m.getMethod(),capabilities);
        if (testNameSuffixProperty != null) {
          method.setTestNameSuffix("-" + System.getProperty(testNameSuffixProperty.property()));
        }
        tests.add(method);
      }
    }
  }
 catch (  Exception e) {
    throw new RuntimeException("Error retrieving browsers to run on",e);
  }
  return tests;
}

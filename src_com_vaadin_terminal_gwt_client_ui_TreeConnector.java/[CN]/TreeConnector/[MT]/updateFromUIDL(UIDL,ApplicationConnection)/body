{
  if (!isRealUpdate(uidl)) {
    return;
  }
  getWidget().rendering=true;
  getWidget().client=client;
  if (uidl.hasAttribute("partialUpdate")) {
    handleUpdate(uidl);
    getWidget().rendering=false;
    return;
  }
  getWidget().paintableId=uidl.getId();
  getWidget().immediate=getState().isImmediate();
  getWidget().disabled=!isEnabled();
  getWidget().readonly=isReadOnly();
  getWidget().dragMode=uidl.hasAttribute("dragMode") ? uidl.getIntAttribute("dragMode") : 0;
  getWidget().isNullSelectionAllowed=uidl.getBooleanAttribute("nullselect");
  if (uidl.hasAttribute("alb")) {
    getWidget().bodyActionKeys=uidl.getStringArrayAttribute("alb");
  }
  getWidget().body.clear();
  getWidget().clearNodeToKeyMap();
  TreeNode childTree=null;
  UIDL childUidl=null;
  for (final Iterator<?> i=uidl.getChildIterator(); i.hasNext(); ) {
    childUidl=(UIDL)i.next();
    if ("actions".equals(childUidl.getTag())) {
      updateActionMap(childUidl);
      continue;
    }
 else     if ("-ac".equals(childUidl.getTag())) {
      getWidget().updateDropHandler(childUidl);
      continue;
    }
    childTree=getWidget().new TreeNode();
    updateNodeFromUIDL(childTree,childUidl);
    getWidget().body.add(childTree);
    childTree.addStyleDependentName("root");
    childTree.childNodeContainer.addStyleDependentName("root");
  }
  if (childTree != null && childUidl != null) {
    boolean leaf=!childUidl.getTag().equals("node");
    childTree.addStyleDependentName(leaf ? "leaf-last" : "last");
    childTree.childNodeContainer.addStyleDependentName("last");
  }
  final String selectMode=uidl.getStringAttribute("selectmode");
  getWidget().selectable=!"none".equals(selectMode);
  getWidget().isMultiselect="multi".equals(selectMode);
  if (getWidget().isMultiselect) {
    getWidget().multiSelectMode=uidl.getIntAttribute("multiselectmode");
  }
  getWidget().selectedIds=uidl.getStringArrayVariableAsSet("selected");
  if (getWidget().lastSelection != null) {
    getWidget().lastSelection=getWidget().getNodeByKey(getWidget().lastSelection.key);
  }
  if (getWidget().focusedNode != null) {
    getWidget().setFocusedNode(getWidget().getNodeByKey(getWidget().focusedNode.key));
  }
  if (getWidget().lastSelection == null && getWidget().focusedNode == null && !getWidget().selectedIds.isEmpty()) {
    getWidget().setFocusedNode(getWidget().getNodeByKey(getWidget().selectedIds.iterator().next()));
    getWidget().focusedNode.setFocused(false);
  }
  getWidget().rendering=false;
}

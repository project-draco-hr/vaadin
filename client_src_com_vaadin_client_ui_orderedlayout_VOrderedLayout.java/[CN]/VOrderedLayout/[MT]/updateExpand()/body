{
  boolean isExpanding=false;
  for (  Widget slot : getChildren()) {
    if (((Slot)slot).getExpandRatio() > -1) {
      isExpanding=true;
    }
 else {
      if (vertical) {
        slot.getElement().getStyle().clearHeight();
      }
 else {
        slot.getElement().getStyle().clearWidth();
      }
    }
    slot.getElement().getStyle().clearMarginLeft();
    slot.getElement().getStyle().clearMarginTop();
  }
  if (isExpanding) {
    if (expandWrapper == null) {
      expandWrapper=DOM.createDiv();
      expandWrapper.setClassName("v-expand");
      for (; getElement().getChildCount() > 0; ) {
        Node el=getElement().getChild(0);
        expandWrapper.appendChild(el);
      }
      getElement().appendChild(expandWrapper);
    }
    int totalSize=0;
    for (    Widget w : getChildren()) {
      Slot slot=(Slot)w;
      if (slot.getExpandRatio() == -1) {
        if (layoutManager != null) {
          if (vertical) {
            int size=layoutManager.getOuterHeight(slot.getWidget().getElement()) - layoutManager.getMarginHeight(slot.getWidget().getElement());
            if (slot.hasCaption()) {
              size+=layoutManager.getOuterHeight(slot.getCaptionElement()) - layoutManager.getMarginHeight(slot.getCaptionElement());
            }
            if (size > 0) {
              totalSize+=size;
            }
          }
 else {
            int max=-1;
            max=layoutManager.getOuterWidth(slot.getWidget().getElement()) - layoutManager.getMarginWidth(slot.getWidget().getElement());
            if (slot.hasCaption()) {
              int max2=layoutManager.getOuterWidth(slot.getCaptionElement()) - layoutManager.getMarginWidth(slot.getCaptionElement());
              max=Math.max(max,max2);
            }
            if (max > 0) {
              totalSize+=max;
            }
          }
        }
 else {
          totalSize+=vertical ? slot.getOffsetHeight() : slot.getOffsetWidth();
        }
      }
      int spacingSize=vertical ? slot.getVerticalSpacing() : slot.getHorizontalSpacing();
      if (spacingSize > 0) {
        totalSize+=spacingSize;
      }
    }
    if (vertical) {
      expandWrapper.getStyle().setPaddingTop(totalSize,Unit.PX);
      expandWrapper.getFirstChildElement().getStyle().setMarginTop(-totalSize,Unit.PX);
    }
 else {
      expandWrapper.getStyle().setPaddingLeft(totalSize,Unit.PX);
      expandWrapper.getFirstChildElement().getStyle().setMarginLeft(-totalSize,Unit.PX);
    }
    recalculateExpands();
  }
}

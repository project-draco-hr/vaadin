{
  clear();
  theme=uidl.getStringAttribute("theme");
  com.google.gwt.user.client.Window.setTitle(uidl.getStringAttribute("caption"));
  int childIndex=0;
  while (childIndex < uidl.getChidlCount() && "open".equals(uidl.getChildUIDL(childIndex).getTag())) {
    UIDL open=uidl.getChildUIDL(childIndex);
    String url=open.getStringAttribute("src");
    String target=open.getStringAttribute("target");
    Window.open(url,target != null ? target : null,"");
    childIndex++;
  }
  UIDL childUidl=uidl.getChildUIDL(childIndex);
  Paintable lo=(Paintable)client.getWidget(childUidl);
  if (layout != null) {
    if (layout != lo) {
      client.unregisterPaintable(layout);
      setWidget((Widget)lo);
      layout=lo;
    }
  }
 else {
    setWidget((Widget)lo);
  }
  lo.updateFromUIDL(childUidl,client);
  HashSet removedSubWindows=new HashSet(subWindows);
  while ((childUidl=uidl.getChildUIDL(childIndex++)) != null) {
    if ("window".equals(childUidl.getTag())) {
      Widget w=client.getWidget(childUidl);
      if (subWindows.contains(w)) {
        removedSubWindows.remove(w);
      }
 else {
        subWindows.add(w);
      }
      ((Paintable)w).updateFromUIDL(childUidl,client);
    }
  }
  for (Iterator rem=removedSubWindows.iterator(); rem.hasNext(); ) {
    IWindow w=(IWindow)rem.next();
    client.unregisterPaintable(w);
    subWindows.remove(w);
    RootPanel.get().remove(w);
  }
}

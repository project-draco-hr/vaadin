{
  if (null == sharedState) {
    sharedState=createState();
  }
  if (!isVisible()) {
    return null;
  }
  Map<String,Object> state=new HashMap<String,Object>();
  if (getHeight() >= 0 && (getHeightUnits() != Unit.PERCENTAGE || ComponentSizeValidator.parentCanDefineHeight(this))) {
    state.put(ComponentState.STATE_HEIGHT,"" + getCSSHeight());
  }
  if (getWidth() >= 0 && (getWidthUnits() != Unit.PERCENTAGE || ComponentSizeValidator.parentCanDefineWidth(this))) {
    state.put(ComponentState.STATE_WIDTH,"" + getCSSWidth());
  }
  if (styles != null && styles.size() > 0) {
    state.put(ComponentState.STATE_STYLE,getStyle());
  }
  if (isReadOnly()) {
    state.put(ComponentState.STATE_READONLY,true);
  }
  if (isImmediate()) {
    state.put(ComponentState.STATE_IMMEDIATE,true);
  }
  if (!isEnabled()) {
    state.put(ComponentState.STATE_DISABLED,true);
  }
  if (getCaption() != null) {
    state.put(ComponentState.STATE_CAPTION,getCaption());
  }
  if (getDescription() != null && getDescription().length() > 0) {
    state.put(ComponentState.STATE_DESCRIPTION,getDescription());
  }
  sharedState.setState(state);
  return sharedState;
}

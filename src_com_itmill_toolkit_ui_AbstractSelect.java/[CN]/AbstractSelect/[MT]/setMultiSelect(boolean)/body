{
  if (multiSelect && getNullSelectionItemId() != null) {
    throw new IllegalStateException();
  }
  if (multiSelect != this.multiSelect) {
    Object oldValue=getValue();
    this.multiSelect=multiSelect;
    if (multiSelect) {
      Set s=new HashSet();
      if (oldValue != null) {
        s.add(oldValue);
      }
      setValue(s);
    }
 else {
      Set s=(Set)oldValue;
      if (s == null || s.isEmpty()) {
        setValue(null);
      }
 else {
        setValue(s.iterator().next());
      }
    }
    requestRepaint();
  }
}

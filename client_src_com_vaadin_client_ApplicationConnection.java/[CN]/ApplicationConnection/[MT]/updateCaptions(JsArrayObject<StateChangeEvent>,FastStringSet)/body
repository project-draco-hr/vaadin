{
  Profiler.enter("updateCaptions");
  FastStringSet needsCaptionUpdate=FastStringSet.create();
  needsCaptionUpdate.addAll(parentChangedIds);
  int size=pendingStateChangeEvents.size();
  for (int i=0; i < size; i++) {
    StateChangeEvent event=pendingStateChangeEvents.get(i);
    if (VCaption.mightChange(event)) {
      ServerConnector connector=event.getConnector();
      needsCaptionUpdate.add(connector.getConnectorId());
    }
  }
  ConnectorMap connectorMap=getConnectorMap();
  JsArrayString dump=needsCaptionUpdate.dump();
  int needsUpdateLength=dump.length();
  for (int i=0; i < needsUpdateLength; i++) {
    String childId=dump.get(i);
    ServerConnector child=connectorMap.getConnector(childId);
    if (child instanceof ComponentConnector && ((ComponentConnector)child).delegateCaptionHandling()) {
      ServerConnector parent=child.getParent();
      if (parent instanceof HasComponentsConnector) {
        Profiler.enter("HasComponentsConnector.updateCaption");
        ((HasComponentsConnector)parent).updateCaption((ComponentConnector)child);
        Profiler.leave("HasComponentsConnector.updateCaption");
      }
    }
  }
  Profiler.leave("updateCaptions");
}

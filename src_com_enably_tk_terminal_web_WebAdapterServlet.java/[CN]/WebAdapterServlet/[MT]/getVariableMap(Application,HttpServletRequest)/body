{
  HttpSession session=request.getSession();
  Map varMapMap=(Map)session.getAttribute(SESSION_ATTR_VARMAP);
  if (varMapMap == null) {
    varMapMap=new WeakHashMap();
    session.setAttribute(SESSION_ATTR_VARMAP,varMapMap);
  }
  HttpVariableMap variableMap=(HttpVariableMap)varMapMap.get(application);
  if (variableMap == null) {
    variableMap=new HttpVariableMap();
    varMapMap.put(application,variableMap);
  }
  return variableMap;
}

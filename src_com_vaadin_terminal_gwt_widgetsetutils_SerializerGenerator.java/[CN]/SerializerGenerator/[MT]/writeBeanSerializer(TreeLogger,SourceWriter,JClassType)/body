{
  sourceWriter.println(JSONObject.class.getName() + " json = new " + JSONObject.class.getName()+ "();");
  HashSet<String> usedFieldNames=new HashSet<String>();
  for (  JMethod setterMethod : getSetters(beanType)) {
    String setterName=setterMethod.getName();
    String fieldName=getTransportFieldName(setterName.substring(3));
    if (!usedFieldNames.add(fieldName)) {
      logger.log(TreeLogger.ERROR,"Can't encode " + beanType.getQualifiedSourceName() + " as it has multiple fields with the name "+ fieldName.toLowerCase()+ ". This can happen if only casing distinguishes one property name from another.");
      throw new UnableToCompleteException();
    }
    String getterName=findGetter(beanType,setterMethod);
    if (getterName == null) {
      logger.log(TreeLogger.ERROR,"No getter found for " + fieldName + ". Serialization will likely fail");
    }
    sourceWriter.println("json.put(\"" + fieldName + "\",  "+ JsonEncoder.class.getName()+ ".encode(castedValue."+ getterName+ "(), false, connection));");
  }
  sourceWriter.println("return json;");
}

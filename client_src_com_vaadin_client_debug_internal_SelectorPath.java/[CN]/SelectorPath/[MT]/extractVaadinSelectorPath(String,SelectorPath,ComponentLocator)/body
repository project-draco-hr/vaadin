{
  SelectorPath selectorPath=null;
  String xpathPart=null;
  int xpathPos=Math.min(path.indexOf("/div"),path.indexOf("/span"));
  if (xpathPos >= 0) {
    xpathPart=path.substring(xpathPos);
    path=path.substring(0,xpathPos);
  }
  String subPartPart=null;
  int subPartPos=path.indexOf("#");
  if (subPartPos >= 0) {
    subPartPart=path.substring(subPartPos + 1);
    path=path.substring(0,subPartPos);
  }
  String domChildPart=null;
  int domChildPos=path.indexOf("/domChild");
  if (domChildPos >= 0) {
    domChildPart=path.substring(domChildPos);
    path=path.substring(0,domChildPos);
  }
  String widgetClass=null;
  RegExp widgetInSlotMatcher=RegExp.compile("^/(Slot\\[(\\d+)\\]/)([a-zA-Z]+)(\\[0\\])?$");
  MatchResult matchResult=widgetInSlotMatcher.exec(path);
  if (null != matchResult) {
    if (matchResult.getGroupCount() >= 3) {
      widgetClass=matchResult.getGroup(3);
    }
  }
  if (null == widgetClass) {
    RegExp widgetDirectlyMatcher=RegExp.compile("^//?([a-zA-Z]+)(\\[(\\d+)\\])?$");
    matchResult=widgetDirectlyMatcher.exec(path);
    if (null != matchResult) {
      if (matchResult.getGroupCount() >= 1) {
        widgetClass=matchResult.getGroup(1);
      }
    }
  }
  if (null != widgetClass && !widgetClass.isEmpty()) {
    selectorPath=findVaadinSelectorInParent(path,widgetClass,parent,locator);
    if (null != subPartPart && selectorPath instanceof VaadinSelectorPath) {
      ((VaadinSelectorPath)selectorPath).setSubPart(subPartPart);
    }
 else     if (null != xpathPart && selectorPath instanceof VaadinSelectorPath) {
      ComponentConnector connector=Util.findPaintable(locator.getClient(),selectorPath.findElement());
      if (connector != null && connector.getWidget() instanceof SubPartAware) {
        Element element=locator.getElementByPathStartingAt(path,selectorPath.findElement());
        SubPartAware subPartAware=(SubPartAware)connector.getWidget();
        String subPart=subPartAware.getSubPartName(element);
        if (null != subPart) {
          ((VaadinSelectorPath)selectorPath).setSubPart(subPart);
        }
      }
 else {
        selectorPath=SelectorPath.xpath(xpathPart,selectorPath,locator);
      }
    }
    if (null != domChildPart && selectorPath instanceof VaadinSelectorPath) {
      selectorPath=SelectorPath.vaadinPath(domChildPart,selectorPath,locator);
    }
  }
 else   if (null != domChildPart) {
    selectorPath=SelectorPath.vaadinPath(domChildPart,parent,locator);
  }
  return selectorPath;
}

{
  if (shouldCreateApplication(request)) {
    VaadinSession.setCurrent(session);
    session.getBrowser().updateRequestDetails(request);
    Application legacyApplication=getNewApplication(request.getPortletRequest());
    legacyApplication.doInit();
    session.addUIProvider(legacyApplication);
  }
  super.onVaadinSessionStarted(request,session);
}

{
  Container container=getContainerDataSource();
  if (pageLength == 0) {
    filteredSize=container.size();
    return new ArrayList<Object>(container.getItemIds());
  }
  if (!(container instanceof Filterable) || !(container instanceof Indexed) || getItemCaptionMode() != ITEM_CAPTION_MODE_PROPERTY) {
    return null;
  }
  Filterable filterable=(Filterable)container;
  Filter filter=buildFilter(filterstring,filteringMode);
  if (filter != null) {
    filterable.addContainerFilter(filter);
  }
  try {
    Indexed indexed=(Indexed)container;
    int indexToEnsureInView=-1;
    Object selection=getValue();
    if (isScrollToSelectedItem() && !optionRequest && selection != null) {
      indexToEnsureInView=indexed.indexOfId(selection);
    }
    filteredSize=container.size();
    currentPage=adjustCurrentPage(currentPage,needNullSelectOption,indexToEnsureInView,filteredSize);
    int first=getFirstItemIndexOnCurrentPage(needNullSelectOption,filteredSize);
    int last=getLastItemIndexOnCurrentPage(needNullSelectOption,filteredSize,first);
    int lastItemToFetch=Math.min(last,filteredSize - 1);
    int nrOfItemsToFetch=(lastItemToFetch + 1) - first;
    List<?> options=indexed.getItemIds(first,nrOfItemsToFetch);
    return options;
  }
  finally {
    if (filter != null) {
      filterable.removeContainerFilter(filter);
    }
  }
}

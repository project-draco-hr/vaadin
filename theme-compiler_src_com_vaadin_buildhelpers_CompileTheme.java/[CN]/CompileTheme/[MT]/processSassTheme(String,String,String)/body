{
  StringBuffer cssHeader=new StringBuffer();
  version=version.replaceAll("\\.","_");
  cssHeader.append(".v-theme-version:after {content:\"" + version + "\";}\n");
  cssHeader.append(".v-theme-version-" + version + " {display: none;}\n");
  String stylesCssDir=themeFolder + File.separator + themeName+ File.separator;
  String stylesCssName=stylesCssDir + "styles.css";
  String sassFile=stylesCssDir + "styles.scss";
  ScssStylesheet scss=ScssStylesheet.get(sassFile);
  if (scss == null) {
    throw new IllegalArgumentException("SASS file: " + sassFile + " not found");
  }
  scss.compile();
  BufferedWriter out=new BufferedWriter(new FileWriter(stylesCssName));
  out.write(cssHeader.toString());
  out.write(scss.toString());
  out.close();
  System.out.println("Compiled CSS to " + stylesCssName + " ("+ scss.toString().length()+ " bytes)");
  createSprites(themeFolder,themeName);
  System.out.println("Used SmartSprites to create sprites");
  File oldCss=new File(stylesCssName);
  File newCss=new File(stylesCssDir + "styles-sprite.css");
  if (newCss.exists()) {
    oldCss.delete();
    boolean ok=newCss.renameTo(oldCss);
    if (!ok) {
      throw new RuntimeException("Rename " + newCss + " -> "+ oldCss+ " failed");
    }
  }
}

{
  String pid=null;
  Element e=targetElement;
  while (true) {
    pid=VPaintableMap.get(client).getPid(e);
    if (pid != null) {
      break;
    }
    e=DOM.getParent(e);
    if (e == null) {
      break;
    }
  }
  Widget w=null;
  if (pid != null) {
    w=((VPaintableWidget)VPaintableMap.get(client).getPaintable(pid)).getWidgetForPaintable();
    Widget targetParent=findParentWidget(targetElement,w);
    while (targetParent != w && targetParent != null) {
      if (targetParent instanceof SubPartAware) {
        w=targetParent;
        break;
      }
      targetParent=targetParent.getParent();
    }
  }
  if (w == null) {
    RootPanel rootPanel=RootPanel.get();
    int rootWidgetCount=rootPanel.getWidgetCount();
    for (int i=0; i < rootWidgetCount; i++) {
      Widget rootWidget=rootPanel.getWidget(i);
      if (rootWidget.getElement().isOrHasChild(targetElement)) {
        w=findParentWidget(targetElement,rootWidget);
        break;
      }
    }
    if (w != null) {
      Widget subPartAwareWidget=findSubPartAwareParentWidget(w);
      if (subPartAwareWidget != null) {
        w=subPartAwareWidget;
      }
    }
  }
  if (w == null) {
    return null;
  }
  String path=getPathForWidget(w);
  if (path == null) {
    return null;
  }
  if (w.getElement() == targetElement) {
    return path;
  }
 else   if (w instanceof SubPartAware) {
    String elementLocator=((SubPartAware)w).getSubPartName(targetElement);
    if (elementLocator != null) {
      return path + SUBPART_SEPARATOR + elementLocator;
    }
  }
  return path + getDOMPathForElement(targetElement,w.getElement());
}

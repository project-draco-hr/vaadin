{
  if (millisLeft <= 0 || cancelled) {
    scroller.currentFlickScroller=null;
    return;
  }
  if (prevTime == 0) {
    prevTime=timestamp;
    AnimationScheduler.get().requestAnimationFrame(this);
    return;
  }
  int currentLeft=horizontalScrollbar.getScrollPos();
  int currentTop=verticalScrollbar.getScrollPos();
  final double timeDiff=timestamp - prevTime;
  double left=currentLeft - velX * timeDiff;
  setScrollLeft((int)left);
  velX-=xFric * timeDiff;
  double top=currentTop - velY * timeDiff;
  setScrollTop(top);
  velY-=yFric * timeDiff;
  cancelBecauseOfEdgeOrCornerMaybe();
  prevTime=timestamp;
  millisLeft-=timeDiff;
  lastLeft=currentLeft;
  lastTop=currentTop;
  AnimationScheduler.get().requestAnimationFrame(this);
}

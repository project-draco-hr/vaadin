{
  final double currentTimeMillis=Duration.currentTimeMillis();
  velX=Math.max(Math.min(deltaX / (currentTimeMillis - lastTime),MAX_SPEED),-MAX_SPEED);
  velY=Math.max(Math.min(deltaY / (currentTimeMillis - lastTime),MAX_SPEED),-MAX_SPEED);
  lastLeft=horizontalScrollbar.getScrollPos();
  lastTop=verticalScrollbar.getScrollPos();
  final double[] snapDeltas=Escalator.snapDeltas(velX,velY,RATIO_OF_30_DEGREES);
  velX=snapDeltas[0];
  velY=snapDeltas[1];
  if (velX * velX + velY * velY > MIN_MAGNITUDE) {
    millisLeft=1500;
    xFric=velX / millisLeft;
    yFric=velY / millisLeft;
  }
 else {
    millisLeft=0;
  }
}

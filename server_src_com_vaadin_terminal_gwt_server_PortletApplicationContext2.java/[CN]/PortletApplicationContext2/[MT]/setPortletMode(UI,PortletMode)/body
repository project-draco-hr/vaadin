{
  if (response instanceof MimeResponse) {
    PortletURL url=((MimeResponse)response).createRenderURL();
    url.setPortletMode(portletMode);
    throw new RuntimeException("UI.open has not yet been implemented");
  }
 else   if (response instanceof StateAwareResponse) {
    ((StateAwareResponse)response).setPortletMode(portletMode);
  }
 else {
    throw new IllegalStateException("Portlet mode can only be changed from a portlet request");
  }
}

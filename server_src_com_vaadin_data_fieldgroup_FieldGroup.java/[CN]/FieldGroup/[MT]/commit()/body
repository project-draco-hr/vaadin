{
  if (!isBuffered()) {
    return;
  }
  for (  Field<?> f : fieldToPropertyId.keySet()) {
    ((Property.Transactional<?>)f.getPropertyDataSource()).startTransaction();
  }
  try {
    firePreCommitEvent();
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      f.commit();
    }
    firePostCommitEvent();
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      ((Property.Transactional<?>)f.getPropertyDataSource()).commit();
    }
  }
 catch (  Exception e) {
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      try {
        ((Property.Transactional<?>)f.getPropertyDataSource()).rollback();
      }
 catch (      Exception rollbackException) {
      }
    }
    throw new CommitException("Commit failed",e);
  }
}

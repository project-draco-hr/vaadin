{
  String appUrl=null;
  String widgetsetUrl=null;
  if (isApplicationRunnerServlet) {
    final String[] URIparts=getApplicationRunnerURIs(request);
    widgetsetUrl=URIparts[0];
    if (widgetsetUrl.equals("/")) {
      widgetsetUrl="";
    }
    appUrl=URIparts[1];
  }
 else {
    String[] urlParts;
    urlParts=getApplicationUrl(request).toString().split("\\/");
    appUrl="";
    widgetsetUrl="";
    String ctxPath=request.getContextPath();
    if (ctxPath.length() == 0 && request.getAttribute("javax.servlet.include.context_path") != null) {
      ctxPath=(String)request.getAttribute("javax.servlet.include.context_path");
    }
    if (urlParts.length > 3 && urlParts[3].equals(ctxPath.replaceAll("\\/",""))) {
      widgetsetUrl+="/" + urlParts[3];
    }
    for (int i=3; i < urlParts.length; i++) {
      appUrl+="/" + urlParts[i];
    }
    if (appUrl.endsWith("/")) {
      appUrl=appUrl.substring(0,appUrl.length() - 1);
    }
  }
  return new String[]{appUrl,widgetsetUrl};
}

{
  final WebApplicationContext context=WebApplicationContext.getApplicationContext(request.getSession());
  final URL applicationUrl;
  if (isApplicationRunnerServlet) {
    final String[] URIparts=getApplicationRunnerURIs(request);
    final String applicationClassname=URIparts[4];
    applicationUrl=new URL(getApplicationUrl(request).toString() + applicationClassname + "/");
    try {
      applicationClass=getClassLoader().loadClass(applicationClassname);
    }
 catch (    final ClassNotFoundException e) {
      throw new InstantiationException("Failed to load application class: " + applicationClassname);
    }
  }
 else {
    applicationUrl=getApplicationUrl(request);
  }
  try {
    final Application application=(Application)applicationClass.newInstance();
    context.addApplication(application);
    application.setLocale(request.getLocale());
    application.start(applicationUrl,applicationProperties,context);
    return application;
  }
 catch (  final IllegalAccessException e) {
    throw e;
  }
catch (  final InstantiationException e) {
    throw e;
  }
}

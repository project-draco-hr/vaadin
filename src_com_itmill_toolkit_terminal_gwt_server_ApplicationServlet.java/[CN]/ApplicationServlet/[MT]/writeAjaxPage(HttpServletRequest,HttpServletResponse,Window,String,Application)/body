{
  response.setHeader("Cache-Control","no-cache");
  response.setHeader("Pragma","no-cache");
  response.setDateHeader("Expires",0);
  response.setContentType("text/html");
  final BufferedWriter page=new BufferedWriter(new OutputStreamWriter(response.getOutputStream()));
  final String pathInfo=request.getPathInfo() == null ? "/" : request.getPathInfo();
  String title=((window == null || window.getCaption() == null) ? "IT Mill Toolkit 5" : window.getCaption());
  page.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" " + "\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n");
  page.write("<html xmlns=\"http://www.w3.org/1999/xhtml\" style=\"width:100%;" + "height:100%;border:0;margin:0;\">\n<head>\n" + "<title>" + title + "</title>\n"+ "<script type=\"text/javascript\">\n"+ "	var itmill = {toolkitConfigurations: {'itmill-ajax-window' :{\n"+ "		appUri:'");
  final String[] urls=getAppAndWidgetUrl(request);
  final String appUrl=urls[0];
  final String widgetsetUrl=urls[1];
  page.write(appUrl);
  String widgetset=applicationProperties.getProperty(PARAMETER_WIDGETSET);
  if (widgetset == null) {
    widgetset=DEFAULT_WIDGETSET;
  }
  final String staticFilePath=getApplicationOrSystemProperty(PARAMETER_ITMILL_RESOURCES,widgetsetUrl);
  String themeUri=null;
  if (themeName != null) {
    themeUri=staticFilePath + "/" + THEME_DIRECTORY_PATH+ themeName;
  }
  page.write("', pathInfo: '" + pathInfo);
  page.write("', themeUri: ");
  page.write(themeUri != null ? "'" + themeUri + "'" : "null");
  if (testingToolsActive) {
    page.write(", versionInfo : {toolkitVersion:\"");
    page.write(VERSION);
    page.write("\",applicationVersion:\"");
    page.write(application.getVersion());
    page.write("\"}");
  }
  page.write("\n}}\n");
  page.write("};\n</script>\n");
  boolean testingWindow=testingToolsActive && request.getParameter("TT") != null;
  if (testingWindow) {
    writeTestingToolsScripts(page,request);
  }
  page.write("<script language='javascript' src='" + staticFilePath + "/"+ WIDGETSET_DIRECTORY_PATH+ widgetset+ "/"+ widgetset+ ".nocache.js'></script>\n");
  if (themeName != null) {
    page.write("<link REL=\"stylesheet\" TYPE=\"text/css\" HREF=\"" + themeUri + "/styles.css\">\n");
  }
  page.write("</head>\n<body class=\"i-generated-body\">\n" + "	<iframe id=\"__gwt_historyFrame\" style=\"width:0;height:0;border:0;overflow:hidden\" src=\"javascript:false\"></iframe>\n" + "	<div id=\"itmill-ajax-window\" style=\"position: absolute;top:0;left:0;width:100%;height:100%;border:0;margin:0\"></div>"+ "	</body>\n"+ "</html>\n");
  page.close();
}

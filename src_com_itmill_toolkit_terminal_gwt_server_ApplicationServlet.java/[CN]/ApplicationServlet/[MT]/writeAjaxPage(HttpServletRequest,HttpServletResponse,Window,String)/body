{
  response.setContentType("text/html");
  BufferedWriter page=new BufferedWriter(new OutputStreamWriter(response.getOutputStream()));
  String uri=request.getRequestURL().toString();
  boolean hasSlash=(uri.charAt(uri.length() - 1) == '/') ? true : false;
  page.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" " + "\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n");
  page.write("<html>\n<head>\n<title>IT Mill Toolkit 5</title>\n" + "<meta name='gwt:module' content='" + (hasSlash ? "../" : "") + "com.itmill.toolkit.terminal.gwt.Client=com.itmill.toolkit.terminal.gwt.Client'>\n"+ "<script type=\"text/javascript\">\n"+ "	var itmtk = {\n"+ "		appUri:'");
  String[] urlParts=getApplicationUrl(request).toString().split("\\/");
  String appUrl="";
  for (int i=3; i < urlParts.length; i++)   appUrl+="/" + urlParts[i];
  if (appUrl.endsWith("/")) {
    appUrl=appUrl.substring(0,appUrl.length() - 1);
  }
  page.write(appUrl);
  page.write("'\n};\n" + "</script>\n" + "<link REL=\"stylesheet\" TYPE=\"text/css\" HREF=\"" + request.getContextPath() + THEME_DIRECTORY_PATH+ themeName+ "/style.css\">"+ "</head>\n<body>\n<script language=\"javascript\" src=\""+ (hasSlash ? "../" : "")+ "com.itmill.toolkit.terminal.gwt.Client/gwt.js\"></script>\n"+ "	<iframe id=\"__gwt_historyFrame\" style=\"width:0;height:0;border:0\"></iframe>\n"+ "	<div id=\"itmtk-ajax-window\"></div>"+ "	<div style=\"position: absolute; right: 5px; top: 5px; color: gray;\"><strong>IT Mill Toolkit 5 Prototype</strong></div>\n"+ "	</body>\n"+ "</html>\n");
  page.close();
}

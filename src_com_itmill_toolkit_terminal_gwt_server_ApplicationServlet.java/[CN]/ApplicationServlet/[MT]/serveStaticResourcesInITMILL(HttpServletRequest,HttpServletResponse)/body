{
  String filename=request.getPathInfo();
  ServletContext sc=getServletContext();
  InputStream is=sc.getResourceAsStream(filename);
  if (is == null) {
    try {
      filename=filename.substring(1);
      is=classLoader.getResourceAsStream(filename);
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    if (is == null) {
      System.err.println("Requested resource [" + filename + "] not found from filesystem or through class loader.");
      response.setStatus(404);
      return;
    }
  }
  String mimetype=sc.getMimeType(filename);
  if (mimetype != null) {
    response.setContentType(mimetype);
  }
  OutputStream os=response.getOutputStream();
  byte buffer[]=new byte[20000];
  int bytes;
  while ((bytes=is.read(buffer)) >= 0) {
    os.write(buffer,0,bytes);
  }
}

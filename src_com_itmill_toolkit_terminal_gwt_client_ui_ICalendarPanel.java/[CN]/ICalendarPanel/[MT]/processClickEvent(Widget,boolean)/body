{
  if (!datefield.isEnabled() || datefield.isReadonly()) {
    return;
  }
  Date showingDate=datefield.getShowingDate();
  if (!updateVariable) {
    if (sender == prevYear) {
      showingDate.setYear(showingDate.getYear() - 1);
      updateCalendar();
    }
 else     if (sender == nextYear) {
      showingDate.setYear(showingDate.getYear() + 1);
      updateCalendar();
    }
 else     if (sender == prevMonth) {
      int currentMonth=showingDate.getMonth();
      showingDate.setMonth(currentMonth - 1);
      while (showingDate.getMonth() == currentMonth) {
        showingDate.setDate(showingDate.getDate() - 1);
      }
      updateCalendar();
    }
 else     if (sender == nextMonth) {
      int currentMonth=showingDate.getMonth();
      showingDate.setMonth(currentMonth + 1);
      int requestedMonth=(currentMonth + 1) % 12;
      while (showingDate.getMonth() != requestedMonth) {
        showingDate.setDate(showingDate.getDate() - 1);
      }
      updateCalendar();
    }
  }
 else {
    if (datefield.getCurrentResolution() == IDateField.RESOLUTION_YEAR || datefield.getCurrentResolution() == IDateField.RESOLUTION_MONTH) {
      datefield.setCurrentDate(new Date(showingDate.getTime()));
      if (datefield.getCurrentResolution() == IDateField.RESOLUTION_MONTH) {
        datefield.getClient().updateVariable(datefield.getId(),"month",datefield.getCurrentDate().getMonth() + 1,false);
      }
      datefield.getClient().updateVariable(datefield.getId(),"year",datefield.getCurrentDate().getYear() + 1900,datefield.isImmediate());
    }
  }
}

{
  Command command=new Command(){
    @Override public void execute(){
      client.updateVariable(paintableId,"selected",selectedIds.toArray(new String[selectedIds.size()]),sendClickEventNow || immediate);
      sendClickEventNow=false;
      selectionHasChanged=false;
    }
  }
;
  if (BrowserInfo.get().isWebkit()) {
    Scheduler.get().scheduleDeferred(command);
  }
 else {
    command.execute();
  }
}

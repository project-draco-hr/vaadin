{
  if (client.updateComponent(this,uidl,true))   return;
  this.client=client;
  this.id=uidl.getId();
  clear();
  for (Iterator i=uidl.getChildIterator(); i.hasNext(); ) {
    UIDL childUidl=(UIDL)i.next();
    TreeNode childTree=new TreeNode();
    addItem(childTree);
    childTree.updateFromUIDL(childUidl,client);
  }
  String selectMode=uidl.getStringAttribute("selectmode");
  selectable=selectMode != null;
  multiselect="multi".equals(selectMode);
  addTreeListener(new TreeListener(){
    public void onTreeItemStateChanged(    TreeItem item){
    }
    public void onTreeItemSelected(    TreeItem item){
      if (!selectable)       return;
      item.setSelected(true);
      String key=((TreeNode)item).key;
      if (key != null) {
        if (!multiselect)         selectedIds.clear();
        if (selectedIds.contains(key))         selectedIds.remove(key);
 else         selectedIds.add(key);
        ITree.this.client.updateVariable(ITree.this.id,"selected",selectedIds.toArray(),true);
      }
    }
  }
);
  selectedIds=uidl.getStringArrayVariableAsSet("selected");
}

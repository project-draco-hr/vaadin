{
  if (selected) {
    if (!isMultiselect) {
      while (selectedIds.size() > 0) {
        String id=(String)selectedIds.iterator().next();
        TreeNode oldSelection=(TreeNode)keyToNode.get(id);
        oldSelection.setSelected(false);
        selectedIds.remove(id);
      }
    }
    treeNode.setSelected(true);
    selectedIds.add(treeNode.key);
  }
 else {
    if (!isNullSelectionAllowed) {
      if (!isMultiselect || selectedIds.size() == 1) {
        return;
      }
    }
    selectedIds.remove(treeNode.key);
    treeNode.setSelected(false);
  }
  client.updateVariable(paintableId,"selected",selectedIds.toArray(),immediate);
}

{
  boolean needsLayout=false;
  boolean reDistributeColSpanWidths=false;
  boolean reDistributeRowSpanHeights=false;
  int offsetHeight=canvas.getOffsetHeight();
  int offsetWidth=canvas.getOffsetWidth();
  if ("".equals(width) || "".equals(height)) {
    needsLayout=true;
  }
  ArrayList<Integer> dirtyColumns=new ArrayList<Integer>();
  ArrayList<Integer> dirtyRows=new ArrayList<Integer>();
  for (  Paintable paintable : changedChildren) {
    Cell cell=paintableToCell.get(paintable);
    if (!cell.hasRelativeHeight() || !cell.hasRelativeWidth()) {
      cell.cc.setWidth("");
      cell.cc.setHeight("");
      cell.cc.updateWidgetSize();
      int width=cell.getWidth();
      int allocated=columnWidths[cell.col];
      for (int i=1; i < cell.colspan; i++) {
        allocated+=spacingPixelsHorizontal + columnWidths[cell.col + i];
      }
      if (allocated < width) {
        needsLayout=true;
        if (cell.colspan == 1) {
          columnWidths[cell.col]=minColumnWidths[cell.col]=width;
        }
 else {
          reDistributeColSpanWidths=true;
        }
      }
 else       if (allocated != width) {
        dirtyColumns.add(cell.col);
      }
      int height=cell.getHeight();
      allocated=rowHeights[cell.row];
      for (int i=1; i < cell.rowspan; i++) {
        allocated+=spacingPixelsVertical + rowHeights[cell.row + i];
      }
      if (allocated < height) {
        needsLayout=true;
        if (cell.rowspan == 1) {
          rowHeights[cell.row]=minRowHeights[cell.row]=height;
        }
 else {
          reDistributeRowSpanHeights=true;
        }
      }
 else       if (allocated != height) {
        dirtyRows.add(cell.row);
      }
    }
  }
  if (dirtyColumns.size() > 0) {
    for (    Integer colIndex : dirtyColumns) {
      int colW=0;
      for (int i=0; i < rowHeights.length; i++) {
        Cell cell=cells[colIndex][i];
        if (cell != null && cell.getChildUIDL() != null && !cell.hasRelativeWidth() && cell.colspan == 1) {
          int width=cell.getWidth();
          if (width > colW) {
            colW=width;
          }
        }
      }
      minColumnWidths[colIndex]=colW;
    }
    needsLayout=true;
    columnWidths=cloneArray(minColumnWidths);
    distributeColSpanWidths();
    reDistributeColSpanWidths=false;
  }
  if (reDistributeColSpanWidths) {
    distributeColSpanWidths();
  }
  if (dirtyRows.size() > 0) {
    needsLayout=true;
    for (    Integer rowIndex : dirtyRows) {
      int rowH=minRowHeights[rowIndex]=0;
      for (int i=0; i < columnWidths.length; i++) {
        Cell cell=cells[i][rowIndex];
        if (cell != null && cell.getChildUIDL() != null && !cell.hasRelativeHeight() && cell.rowspan == 1) {
          int h=cell.getHeight();
          if (h > rowH) {
            rowH=h;
          }
        }
      }
      minRowHeights[rowIndex]=rowH;
    }
    rowHeights=cloneArray(minRowHeights);
    distributeRowSpanHeights();
    reDistributeRowSpanHeights=false;
  }
  if (reDistributeRowSpanHeights) {
    distributeRowSpanHeights();
  }
  if (needsLayout) {
    expandColumns();
    expandRows();
    layoutCells();
    for (int i=0; i < cells.length; i++) {
      for (int j=0; j < cells[i].length; j++) {
        Cell cell=cells[i][j];
        if (cell != null && (cell.hasRelativeHeight() || cell.hasRelativeWidth())) {
          client.handleComponentRelativeSize(cell.cc.getWidget());
        }
      }
    }
  }
  if (canvas.getOffsetHeight() != offsetHeight || canvas.getOffsetWidth() != offsetWidth) {
    return false;
  }
 else {
    return true;
  }
}

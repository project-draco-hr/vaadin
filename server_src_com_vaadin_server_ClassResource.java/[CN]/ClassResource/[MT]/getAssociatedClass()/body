{
  if (associatedClass == null) {
    Class<? extends UI> associatedClass=UI.getCurrent().getClass();
    if (associatedClass == LegacyWindow.class) {
      return VaadinSession.getCurrent().getClass();
    }
    return associatedClass;
  }
  return associatedClass;
}

{
  response.setContentType("text/html");
  BufferedWriter page=new BufferedWriter(new OutputStreamWriter(out));
  page.write("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" " + "\"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n");
  page.write("<html><head>\n<title>" + window.getCaption() + "</title>\n");
  page.write("<NOSCRIPT><META http-equiv=\"refresh\" content=\"0; url=?WA_NOSCRIPT=1\" /></NOSCRIPT>\n");
  page.write("<link rel=\"stylesheet\" href=\"" + resourcePath + theme.getName()+ "/css/compiledstyle.css\" type=\"text/css\" />\n");
  page.write("<script type=\"text/javascript\" src=\"" + resourcePath + theme.getName()+ "/script/compiledjavascript.js\"></script>");
  page.write("</head><body class=\"itmtk\">\n");
  page.write("<div id=\"ajax-wait\">Loading...</div>\n");
  page.write("<div id=\"ajax-window\"></div>\n");
  page.write("<script language=\"JavaScript\">\n");
  String[] urlParts=getApplicationUrl(request).toString().split("\\/");
  String appUrl="";
  for (int i=3; i < urlParts.length; i++)   appUrl+="/" + urlParts[i];
  if (appUrl.endsWith("/"))   appUrl=appUrl.substring(0,appUrl.length() - 1);
  page.write("itmill.tmp = new itmill.Client(" + "document.getElementById('ajax-window')," + "\"" + appUrl + "/UIDL/"+ "\",\""+ resourcePath+ theme.getName()+ "/"+ "client/\",document.getElementById('ajax-wait'));\n");
  String themeObjName="itmill.themes." + theme.getName().substring(0,1).toUpperCase() + theme.getName().substring(1);
  page.write(" (new " + themeObjName + "(\""+ resourcePath+ theme.getName()+ "/\")).registerTo(itmill.tmp);\n");
  if (isDebugMode(unhandledParameters))   page.write("itmill.tmp.debugEnabled =true;\n");
  page.write("itmill.tmp.start();\n");
  page.write("delete itmill.tmp;\n");
  page.write("</script>\n");
  page.write("</body></html>\n");
  page.close();
}

{
  final Date start=new Date();
  String jsonText=response.getText();
  jsonText=jsonText.substring(9,jsonText.length() - 1);
  JSONValue json;
  try {
    json=JSONParser.parse(jsonText);
  }
 catch (  final com.google.gwt.json.client.JSONException e) {
    endRequest();
    console.log(e.getMessage() + " - Original JSON-text:");
    console.log(jsonText);
    return;
  }
  final JSONObject redirect=(JSONObject)((JSONObject)json).get("redirect");
  if (redirect != null) {
    final JSONString url=(JSONString)redirect.get("url");
    if (url != null) {
      console.log("redirecting to " + url.stringValue());
      redirect(url.stringValue());
      return;
    }
  }
  final JSONObject resources=(JSONObject)((JSONObject)json).get("resources");
  for (final Iterator i=resources.keySet().iterator(); i.hasNext(); ) {
    final String key=(String)i.next();
    resourcesMap.put(key,((JSONString)resources.get(key)).stringValue());
  }
  if (((JSONObject)json).containsKey("locales")) {
    final JSONArray l=(JSONArray)((JSONObject)json).get("locales");
    for (int i=0; i < l.size(); i++) {
      LocaleService.addLocale((JSONObject)l.get(i));
    }
  }
  JSONObject meta=null;
  if (((JSONObject)json).containsKey("meta")) {
    meta=((JSONObject)json).get("meta").isObject();
    if (meta.containsKey("repaintAll")) {
      view.clear();
      idToPaintable.clear();
      paintableToId.clear();
    }
  }
  final JSONArray changes=(JSONArray)((JSONObject)json).get("changes");
  for (int i=0; i < changes.size(); i++) {
    try {
      final UIDL change=new UIDL((JSONArray)changes.get(i));
      try {
        console.dirUIDL(change);
      }
 catch (      final Exception e) {
        console.log(e.getMessage());
      }
      final UIDL uidl=change.getChildUIDL(0);
      final Paintable paintable=getPaintable(uidl.getId());
      if (paintable != null) {
        paintable.updateFromUIDL(uidl,this);
      }
 else {
        if (!uidl.getTag().equals("window")) {
          System.out.println("Received update for " + uidl.getTag() + ", but there is no such paintable ("+ uidl.getId()+ ") rendered.");
        }
 else {
          view.updateFromUIDL(uidl,this);
        }
      }
    }
 catch (    final Throwable e) {
      e.printStackTrace();
    }
  }
  if (meta != null) {
    if (meta.containsKey("focus")) {
      final String focusPid=meta.get("focus").isString().stringValue();
      final Paintable toBeFocused=getPaintable(focusPid);
      if (toBeFocused instanceof HasFocus) {
        final HasFocus toBeFocusedWidget=(HasFocus)toBeFocused;
        toBeFocusedWidget.setFocus(true);
      }
 else       if (toBeFocused instanceof Focusable) {
        ((Focusable)toBeFocused).focus();
      }
 else {
        getConsole().log("Could not focus component");
      }
    }
    if (meta.containsKey("appError")) {
      JSONObject error=meta.get("appError").isObject();
      JSONValue val=error.get("caption");
      String html="";
      if (val.isString() != null) {
        html+="<h1>" + val.isString().stringValue() + "</h1>";
      }
      val=error.get("message");
      if (val.isString() != null) {
        html+="<p>" + val.isString().stringValue() + "</p>";
      }
      val=error.get("url");
      String url=null;
      if (val.isString() != null) {
        url=val.isString().stringValue();
      }
      if (html.length() != 0) {
        Notification n=new Notification(1000 * 60 * 45);
        n.addEventListener(new NotificationRedirect(url));
        n.show(html,Notification.CENTERED_TOP,"system");
      }
 else {
        redirect(url);
      }
      applicationRunning=false;
    }
  }
  final long prosessingTime=(new Date().getTime()) - start.getTime();
  console.log(" Processing time was " + String.valueOf(prosessingTime) + "ms for "+ jsonText.length()+ " characters of JSON");
  console.log("Referenced paintables: " + idToPaintable.size());
  endRequest();
}

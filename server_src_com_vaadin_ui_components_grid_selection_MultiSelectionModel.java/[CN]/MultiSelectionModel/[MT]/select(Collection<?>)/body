{
  if (itemIds == null) {
    throw new IllegalArgumentException("itemIds may not be null");
  }
  final boolean selectionWillChange=!selection.containsAll(itemIds) && selection.size() < selectionLimit;
  if (selectionWillChange) {
    final HashSet<Object> oldSelection=new HashSet<Object>(selection);
    if (selection.size() + itemIds.size() >= selectionLimit) {
      Iterator<?> iterator=itemIds.iterator();
      while (iterator.hasNext() && selection.size() < selectionLimit) {
        selection.add(iterator.next());
      }
    }
 else {
      selection.addAll(itemIds);
    }
    fireSelectionChangeEvent(oldSelection,selection);
  }
  return selectionWillChange;
}

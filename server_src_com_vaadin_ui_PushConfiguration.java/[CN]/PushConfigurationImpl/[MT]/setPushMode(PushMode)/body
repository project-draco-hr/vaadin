{
  if (pushMode == null) {
    throw new IllegalArgumentException("Push mode cannot be null");
  }
  if (pushMode.isEnabled()) {
    VaadinSession session=ui.getSession();
    if (session != null && !session.getService().ensurePushAvailable()) {
      throw new IllegalStateException("Push is not available. See previous log messages for more information.");
    }
  }
  getState().mode=pushMode;
}

{
  if (!(type.equals(Boolean.class) || type.equals(Integer.class) || type.equals(String.class)|| type.equals(String[].class)|| type.equals(UploadStream.class)))   throw new SystemError("Unsupported variable type: " + type.getClass());
synchronized (mapLock) {
    HashMap nameToIdMap=(HashMap)ownerToNameToIdMap.get(owner);
    if (nameToIdMap == null) {
      nameToIdMap=new HashMap();
      ownerToNameToIdMap.put(owner,nameToIdMap);
    }
    String id=(String)nameToIdMap.get(name);
    if (id == null) {
      Object pid=ApplicationManager.paintableIdMap.get(owner);
      id=pid + "_" + name;
      nameToIdMap.put(name,id);
      idToOwnerMap.put(id,new WeakReference(owner));
      idToNameMap.put(id,name);
      idToTypeMap.put(id,type);
    }
    idToValueMap.put(id,value);
    return id;
  }
}

{
  if (sender == text) {
    DateLocale.SUPPORTED_DF_TOKENS=DateLocale.TOKENS_RESOLUTION_ALL;
    if (currentResolution == IDateField.RESOLUTION_YEAR)     DateLocale.SUPPORTED_DF_TOKENS=DateLocale.TOKENS_RESOLUTION_YEAR;
 else     if (currentResolution == IDateField.RESOLUTION_MONTH)     DateLocale.SUPPORTED_DF_TOKENS=DateLocale.TOKENS_RESOLUTION_MONTH;
 else     if (currentResolution == IDateField.RESOLUTION_DAY)     DateLocale.SUPPORTED_DF_TOKENS=DateLocale.TOKENS_RESOLUTION_DAY;
    String f=verifyFormat(dts.getDateFormat());
    if (currentResolution >= IDateField.RESOLUTION_HOUR)     f+=" " + (dts.isTwelveHourClock() ? DateLocale.TOKEN_HOUR_12 + DateLocale.TOKEN_HOUR_12 : DateLocale.TOKEN_HOUR_24 + DateLocale.TOKEN_HOUR_24) + dts.getClockDelimeter()+ DateLocale.TOKEN_MINUTE+ DateLocale.TOKEN_MINUTE;
    if (currentResolution >= IDateField.RESOLUTION_SEC)     f+=dts.getClockDelimeter() + DateLocale.TOKEN_SECOND + DateLocale.TOKEN_SECOND;
    if (currentResolution == IDateField.RESOLUTION_MSEC)     f+="." + DateLocale.TOKEN_MILLISECOND + DateLocale.TOKEN_MILLISECOND+ DateLocale.TOKEN_MILLISECOND;
    if (currentResolution >= IDateField.RESOLUTION_HOUR && dts.isTwelveHourClock())     f+=" " + DateLocale.TOKEN_AM_PM;
    format=new SimpleDateFormat(f);
    DateLocale.setLocale(currentLocale);
    format.setLocale(dl);
    try {
      date=format.parse(text.getText());
    }
 catch (    Exception e) {
      System.out.println(e);
      text.addStyleName(ITextField.CLASSNAME + "-error");
      Timer t=new Timer(){
        public void run(){
          text.removeStyleName(ITextField.CLASSNAME + "-error");
        }
      }
;
      t.schedule(2000);
      return;
    }
    client.updateVariable(id,"year",date.getYear() + 1900,currentResolution == IDateField.RESOLUTION_YEAR);
    if (currentResolution >= IDateField.RESOLUTION_MONTH)     client.updateVariable(id,"month",date.getMonth() + 1,currentResolution == IDateField.RESOLUTION_MONTH && immediate);
    if (currentResolution >= IDateField.RESOLUTION_DAY)     client.updateVariable(id,"day",date.getDate(),currentResolution == IDateField.RESOLUTION_DAY && immediate);
    if (currentResolution >= IDateField.RESOLUTION_HOUR)     client.updateVariable(id,"hour",date.getHours(),currentResolution == IDateField.RESOLUTION_HOUR && immediate);
    if (currentResolution >= IDateField.RESOLUTION_MIN)     client.updateVariable(id,"min",date.getMinutes(),currentResolution == IDateField.RESOLUTION_MIN && immediate);
    if (currentResolution >= IDateField.RESOLUTION_SEC)     client.updateVariable(id,"sec",date.getSeconds(),currentResolution == IDateField.RESOLUTION_SEC && immediate);
    if (currentResolution == IDateField.RESOLUTION_MSEC)     client.updateVariable(id,"msec",getMilliseconds(),immediate);
    buildTime();
  }
}

{
  if (sender == text) {
    if (!text.getText().equals("")) {
      try {
        date=DateTimeFormat.getFormat(getFormatString()).parse(text.getText());
        removeStyleName(PARSE_ERROR_CLASSNAME);
      }
 catch (      final Exception e) {
        ApplicationConnection.getConsole().log(e.getMessage());
        addStyleName(PARSE_ERROR_CLASSNAME);
        client.updateVariable(id,"lastInvalidDateString",text.getText(),false);
        date=null;
      }
    }
 else {
      date=null;
      removeStyleName(PARSE_ERROR_CLASSNAME);
    }
    showingDate=new Date(date.getTime());
    client.updateVariable(id,"year",date != null ? date.getYear() + 1900 : -1,currentResolution == IDateField.RESOLUTION_YEAR && immediate);
    if (currentResolution >= IDateField.RESOLUTION_MONTH) {
      client.updateVariable(id,"month",date != null ? date.getMonth() + 1 : -1,currentResolution == IDateField.RESOLUTION_MONTH && immediate);
    }
    if (currentResolution >= IDateField.RESOLUTION_DAY) {
      client.updateVariable(id,"day",date != null ? date.getDate() : -1,currentResolution == IDateField.RESOLUTION_DAY && immediate);
    }
    if (currentResolution >= IDateField.RESOLUTION_HOUR) {
      client.updateVariable(id,"hour",date != null ? date.getHours() : -1,currentResolution == IDateField.RESOLUTION_HOUR && immediate);
    }
    if (currentResolution >= IDateField.RESOLUTION_MIN) {
      client.updateVariable(id,"min",date != null ? date.getMinutes() : -1,currentResolution == IDateField.RESOLUTION_MIN && immediate);
    }
    if (currentResolution >= IDateField.RESOLUTION_SEC) {
      client.updateVariable(id,"sec",date != null ? date.getSeconds() : -1,currentResolution == IDateField.RESOLUTION_SEC && immediate);
    }
    if (currentResolution == IDateField.RESOLUTION_MSEC) {
      client.updateVariable(id,"msec",date != null ? getMilliseconds() : -1,immediate);
    }
  }
}

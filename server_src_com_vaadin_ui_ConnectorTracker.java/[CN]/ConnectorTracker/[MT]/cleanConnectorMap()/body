{
  Iterator<String> iterator=connectorIdToConnector.keySet().iterator();
  while (iterator.hasNext()) {
    String connectorId=iterator.next();
    ClientConnector connector=connectorIdToConnector.get(connectorId);
    if (getUIForConnector(connector) != uI) {
      getLogger().warning("cleanConnectorMap unregistered connector " + getConnectorAndParentInfo(connector) + "). This should have been done when the connector was detached.");
      removeFromGlobalResourceHandler(connector);
      uninitializedConnectors.remove(connector);
      diffStates.remove(connector);
      iterator.remove();
    }
 else     if (!AbstractCommunicationManager.isConnectorVisibleToClient(connector) && !uninitializedConnectors.contains(connector)) {
      uninitializedConnectors.add(connector);
      diffStates.remove(connector);
      getLogger().fine("cleanConnectorMap removed state for " + getConnectorAndParentInfo(connector) + " as it is not visible");
    }
  }
  cleanStreamVariables();
}

{
  HttpSession s=request.getSession();
  WebBrowser browser=getTerminalType(s);
  if (browser != null) {
    if (parameters.containsKey(WA_NOSCRIPT)) {
      String val=((String[])parameters.get(WA_NOSCRIPT))[0];
      if (val != null && "1".equals(val)) {
        browser.setJavaScriptVersion(WebBrowser.JAVASCRIPT_NONE);
        browser.setClientSideChecked(true);
      }
 else {
        browser.setClientSideChecked(false);
      }
    }
    if (browser.isClientSideChecked())     return false;
  }
  browser=probe(browser,request,parameters);
  setTerminalType(s,browser);
  if (parameters.containsKey("wa_clientprobe")) {
    String val=((String[])parameters.get("wa_clientprobe"))[0];
    browser.setClientSideChecked(val != null && "1".equals(val));
  }
  return browser.performClientCheck() && !browser.isClientSideChecked();
}

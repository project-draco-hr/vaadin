{
  Map<Class<?>,CurrentInstance> old=new HashMap<Class<?>,CurrentInstance>();
  old.put(VaadinSession.class,new CurrentInstance(getSameOrNullObject(VaadinSession.getCurrent()),true));
  old.put(VaadinService.class,new CurrentInstance(getSameOrNullObject(VaadinService.getCurrent()),true));
  VaadinService service=null;
  if (session != null) {
    service=session.getService();
  }
  VaadinSession.setCurrent(session);
  VaadinService.setCurrent(service);
  return old;
}

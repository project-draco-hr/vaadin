{
  if (VCaption.isNeeded(uidl)) {
    VCaption caption=captions.get(component);
    if (caption == null) {
      caption=new VCaption(component,client);
      Widget widget=(Widget)component;
      Element wrapper=getWrapper(widget);
      getChildren().add(caption);
      DOM.insertBefore((com.google.gwt.user.client.Element)wrapper.cast(),caption.getElement(),widget.getElement());
      adopt(caption);
      captions.put(component,caption);
      MeasureManager.MeasuredSize measuredSize=client.getMeasuredSize(component);
      measuredSize.registerDependency(caption.getElement());
    }
    caption.updateCaption(uidl);
  }
 else {
    VCaption removedCaption=captions.remove(component);
    if (removedCaption != null) {
      remove(removedCaption);
      MeasureManager.MeasuredSize measuredSize=client.getMeasuredSize(component);
      measuredSize.deRegisterDependency(removedCaption.getElement());
    }
  }
}

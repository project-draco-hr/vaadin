{
  Collection<VPaintableWidget> children=MeasureManager.getChildren(this,client);
  int totalAllocated=0;
  double totalExpand=0;
  for (  VPaintableWidget child : children) {
    Widget widget=child.getWidgetForPaintable();
    totalExpand+=getExpandRatio(child);
    int captionAllocation;
    if (isVertical) {
      captionAllocation=getCaptionHeight(child);
      getWrapper(widget).getStyle().setPaddingTop(captionAllocation,Unit.PX);
    }
 else {
      captionAllocation=0;
    }
    if (!isRelativeInDirection(widget,isVertical)) {
      totalAllocated+=getMeasuredInDirection(child,isVertical) + captionAllocation;
    }
  }
  int startMargin=getStartMarginInDirection(isVertical);
  int totalMargins=startMargin + getEndMarginInDirection(isVertical);
  totalAllocated+=totalMargins + (getSpacingInDirection(isVertical) * (children.size() - 1));
  Style ownStyle=getElement().getStyle();
  double ownSize;
  if (isUndefinedInDirection(this,isVertical)) {
    ownSize=totalAllocated;
    ownStyle.setProperty(getMinPropertyName(isVertical),totalAllocated,Unit.PX);
  }
 else {
    ownSize=getMeasuredInDirection(this,isVertical);
    ownStyle.clearProperty(getMinPropertyName(isVertical));
  }
  double unallocatedSpace=Math.max(0,ownSize - totalAllocated);
  double currentLocation=startMargin;
  for (  VPaintableWidget child : children) {
    Widget widget=child.getWidgetForPaintable();
    Element wrapper=getWrapper(widget);
    Style wrapperStyle=wrapper.getStyle();
    double childExpandRatio;
    if (totalExpand == 0) {
      childExpandRatio=1d / children.size();
    }
 else {
      childExpandRatio=getExpandRatio(child) / totalExpand;
    }
    double extraPixels=unallocatedSpace * childExpandRatio;
    boolean relative=isRelativeInDirection(widget,isVertical);
    double size=getMeasuredInDirection(child,isVertical);
    int captionHeight=getCaptionHeight(child);
    if (isVertical) {
      size+=captionHeight;
    }
 else     if (!relative) {
      size=Math.max(size,getCaptionWidth(child));
    }
    double allocatedSpace=extraPixels;
    if (!relative) {
      allocatedSpace+=size;
    }
    int alignment=getAlignmentInDirection(getAlignment(child),isVertical);
    if (relative) {
      double captionReservation=isVertical ? captionHeight : 0;
      wrapperStyle.setProperty(getSizeProperty(isVertical),allocatedSpace - captionReservation,Unit.PX);
    }
 else {
      wrapperStyle.clearProperty(getSizeProperty(isVertical));
    }
    double startPosition=currentLocation;
    if (alignment == 0) {
      startPosition+=(allocatedSpace - size) / 2;
    }
 else     if (alignment == 1) {
      startPosition+=allocatedSpace - size;
    }
    wrapperStyle.setProperty(getStartProperty(isVertical),startPosition,Unit.PX);
    currentLocation+=allocatedSpace + getSpacingInDirection(isVertical);
  }
}

{
  VaadinRequest request=context.getRequest();
  VaadinSession session=context.getSession();
  VaadinService vaadinService=request.getService();
  JsonObject appConfig=Json.createObject();
  String themeName=context.getThemeName();
  if (themeName != null) {
    appConfig.put("theme",themeName);
  }
  if (request.getParameter(VaadinService.URL_PARAMETER_RESTART_APPLICATION) != null) {
    appConfig.put("extraParams","&" + IGNORE_RESTART_PARAM + "=1");
  }
  JsonObject versionInfo=Json.createObject();
  versionInfo.put("vaadinVersion",Version.getFullVersion());
  versionInfo.put("atmosphereVersion",org.atmosphere.util.Version.getRawVersion());
  appConfig.put("versionInfo",versionInfo);
  appConfig.put("widgetset",context.getWidgetsetName());
  Locale locale=ServletPortletHelper.findLocale(null,context.getSession(),context.getRequest());
  SystemMessages systemMessages=vaadinService.getSystemMessages(locale,request);
  if (systemMessages != null) {
    JsonObject comErrMsg=Json.createObject();
    comErrMsg.put("caption",systemMessages.getCommunicationErrorCaption());
    comErrMsg.put("message",systemMessages.getCommunicationErrorMessage());
    if (systemMessages.getCommunicationErrorURL() == null) {
      comErrMsg.put("url",Json.createNull());
    }
 else {
      comErrMsg.put("url",systemMessages.getCommunicationErrorURL());
    }
    appConfig.put("comErrMsg",comErrMsg);
    JsonObject authErrMsg=Json.createObject();
    authErrMsg.put("caption",systemMessages.getAuthenticationErrorCaption());
    authErrMsg.put("message",systemMessages.getAuthenticationErrorMessage());
    if (systemMessages.getAuthenticationErrorURL() == null) {
      authErrMsg.put("url",Json.createNull());
    }
 else {
      authErrMsg.put("url",systemMessages.getAuthenticationErrorURL());
    }
    appConfig.put("authErrMsg",authErrMsg);
    JsonObject sessExpMsg=Json.createObject();
    sessExpMsg.put("caption",systemMessages.getSessionExpiredCaption());
    sessExpMsg.put("message",systemMessages.getSessionExpiredMessage());
    if (systemMessages.getSessionExpiredURL() == null) {
      sessExpMsg.put("url",Json.createNull());
    }
 else {
      sessExpMsg.put("url",systemMessages.getSessionExpiredURL());
    }
    appConfig.put("sessExpMsg",sessExpMsg);
  }
  String vaadinDir=vaadinService.getStaticFileLocation(request) + "/VAADIN/";
  appConfig.put(ApplicationConstants.VAADIN_DIR_URL,vaadinDir);
  if (!session.getConfiguration().isProductionMode()) {
    appConfig.put("debug",true);
  }
  if (vaadinService.isStandalone(request)) {
    appConfig.put("standalone",true);
  }
  appConfig.put("heartbeatInterval",vaadinService.getDeploymentConfiguration().getHeartbeatInterval());
  String serviceUrl=getServiceUrl(context);
  if (serviceUrl != null) {
    appConfig.put(ApplicationConstants.SERVICE_URL,serviceUrl);
  }
  return appConfig;
}

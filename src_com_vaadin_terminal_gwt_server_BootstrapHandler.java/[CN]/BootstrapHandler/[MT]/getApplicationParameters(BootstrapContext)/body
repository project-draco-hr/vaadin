{
  Application application=context.getApplication();
  Integer rootId=context.getRootId();
  JSONObject appConfig=new JSONObject();
  if (rootId != null) {
    appConfig.put(ApplicationConnection.ROOT_ID_PARAMETER,rootId);
  }
  if (context.getThemeName() != null) {
    appConfig.put("themeUri",getThemeUri(context,context.getThemeName()));
  }
  JSONObject versionInfo=new JSONObject();
  versionInfo.put("vaadinVersion",Version.getFullVersion());
  versionInfo.put("applicationVersion",application.getVersion());
  appConfig.put("versionInfo",versionInfo);
  appConfig.put("widgetset",context.getWidgetsetName());
  if (rootId == null || application.isRootInitPending(rootId.intValue())) {
    appConfig.put("initialPath",context.getRequest().getRequestPathInfo());
    Map<String,String[]> parameterMap=context.getRequest().getParameterMap();
    appConfig.put("initialParams",parameterMap);
  }
 else {
    appConfig.put("uidl",getInitialUIDL(context.getRequest(),context.getRoot()));
  }
  return appConfig;
}

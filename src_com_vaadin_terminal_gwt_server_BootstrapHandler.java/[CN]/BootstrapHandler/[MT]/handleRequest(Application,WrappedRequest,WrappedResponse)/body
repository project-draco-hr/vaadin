{
  Integer rootId=null;
  try {
    Root root=application.getRootForRequest(request);
    if (root == null) {
      writeError(response,new Throwable("No Root found"));
      return true;
    }
    rootId=Integer.valueOf(root.getRootId());
  }
 catch (  RootRequiresMoreInformationException e) {
  }
  try {
    Map<String,Object> headers=new LinkedHashMap<String,Object>();
    BootstrapContext context=createContext(request,response,application,rootId,headers);
    BootstrapResponse bootstrapResponse=context.getBootstrapResponse();
    setupMainDiv(context);
    DeploymentConfiguration deploymentConfiguration=request.getDeploymentConfiguration();
    boolean standalone=deploymentConfiguration.isStandalone(request);
    if (standalone) {
      setupStandaloneDocument(context);
      deploymentConfiguration.getVaadinContext().fireModifyBootstrapEvent(bootstrapResponse);
      sendBootstrapHeaders(response,headers);
      writeBootstrapPage(response,bootstrapResponse.getDocument());
    }
 else {
      deploymentConfiguration.getVaadinContext().fireModifyBootstrapEvent(bootstrapResponse);
      writeBootstrapPage(response,bootstrapResponse.getApplicationTag());
    }
  }
 catch (  JSONException e) {
    writeError(response,e);
  }
  return true;
}

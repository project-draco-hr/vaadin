{
  Object id=tree.getValue();
  if (event.getProperty() == tree) {
    if (id == null) {
      editor.removeListener(this);
      editor.setValue("");
      editor.setEnabled(false);
    }
 else {
      editor.removeListener(this);
      editor.setEnabled(true);
      Item item=tree.getItem(id);
      editor.setValue(item.getItemProperty(CAPTION_PROPERTY).getValue());
      editor.addListener(this);
      editor.focus();
    }
  }
 else {
    if (id != null) {
      Item item=tree.getItem(id);
      Property p=item.getItemProperty(CAPTION_PROPERTY);
      p.setValue(editor.getValue());
      tree.requestRepaint();
    }
  }
}

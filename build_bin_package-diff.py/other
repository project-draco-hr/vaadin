import sys, os, re
from sets import Set
downloadsite = 'http://vaadin.com/download'
latestfile = '/LATEST'
wgetcmd = ('wget -q -O - %s' % (downloadsite + latestfile))
pin = os.popen(wgetcmd, 'r')
latestdata = pin.readlines()
pin.close()
latestversion = latestdata[0].strip()
latestpath = latestdata[1].strip()
latestURL = (((downloadsite + '/') + latestpath) + '/')
filename = ('vaadin-%s.tar.gz' % latestversion)
package = (latestURL + filename)
localpackage = ('/tmp/%s' % filename)
print ('Latest version:      %s' % latestversion)
print ('Latest version path: %s' % latestpath)
print ('Latest version URL:  %s' % latestURL)
try:
    os.stat(localpackage)
    print ('Latest package already exists in %s' % localpackage)
except OSError:
    print ('Downloading package %s to %s' % (package, localpackage))
    wgetcmd = ('wget -q -O %s %s' % (localpackage, package))
    command(wgetcmd)
latestfiles = listfiles(localpackage)
builtversion = sys.argv[1]
builtpackage = ('build/result/vaadin-%s.zip' % builtversion)
builtfiles = listZipFiles(builtpackage)
print '\n--------------------------------------------------------------------------------\nVaadin TAR differences'
newfiles = diffFiles(builtfiles, latestfiles)
print ('\n%d new files:' % len(newfiles))
for item in newfiles:
    print item
removed = diffFiles(latestfiles, builtfiles)
print ('\n%d removed files:' % len(removed))
for item in removed:
    print item
print '\n--------------------------------------------------------------------------------\nVaadin JAR differences'
latestJarFiles = listTarVaadinJarFiles(localpackage, latestversion)
builtJarFiles = listZipVaadinJarFiles(builtpackage, builtversion)
newfiles = diffFiles(builtJarFiles, latestJarFiles)
print ('\n%d new files:' % len(newfiles))
for item in newfiles:
    print item
removed = diffFiles(latestJarFiles, builtJarFiles)
print ('\n%d removed files:' % len(removed))
for item in removed:
    print item
command(('rm %s' % localpackage))

{
  if (isLayoutRunning()) {
    throw new IllegalStateException("Can't start a new layout phase before the previous layout phase ends.");
  }
  layoutPending=false;
  layoutTimer.cancel();
  try {
    currentDependencyTree=new LayoutDependencyTree(connection);
    doLayout();
  }
  finally {
    currentDependencyTree=null;
  }
}

{
  if (!isFieldsBuffered()) {
    return;
  }
  for (  Field<?> f : fieldToPropertyId.keySet()) {
    ((TransactionalProperty<?>)f.getPropertyDataSource()).startTransaction();
  }
  try {
    firePreCommitEvent();
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      f.commit();
    }
    firePostCommitEvent();
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      ((TransactionalProperty<?>)f.getPropertyDataSource()).commit();
    }
  }
 catch (  Exception e) {
    for (    Field<?> f : fieldToPropertyId.keySet()) {
      try {
        ((TransactionalProperty<?>)f.getPropertyDataSource()).rollback();
      }
 catch (      Exception rollbackException) {
      }
    }
    throw new CommitException("Commit failed",e);
  }
}

{
  List<InvalidLayout> invalidComponentRelativeSizes=null;
  if (analyzeLayouts) {
    invalidComponentRelativeSizes=ComponentSizeValidator.validateComponentRelativeSizes(ui.getContent(),null,null);
    if (ui.getWindows() != null) {
      for (      Window subWindow : ui.getWindows()) {
        invalidComponentRelativeSizes=ComponentSizeValidator.validateComponentRelativeSizes(subWindow.getContent(),invalidComponentRelativeSizes,null);
      }
    }
  }
  writer.write("{");
  boolean metaOpen=false;
  if (repaintAll) {
    metaOpen=true;
    writer.write("\"repaintAll\":true");
    if (analyzeLayouts) {
      writer.write(", \"invalidLayouts\":");
      writer.write("[");
      if (invalidComponentRelativeSizes != null) {
        boolean first=true;
        for (        InvalidLayout invalidLayout : invalidComponentRelativeSizes) {
          if (!first) {
            writer.write(",");
          }
 else {
            first=false;
          }
          invalidLayout.reportErrors(new PrintWriter(writer),System.err);
        }
      }
      writer.write("]");
    }
    if (hilightedConnector != null) {
      writer.write(", \"hl\":\"");
      writer.write(hilightedConnector.getConnectorId());
      writer.write("\"");
    }
  }
  if (messages != null && messages.getSessionExpiredMessage() == null && messages.getSessionExpiredCaption() == null && messages.isSessionExpiredNotificationEnabled()) {
    int newTimeoutInterval=ui.getSession().getSession().getMaxInactiveInterval();
    if (repaintAll || (timeoutInterval != newTimeoutInterval)) {
      String escapedURL=messages.getSessionExpiredURL() == null ? "" : messages.getSessionExpiredURL().replace("/","\\/");
      if (metaOpen) {
        writer.write(",");
      }
      writer.write("\"timedRedirect\":{\"interval\":" + (newTimeoutInterval + 15) + ",\"url\":\""+ escapedURL+ "\"}");
      metaOpen=true;
    }
    timeoutInterval=newTimeoutInterval;
  }
  writer.write("}");
}

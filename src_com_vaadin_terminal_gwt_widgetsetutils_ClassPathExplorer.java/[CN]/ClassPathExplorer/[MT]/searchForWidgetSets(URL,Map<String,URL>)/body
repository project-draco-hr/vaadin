{
  File directory=new File(location.getFile());
  if (directory.exists() && !directory.isHidden()) {
    String[] files=directory.list();
    for (int i=0; i < files.length; i++) {
      if (files[i].endsWith(".gwt.xml")) {
        String classname=files[i].substring(0,files[i].length() - 8);
        classname=classpathLocations.get(location) + "." + classname;
        if (!widgetsets.containsKey(classname)) {
          String packageName=classpathLocations.get(location);
          String packagePath=packageName.replaceAll("\\.","/");
          String basePath=location.getFile().replaceAll("/" + packagePath + "$","");
          try {
            URL url=new URL(location.getProtocol(),location.getHost(),location.getPort(),basePath);
            widgetsets.put(classname,url);
          }
 catch (          MalformedURLException e) {
            e.printStackTrace();
          }
        }
      }
    }
  }
 else {
    try {
      URLConnection openConnection=location.openConnection();
      if (openConnection instanceof JarURLConnection) {
        JarURLConnection conn=(JarURLConnection)openConnection;
        JarFile jarFile=conn.getJarFile();
        Manifest manifest=jarFile.getManifest();
        String value=manifest.getMainAttributes().getValue("Vaadin-Widgetsets");
        if (value != null) {
          String[] widgetsetNames=value.split(",");
          for (int i=0; i < widgetsetNames.length; i++) {
            String widgetsetname=widgetsetNames[i].trim().intern();
            widgetsets.put(widgetsetname,location);
          }
        }
      }
    }
 catch (    IOException e) {
      System.err.println(e);
    }
  }
}

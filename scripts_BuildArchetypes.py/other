import subprocess
from BuildHelpers import mavenValidate, copyWarFiles, repo, getLogFile, mavenCmd, updateRepositories, getArgs, removeDir
from DeployHelpers import deployWar
archetypeGroup = 'com.vaadin'
archetypes = ['vaadin-archetype-widget', 'vaadin-archetype-application', 'vaadin-archetype-application-example', 'vaadin-archetype-application-multimodule']
group = 'testpkg'
log = None
args = None
if (__name__ == '__main__'):
    args = getArgs()
    for archetype in archetypes:
        try:
            log = getLogFile(archetype)
            artifactId = generateArchetype(archetype)
            updateRepositories(artifactId)
            mavenValidate(artifactId, logFile=log)
            warFiles = copyWarFiles(artifactId, name=archetype)
            for war in warFiles:
                try:
                    deployWar(war, ('%s.war' % archetype.split('-', 2)[2]))
                except Exception as e:
                    print ('War %s failed to deploy: %s' % (war, e))
        except:
            print ('Archetype %s build failed' % archetype)
        removeDir(artifactId)
        print ''

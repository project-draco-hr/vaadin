{
  DesiredCapabilities capabilities;
  Browser runLocallyBrowser=getRunLocallyBrowser();
  if (runLocallyBrowser != null) {
    if (System.getenv().containsKey("TEAMCITY_VERSION")) {
      throw new RuntimeException("@RunLocally is not supported for tests run on the build server");
    }
    capabilities=runLocallyBrowser.getDesiredCapabilities();
    setupLocalDriver(capabilities);
  }
 else {
    capabilities=getDesiredCapabilities();
    if (localWebDriverIsUsed()) {
      setupLocalDriver(capabilities);
    }
 else {
      WebDriver dr=TestBench.createDriver(new RemoteWebDriver(new URL(getHubURL()),capabilities));
      setDriver(dr);
    }
  }
  int w=SCREENSHOT_WIDTH;
  int h=SCREENSHOT_HEIGHT;
  if (BrowserUtil.isIE8(capabilities)) {
    w+=4;
    h+=4;
  }
  try {
    testBench().resizeViewPortTo(w,h);
  }
 catch (  UnsupportedOperationException e) {
  }
}

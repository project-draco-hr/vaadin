{
  atmosphere=new AtmosphereFramework();
  pushHandler=new PushHandler(service);
  atmosphere.addAtmosphereHandler("/*",pushHandler);
  atmosphere.addInitParameter(ApplicationConfig.PROPERTY_SESSION_SUPPORT,"true");
  final String bufferSize=String.valueOf(ApplicationConstants.WEBSOCKET_BUFFER_SIZE);
  atmosphere.addInitParameter(ApplicationConfig.WEBSOCKET_BUFFER_SIZE,bufferSize);
  atmosphere.addInitParameter(ApplicationConfig.WEBSOCKET_MAXTEXTSIZE,bufferSize);
  atmosphere.addInitParameter(ApplicationConfig.WEBSOCKET_MAXBINARYSIZE,bufferSize);
  atmosphere.addInitParameter("org.atmosphere.cpr.showSupportMessage","false");
  atmosphere.interceptor(new TrackMessageSizeInterceptor());
  try {
    atmosphere.init(service.getServlet().getServletConfig());
  }
 catch (  ServletException e) {
    throw new ServiceException("Could not read atmosphere settings",e);
  }
}

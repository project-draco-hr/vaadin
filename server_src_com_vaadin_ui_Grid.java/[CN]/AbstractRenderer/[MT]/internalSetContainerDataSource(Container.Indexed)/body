{
  if (container == null) {
    throw new IllegalArgumentException("Cannot set the datasource to null");
  }
  if (datasource == container) {
    return;
  }
  if (datasource instanceof PropertySetChangeNotifier) {
    ((PropertySetChangeNotifier)datasource).removePropertySetChangeListener(propertyListener);
  }
  if (datasourceExtension != null) {
    removeExtension(datasourceExtension);
  }
  datasource=container;
  if (editorRow != null) {
    editorRow.detach();
  }
  editorRow=new EditorRow(this);
  if (container instanceof Container.Sortable) {
    Collection<?> sortableProps=((Container.Sortable)getContainerDatasource()).getSortableContainerPropertyIds();
    Iterator<SortOrder> i=sortOrder.iterator();
    while (i.hasNext()) {
      if (!sortableProps.contains(i.next().getPropertyId())) {
        i.remove();
      }
    }
    sort(SortEventOriginator.API);
  }
 else {
    clearSortOrder();
  }
  datasourceExtension=new RpcDataProviderExtension(container);
  datasourceExtension.extend(this,columnKeys);
  if (selectionModel != null) {
    selectionModel.reset();
  }
  if (datasource instanceof PropertySetChangeNotifier) {
    ((PropertySetChangeNotifier)datasource).addPropertySetChangeListener(propertyListener);
  }
  setLastFrozenPropertyId(null);
  if (columns.isEmpty()) {
    for (    Object propertyId : datasource.getContainerPropertyIds()) {
      Column column=appendColumn(propertyId);
      if (datasource instanceof Sortable) {
        column.setSortable(((Sortable)datasource).getSortableContainerPropertyIds().contains(propertyId));
      }
    }
  }
 else {
    Collection<?> properties=datasource.getContainerPropertyIds();
    for (    Object property : columns.keySet()) {
      if (!properties.contains(property)) {
        throw new IllegalStateException("Found at least one column in Grid that does not exist in the given container: " + property + " with the header \""+ getColumn(property).getHeaderCaption()+ "\"");
      }
    }
  }
}

{
  TabSheetCaption c=tb.getTab(index);
  if (c == null) {
    c=new TabSheetCaption();
    tb.addTab(c);
  }
  c.updateCaption(tabUidl);
  String styleName=tabUidl.getStringAttribute(TAB_STYLE_NAME);
  String oldStyleName=tabStyles.get(index);
  Element td=(Element)tb.tr.getChild(index);
  if (styleName != null && styleName.length() != 0) {
    if (!styleName.equals(oldStyleName)) {
      if (oldStyleName != null && oldStyleName.length() != 0) {
        td.removeClassName(ITEMCELL_CLASSNAME + "-" + oldStyleName);
      }
      td.addClassName(ITEMCELL_CLASSNAME + "-" + styleName);
      tabStyles.set(index,styleName);
    }
  }
 else   if (oldStyleName != null) {
    td.removeClassName(ITEMCELL_CLASSNAME + "-" + oldStyleName);
    tabStyles.set(index,null);
  }
  c.setHidden(hidden);
  if (scrolledOutOfView(index)) {
    hidden=true;
  }
  tb.setVisible(index,!hidden);
  c.setWidth(c.getRequiredWidth() + "px");
  captions.put("" + index,c);
  UIDL tabContentUIDL=null;
  Paintable tabContent=null;
  if (tabUidl.getChildCount() > 0) {
    tabContentUIDL=tabUidl.getChildUIDL(0);
    tabContent=client.getPaintable(tabContentUIDL);
  }
  if (tabContent != null) {
    int oldIndex=tp.getWidgetIndex((Widget)tabContent);
    if (oldIndex != -1 && oldIndex != index) {
      tp.insert((Widget)tabContent,index);
    }
  }
 else {
    if (index < tp.getWidgetCount()) {
      Widget oldWidget=tp.getWidget(index);
      if (!(oldWidget instanceof PlaceHolder)) {
        tp.insert(new PlaceHolder(),index);
      }
    }
  }
  if (selected) {
    renderContent(tabContentUIDL);
    tb.selectTab(index);
  }
 else {
    if (tabContentUIDL != null) {
      if (tp.getWidgetIndex((Widget)tabContent) < 0) {
        tp.insert((Widget)tabContent,index);
      }
      tabContent.updateFromUIDL(tabContentUIDL,client);
    }
 else     if (tp.getWidgetCount() <= index) {
      tp.add(new PlaceHolder());
    }
  }
}

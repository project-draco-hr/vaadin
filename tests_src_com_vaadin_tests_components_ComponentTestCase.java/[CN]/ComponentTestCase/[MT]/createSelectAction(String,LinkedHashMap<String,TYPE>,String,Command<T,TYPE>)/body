{
  final String CAPTION="caption";
  final String VALUE="value";
  final NativeSelect select=new NativeSelect(caption);
  select.addContainerProperty(CAPTION,String.class,"");
  select.addContainerProperty(VALUE,Object.class,"");
  select.setItemCaptionPropertyId(CAPTION);
  select.setNullSelectionAllowed(false);
  for (  String itemCaption : options.keySet()) {
    Object itemId=new Object();
    Item i=select.addItem(itemId);
    i.getItemProperty(CAPTION).setValue(itemCaption);
    i.getItemProperty(VALUE).setValue(options.get(itemCaption));
    if (itemCaption.equals(initialValue)) {
      select.setValue(itemId);
    }
  }
  select.addListener(new Property.ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Object itemId=event.getProperty().getValue();
      Item item=select.getItem(itemId);
      @SuppressWarnings("unchecked") TYPE value=(TYPE)item.getItemProperty(VALUE).getValue();
      doCommand(command,value);
    }
  }
);
  select.setValue(initialValue);
  select.setImmediate(true);
  return select;
}

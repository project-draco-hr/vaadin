{
  if (currentTooltipInfo.hasMessage()) {
    setPopupPosition(0,0);
    setPopupPositionAndShow(new PositionCallback(){
      @Override public void setPosition(      int offsetWidth,      int offsetHeight){
        if (offsetWidth > getMaxWidth()) {
          setWidth(getMaxWidth() + "px");
          offsetWidth=getOffsetWidth();
          offsetHeight=getOffsetHeight();
        }
        int x=getFinalX(offsetWidth);
        int y=getFinalY(offsetHeight);
        setPopupPosition(x,y);
        sinkEvents(Event.ONMOUSEOVER | Event.ONMOUSEOUT);
      }
      /** 
 * Return the final X-coordinate of the tooltip based on cursor
 * position, size of the tooltip, size of the page and necessary
 * margins.
 * @param offsetWidth
 * @return The final X-coordinate
 */
      private int getFinalX(      int offsetWidth){
        int x=0;
        int widthNeeded=10 + MARGIN + offsetWidth;
        int roomLeft=tooltipEventMouseX;
        int roomRight=Window.getClientWidth() - roomLeft;
        if (roomRight > widthNeeded) {
          x=tooltipEventMouseX + 10 + Window.getScrollLeft();
        }
 else {
          x=tooltipEventMouseX + Window.getScrollLeft() - 10 - offsetWidth;
        }
        if (x + offsetWidth + MARGIN - Window.getScrollLeft() > Window.getClientWidth()) {
          x=Window.getClientWidth() - offsetWidth - MARGIN + Window.getScrollLeft();
        }
        int minX=Window.getScrollLeft() + MARGIN;
        x=Math.max(x,minX);
        return x;
      }
      /** 
 * Return the final Y-coordinate of the tooltip based on cursor
 * position, size of the tooltip, size of the page and necessary
 * margins.
 * @param offsetHeight
 * @return The final y-coordinate
 */
      private int getFinalY(      int offsetHeight){
        int y=0;
        int heightNeeded=10 + MARGIN + offsetHeight;
        int roomAbove=tooltipEventMouseY;
        int roomBelow=Window.getClientHeight() - roomAbove;
        if (roomBelow > heightNeeded) {
          y=tooltipEventMouseY + 10 + Window.getScrollTop();
        }
 else {
          y=tooltipEventMouseY + Window.getScrollTop() - 10 - offsetHeight;
        }
        if (y + offsetHeight + MARGIN - Window.getScrollTop() > Window.getClientHeight()) {
          y=tooltipEventMouseY - 5 - offsetHeight + Window.getScrollTop();
          if (y - Window.getScrollTop() < 0) {
            y=Window.getScrollTop();
          }
        }
        int minY=Window.getScrollTop() + MARGIN;
        y=Math.max(y,minY);
        return y;
      }
    }
);
  }
 else {
    hide();
  }
}

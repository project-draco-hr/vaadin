{
  Event event=Event.as(domEvent.getNativeEvent());
  Element element=Element.as(event.getEventTarget());
  if (currentElement == element && handledByFocus == true) {
    return;
  }
  if (currentElement != null && isActuallyVisible()) {
    TooltipInfo currentTooltip=getTooltipFor(currentElement);
    TooltipInfo newTooltip=getTooltipFor(element);
    if (currentTooltip != null && currentTooltip.equals(newTooltip)) {
      return;
    }
  }
  TooltipInfo info=getTooltipFor(element);
  if (info == null) {
    handleHideEvent();
  }
 else {
    if (closing) {
      closeTimer.cancel();
      closing=false;
    }
    setTooltipText(info);
    updatePosition(event,isFocused);
    if (isActuallyVisible() && !isFocused) {
      showTooltip();
    }
 else {
      if (isActuallyVisible()) {
        closeNow();
      }
      int timeout=justClosed ? getQuickOpenDelay() : getOpenDelay();
      if (timeout == 0) {
        showTooltip();
      }
 else {
        showTimer.schedule(timeout);
        opening=true;
      }
    }
  }
  handledByFocus=isFocused;
  currentElement=element;
}

{
  final AtomicBoolean threadFailed=new AtomicBoolean(true);
  CurrentInstance.setInheritable(TestCurrentInstance.class,this);
  Assert.assertEquals(this,CurrentInstance.get(TestCurrentInstance.class));
  Thread t=new Thread(){
    @Override public void run(){
      try {
        Assert.assertEquals(TestCurrentInstance.this,CurrentInstance.get(TestCurrentInstance.class));
        CurrentInstance.set(TestCurrentInstance.class,null);
        assertCleared();
        threadFailed.set(false);
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
  }
;
  t.start();
  while (t.isAlive()) {
    Thread.sleep(1000);
  }
  Assert.assertFalse("Thread failed",threadFailed.get());
  Assert.assertEquals(this,CurrentInstance.get(TestCurrentInstance.class));
  CurrentInstance.set(TestCurrentInstance.class,null);
  assertCleared();
}

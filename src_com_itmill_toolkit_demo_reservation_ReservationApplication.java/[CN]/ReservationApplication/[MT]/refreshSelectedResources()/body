{
  Item resource=null;
  try {
    resource=getActiveResource();
  }
 catch (  ResourceNotAvailableException e) {
    resourceName.setCaption("Not available");
    resourceName.setValue("Please choose another time period or resource");
    return;
  }
  map.clear();
  if (resource == null) {
    resourceName.setCaption("Choose resource");
    resourceName.setValue("from the list above");
    map.setContainerDataSource(db.getResources(null));
    map.setZoomLevel(1);
  }
 else {
    String name=(String)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_NAME).getValue();
    String desc=(String)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_DESCRIPTION).getValue();
    resourceName.setCaption(name);
    resourceName.setValue(desc);
    LinkedList srs=resourcePanel.getSelectedResources();
    for (Iterator it=srs.iterator(); it.hasNext(); ) {
      resource=(Item)it.next();
      name=(String)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_NAME).getValue();
      desc=(String)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_DESCRIPTION).getValue();
      Double x=(Double)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_LOCATIONX).getValue();
      Double y=(Double)resource.getItemProperty(SampleDB.Resource.PROPERTY_ID_LOCATIONY).getValue();
      if (x != null && y != null) {
        map.addMarker(name + "<br/>" + desc,new Point2D.Double(x.doubleValue(),y.doubleValue()));
      }
    }
    map.setZoomLevel((srs.size() == 1 ? 14 : 9));
  }
}

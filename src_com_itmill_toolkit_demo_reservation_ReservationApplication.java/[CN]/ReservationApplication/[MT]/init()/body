{
  db=new SampleDB(true);
  db.generateResources();
  db.generateDemoUser();
  db.generateReservations();
  Window mainWindow=new Window("Reservr");
  setMainWindow(mainWindow);
  setTheme("reservr");
  TabSheet mainTabs=new TabSheet();
  mainWindow.addComponent(mainTabs);
  OrderedLayout reservationTab=new OrderedLayout();
  mainTabs.addTab(reservationTab,"Make reservation",null);
  resourcePanel=new ResourceSelectorPanel("Resources");
  resourcePanel.setResourceContainer(db.getResources(null));
  resourcePanel.addListener(ResourceSelectorPanel.SelectedResourcesChangedEvent.class,this,"selectedResourcesChanged");
  reservationTab.addComponent(resourcePanel);
  Panel reservationPanel=new Panel("Reservation",new OrderedLayout(OrderedLayout.ORIENTATION_HORIZONTAL));
  reservationPanel.addStyleName(Panel.STYLE_LIGHT);
  reservationPanel.getLayout().setMargin(true);
  reservationTab.addComponent(reservationPanel);
  OrderedLayout infoLayout=new OrderedLayout();
  infoLayout.setMargin(false,true,false,false);
  reservationPanel.addComponent(infoLayout);
  resourceName=new Label("From the list above");
  resourceName.setCaption("Choose resource");
  infoLayout.addComponent(resourceName);
  description=new TextField();
  description.setColumns(20);
  description.setRows(5);
  infoLayout.addComponent(description);
  reservationButton=new Button("Make reservation",this,"makeReservation");
  infoLayout.addComponent(reservationButton);
  map=new GoogleMap();
  map.setWidth(266);
  map.setHeight(210);
  map.setItemMarkerHtmlPropertyId(SampleDB.Resource.PROPERTY_ID_NAME);
  map.setItemMarkerXPropertyId(SampleDB.Resource.PROPERTY_ID_LOCATIONX);
  map.setItemMarkerYPropertyId(SampleDB.Resource.PROPERTY_ID_LOCATIONY);
  map.setContainerDataSource(db.getResources(null));
  infoLayout.addComponent(map);
  Calendar from=Calendar.getInstance();
  from.add(Calendar.HOUR,1);
  from.set(Calendar.MINUTE,0);
  from.set(Calendar.SECOND,0);
  from.set(Calendar.MILLISECOND,0);
  reservedFrom=new CalendarField("From");
  reservedFrom.setMinimumDate(from.getTime());
  reservedFrom.setValue(from.getTime());
  reservedFrom.setImmediate(true);
  initCalendarFieldPropertyIds(reservedFrom);
  reservationPanel.addComponent(reservedFrom);
  Label arrowLabel=new Label("&raquo;");
  arrowLabel.setContentMode(Label.CONTENT_XHTML);
  arrowLabel.setStyleName("arrow");
  reservationPanel.addComponent(arrowLabel);
  Calendar to=Calendar.getInstance();
  to.setTime(from.getTime());
  to.add(Calendar.MILLISECOND,(int)DEFAULT_GAP_MILLIS);
  reservedTo=new CalendarField("To");
  reservedTo.setMinimumDate(to.getTime());
  reservedTo.setValue(to.getTime());
  reservedTo.setImmediate(true);
  initCalendarFieldPropertyIds(reservedTo);
  reservationPanel.addComponent(reservedTo);
  reservedFrom.addListener(new ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Date fd=(Date)reservedFrom.getValue();
      if (fd == null) {
        reservedTo.setValue(null);
        reservedTo.setEnabled(false);
        refreshSelectedResources();
        return;
      }
 else {
        reservedTo.setEnabled(true);
      }
      reservedTo.setMinimumDate(new Date(fd.getTime() + DEFAULT_GAP_MILLIS));
      Calendar to=Calendar.getInstance();
      to.setTime(fd);
      to.add(Calendar.MILLISECOND,(int)currentGapMillis);
      reservedTo.setValue(to.getTime());
      refreshSelectedResources();
    }
  }
);
  reservedTo.addListener(new ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Date from=(Date)reservedFrom.getValue();
      Date to=(Date)reservedTo.getValue();
      currentGapMillis=to.getTime() - from.getTime();
      if (currentGapMillis <= 0) {
        Calendar t=Calendar.getInstance();
        t.setTime(from);
        t.add(Calendar.MILLISECOND,(int)DEFAULT_GAP_MILLIS);
        reservedTo.setValue(t.getTime());
      }
      refreshSelectedResources();
    }
  }
);
  Panel allLayout=new Panel(new OrderedLayout(OrderedLayout.ORIENTATION_HORIZONTAL));
  allLayout.addStyleName(Panel.STYLE_LIGHT);
  allLayout.getLayout().setMargin(true);
  allCalendar=new CalendarField();
  initCalendarFieldPropertyIds(allCalendar);
  allLayout.addComponent(allCalendar);
  allTable=new Table();
  allTable.setWidth(700);
  allTable.setColumnCollapsingAllowed(true);
  allTable.setColumnReorderingAllowed(true);
  allLayout.addComponent(allTable);
  mainTabs.addTab(allLayout,"All reservations",null);
  mainTabs.addListener(new TabSheet.SelectedTabChangeListener(){
    public void selectedTabChange(    SelectedTabChangeEvent event){
      refreshReservations(false);
    }
  }
);
  refreshReservations(true);
}

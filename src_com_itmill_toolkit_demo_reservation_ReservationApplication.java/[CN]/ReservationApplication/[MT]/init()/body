{
  db=new SampleDB(true);
  db.generateResources();
  db.generateDemoUser();
  Window mainWindow=new Window("Reservr");
  setMainWindow(mainWindow);
  setTheme("reservr");
  TabSheet mainTabs=new TabSheet();
  mainWindow.addComponent(mainTabs);
  mainWindow.addComponent(new Button("close",this,"close"));
  OrderedLayout reservationTab=new OrderedLayout();
  mainTabs.addTab(reservationTab,"Make reservation",null);
  resourcePanel=new ResourceSelectorPanel("Resources");
  resourcePanel.setResourceContainer(db.getResources(null));
  resourcePanel.addListener(ResourceSelectorPanel.SelectedResourcesChangedEvent.class,this,"selectedResourcesChanged");
  reservationTab.addComponent(resourcePanel);
  Panel reservationPanel=new Panel("Reservation",new OrderedLayout(OrderedLayout.ORIENTATION_HORIZONTAL));
  reservationTab.addComponent(reservationPanel);
  OrderedLayout infoLayout=new OrderedLayout();
  reservationPanel.addComponent(infoLayout);
  resourceName=new Label("From the list above");
  resourceName.setCaption("Choose resource");
  infoLayout.addComponent(resourceName);
  description=new TextField();
  description.setColumns(55);
  description.setRows(5);
  infoLayout.addComponent(description);
  reservationButton=new Button("Make reservation",this,"makeReservation");
  infoLayout.addComponent(reservationButton);
  statusLabel=new Label();
  infoLayout.addComponent(statusLabel);
  map=new GoogleMap();
  map.setWidth(360);
  map.setHeight(270);
  map.setItemMarkerHtmlPropertyId(SampleDB.Resource.PROPERTY_ID_NAME);
  map.setItemMarkerXPropertyId(SampleDB.Resource.PROPERTY_ID_LOCATIONX);
  map.setItemMarkerYPropertyId(SampleDB.Resource.PROPERTY_ID_LOCATIONY);
  map.setContainerDataSource(db.getResources(null));
  infoLayout.addComponent(map);
  Calendar from=Calendar.getInstance();
  reservedFrom=new CalendarField();
  reservedFrom.setMinimumDate(from.getTime());
  reservedFrom.setValue(from.getTime());
  reservedFrom.setImmediate(true);
  initCalendarFieldPropertyIds(reservedFrom);
  reservationPanel.addComponent(reservedFrom);
  Calendar to=Calendar.getInstance();
  to.add(Calendar.MILLISECOND,(int)currentGapMillis);
  reservedTo=new CalendarField();
  reservedTo.setMinimumDate(from.getTime());
  reservedTo.setValue(to.getTime());
  reservedTo.setImmediate(true);
  initCalendarFieldPropertyIds(reservedTo);
  reservationPanel.addComponent(reservedTo);
  reservedFrom.addListener(new ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Date fd=(Date)reservedFrom.getValue();
      if (fd == null) {
        reservedTo.setValue(null);
        reservedTo.setEnabled(false);
        refreshSelectedResources();
        return;
      }
 else {
        reservedTo.setEnabled(true);
      }
      reservedTo.setMinimumDate(fd);
      Calendar to=Calendar.getInstance();
      to.setTime(fd);
      to.add(Calendar.MILLISECOND,(int)currentGapMillis);
      reservedTo.setValue(to.getTime());
      refreshSelectedResources();
      resetStatus();
    }
  }
);
  reservedTo.addListener(new ValueChangeListener(){
    public void valueChange(    ValueChangeEvent event){
      Date from=(Date)reservedFrom.getValue();
      Date to=(Date)reservedTo.getValue();
      currentGapMillis=to.getTime() - from.getTime();
      if (currentGapMillis <= 0) {
        Calendar t=Calendar.getInstance();
        t.setTime(from);
        t.add(Calendar.MILLISECOND,(int)DEFAULT_GAP_MILLIS);
        reservedTo.setValue(t.getTime());
      }
      refreshSelectedResources();
      resetStatus();
    }
  }
);
  OrderedLayout allLayout=new OrderedLayout(OrderedLayout.ORIENTATION_HORIZONTAL);
  allCalendar=new CalendarField();
  initCalendarFieldPropertyIds(allCalendar);
  allLayout.addComponent(allCalendar);
  allTable=new Table();
  allLayout.addComponent(allTable);
  mainTabs.addTab(allLayout,"All reservations",null);
  mainTabs.addListener(new TabSheet.SelectedTabChangeListener(){
    public void selectedTabChange(    SelectedTabChangeEvent event){
      refreshReservations();
    }
  }
);
  refreshReservations();
}

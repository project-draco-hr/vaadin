{
  if (focusedDate == null) {
    Date now=new Date();
    focusedDate=new Date(now.getYear(),now.getMonth(),now.getDate());
    displayedMonth=new Date(now.getYear(),now.getMonth(),1);
  }
  if (getResolution() <= VDateField.RESOLUTION_MONTH && focusChangeListener != null) {
    focusChangeListener.focusChanged(new Date(focusedDate.getTime()));
  }
  final boolean needsMonth=getResolution() > VDateField.RESOLUTION_YEAR;
  boolean needsBody=getResolution() >= VDateField.RESOLUTION_DAY;
  buildCalendarHeader(needsMonth);
  clearCalendarBody(!needsBody);
  if (needsBody) {
    buildCalendarBody();
  }
  if (isTimeSelectorNeeded() && time == null) {
    time=new VTime();
    setWidget(2,0,time);
    getFlexCellFormatter().setColSpan(2,0,5);
    getFlexCellFormatter().setStyleName(2,0,VDateField.CLASSNAME + "-calendarpanel-time");
  }
 else   if (isTimeSelectorNeeded()) {
    time.updateTimes();
  }
 else   if (time != null) {
    remove(time);
  }
}

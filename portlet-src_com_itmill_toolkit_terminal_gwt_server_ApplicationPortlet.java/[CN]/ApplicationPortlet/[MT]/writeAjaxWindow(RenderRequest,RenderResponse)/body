{
  response.setContentType("text/html");
  PrintWriter out=response.getWriter();
  if (app != null) {
    PortletSession sess=request.getPortletSession();
    PortletApplicationContext ctx=PortletApplicationContext.getApplicationContext(sess);
    PortletRequestDispatcher dispatcher=sess.getPortletContext().getRequestDispatcher("/" + app);
    try {
      dispatcher.include(request,response);
    }
 catch (    PortletException e) {
      out.print("<h1>Servlet include failed!</h1>");
      out.print("<div>" + e + "</div>");
      ctx.setPortletApplication(this,null);
      return;
    }
    Application app=(Application)request.getAttribute(Application.class.getName());
    ctx.setPortletApplication(this,app);
    ctx.firePortletRenderRequest(this,request,response);
  }
}

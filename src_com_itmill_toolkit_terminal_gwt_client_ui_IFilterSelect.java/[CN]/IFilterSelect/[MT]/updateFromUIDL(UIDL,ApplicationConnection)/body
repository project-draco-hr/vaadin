{
  paintableId=uidl.getId();
  this.client=client;
  boolean readonly=uidl.hasAttribute("readonly");
  boolean disabled=uidl.hasAttribute("disabled");
  if (disabled || readonly) {
    tb.setEnabled(false);
    enabled=false;
  }
 else {
    tb.setEnabled(true);
    enabled=true;
  }
  if (client.updateComponent(this,uidl,true)) {
    return;
  }
  if (uidl.hasAttribute("tabindex")) {
    tb.setTabIndex(uidl.getIntAttribute("tabindex"));
  }
  immediate=uidl.hasAttribute("immediate");
  nullSelectionAllowed=uidl.hasAttribute("nullselect");
  currentPage=uidl.getIntVariable("page");
  if (uidl.hasAttribute(ATTR_EMPTYTEXT)) {
    emptyText=uidl.getStringAttribute(ATTR_EMPTYTEXT);
  }
  suggestionPopup.setPagingEnabled(true);
  allowNewItem=uidl.hasAttribute("allownewitem");
  currentSuggestions.clear();
  final UIDL options=uidl.getChildUIDL(0);
  totalMatches=uidl.getIntAttribute("totalMatches");
  String captions=emptyText;
  for (final Iterator i=options.getChildIterator(); i.hasNext(); ) {
    final UIDL optionUidl=(UIDL)i.next();
    final FilterSelectSuggestion suggestion=new FilterSelectSuggestion(optionUidl);
    currentSuggestions.add(suggestion);
    if (optionUidl.hasAttribute("selected")) {
      if (!filtering || popupOpenerClicked) {
        tb.setText(suggestion.getReplacementString());
        selectedOptionKey="" + suggestion.getOptionKey();
      }
      currentSuggestion=suggestion;
      setSelectedItemIcon(suggestion.getIconUri());
    }
    if (captions.length() > 0) {
      captions+="|";
    }
    captions+=suggestion.getReplacementString();
  }
  if ((!filtering || popupOpenerClicked) && uidl.hasVariable("selected") && uidl.getStringArrayVariable("selected").length == 0) {
    tb.setText(emptyText);
    selectedOptionKey=null;
  }
  if (filtering && lastFilter.toLowerCase().equals(uidl.getStringVariable("filter"))) {
    suggestionPopup.showSuggestions(currentSuggestions,currentPage,totalMatches);
    filtering=false;
  }
  final int minw=minWidth(captions);
  Element lastChild=DOM.getChild(panel.getElement(),DOM.getChildCount(panel.getElement()) - 1);
  if (DOM.getElementProperty(lastChild,"className") != null && DOM.getElementProperty(lastChild,"className") != "") {
    final Element spacer=DOM.createDiv();
    DOM.setStyleAttribute(spacer,"height","0");
    DOM.setStyleAttribute(spacer,"overflow","hidden");
    DOM.appendChild(panel.getElement(),spacer);
    lastChild=spacer;
  }
  DOM.setStyleAttribute(lastChild,"width",minw + "px");
  popupOpenerClicked=false;
  if (width == null) {
    int w=tb.getOffsetWidth() + popupOpener.getOffsetWidth();
    super.setWidth(w + "px");
  }
}

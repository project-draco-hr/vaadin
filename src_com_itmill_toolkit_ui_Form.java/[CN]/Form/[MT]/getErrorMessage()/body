{
  ErrorMessage validationError=null;
  if (isValidationVisible()) {
    for (final Iterator i=propertyIds.iterator(); i.hasNext(); ) {
      Object f=fields.get(i.next());
      if (f instanceof AbstractComponent) {
        AbstractComponent field=(AbstractComponent)f;
        validationError=field.getErrorMessage();
        if (validationError != null) {
          if ("".equals(validationError.toString())) {
            validationError=new Validator.InvalidValueException(field.getCaption());
          }
          break;
        }
 else         if (f instanceof Field && !((Field)f).isValid()) {
          AbstractField absField=(AbstractField)f;
          if (absField.isEmpty() && absField.isRequired()) {
            break;
          }
          validationError=new Validator.InvalidValueException(field.getCaption());
          break;
        }
      }
    }
  }
  if (getComponentError() == null && validationError == null && currentBufferedSourceException == null) {
    return null;
  }
  return new CompositeErrorMessage(new ErrorMessage[]{getComponentError(),validationError,currentBufferedSourceException});
}

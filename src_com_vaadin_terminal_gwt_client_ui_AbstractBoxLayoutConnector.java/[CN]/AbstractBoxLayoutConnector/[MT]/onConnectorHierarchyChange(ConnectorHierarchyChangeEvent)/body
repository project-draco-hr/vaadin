{
  super.onConnectorHierarchyChange(event);
  List<ComponentConnector> previousChildren=event.getOldChildren();
  int currentIndex=0;
  VBoxLayout layout=getWidget();
  for (  ComponentConnector child : getChildComponents()) {
    Slot slot=layout.getSlot(child);
    if (slot.getParent() != layout) {
      child.addStateChangeHandler(childStateChangeHandler);
    }
    layout.addOrMoveSlot(slot,currentIndex++);
  }
  for (  ComponentConnector child : previousChildren) {
    if (child.getParent() != this) {
      Slot slot=layout.getSlot(child);
      hasVerticalAlignment.remove(child);
      hasRelativeHeight.remove(child);
      hasExpandRatio.remove(child);
      needsMeasure.remove(child.getWidget().getElement());
      childElementHeight.remove(child.getWidget().getElement());
      childCaptionElementHeight.remove(child.getWidget().getElement());
      getLayoutManager().removeElementResizeListener(child.getWidget().getElement(),childComponentResizeListener);
      if (slot.hasCaption()) {
        getLayoutManager().removeElementResizeListener(slot.getCaptionElement(),slotCaptionResizeListener);
      }
      if (slot.getSpacingElement() != null) {
        getLayoutManager().removeElementResizeListener(slot.getSpacingElement(),spacingResizeListener);
      }
      child.removeStateChangeHandler(childStateChangeHandler);
      layout.removeSlot(child.getWidget());
    }
  }
  if (needsExpand()) {
    updateExpand();
  }
 else {
    getWidget().clearExpand();
  }
}

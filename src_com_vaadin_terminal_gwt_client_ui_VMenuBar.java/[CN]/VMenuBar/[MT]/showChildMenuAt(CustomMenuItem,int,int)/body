{
  final int shadowSpace=10;
  popup=new VOverlay(true,false,true);
  popup.setStyleName(CLASSNAME + "-popup");
  popup.setWidget(item.getSubMenu());
  popup.addCloseHandler(this);
  popup.addAutoHidePartner(item.getElement());
  popup.setPopupPosition(0,0);
  item.getSubMenu().onShow();
  visibleChildMenu=item.getSubMenu();
  item.getSubMenu().setParentMenu(this);
  popup.show();
  if (left + popup.getOffsetWidth() >= RootPanel.getBodyElement().getOffsetWidth() - shadowSpace) {
    if (subMenu) {
      left=item.getParentMenu().getAbsoluteLeft() - popup.getOffsetWidth() - shadowSpace;
    }
 else {
      left=RootPanel.getBodyElement().getOffsetWidth() - popup.getOffsetWidth() - shadowSpace;
    }
    if (left < shadowSpace) {
      left=shadowSpace;
    }
  }
  int availableHeight=RootPanel.getBodyElement().getOffsetHeight() - top - shadowSpace;
  int missingHeight=popup.getOffsetHeight() - availableHeight;
  if (missingHeight > 0) {
    int moveUpBy=Math.min(top - shadowSpace,missingHeight);
    top-=moveUpBy;
    missingHeight-=moveUpBy;
    availableHeight+=moveUpBy;
    if (missingHeight > 0) {
      int contentWidth=visibleChildMenu.getOffsetWidth();
      Style style=popup.getElement().getStyle();
      style.setHeight(availableHeight,Unit.PX);
      style.setOverflowY(Overflow.SCROLL);
      if (BrowserInfo.get().isIE6()) {
        style.setPaddingRight(Util.getNativeScrollbarSize(),Unit.PX);
      }
 else {
        style.setWidth(contentWidth + Util.getNativeScrollbarSize(),Unit.PX);
      }
      popup.updateShadowSizeAndPosition();
    }
  }
  popup.setPopupPosition(left,top);
  if (BrowserInfo.get().isIE7()) {
    popup.getElement().getStyle().setProperty("zoom","");
    Scheduler.get().scheduleDeferred(new Command(){
      public void execute(){
        if (popup == null) {
          return;
        }
        if (popup.getElement().getStyle().getProperty("width") == null || popup.getElement().getStyle().getProperty("width") == "") {
          popup.setWidth(popup.getOffsetWidth() + "px");
        }
        popup.getElement().getStyle().setProperty("zoom","1");
      }
    }
);
  }
}

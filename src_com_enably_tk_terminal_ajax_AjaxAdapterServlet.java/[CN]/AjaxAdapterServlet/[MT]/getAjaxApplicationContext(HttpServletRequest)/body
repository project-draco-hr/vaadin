{
  HttpSession session=request.getSession(true);
  Map acmap=(Map)session.getAttribute(SESSION_ATTR_APPLICATION_CONTEXT);
  if (acmap == null) {
    acmap=new HashMap();
    session.setAttribute(SESSION_ATTR_APPLICATION_CONTEXT,acmap);
    HttpSessionBindingListener sessionBindingListener=new SessionBindingListener(acmap);
    session.setAttribute(SESSION_BINDING_LISTENER,sessionBindingListener);
  }
  AjaxApplicationContext ac=(AjaxApplicationContext)acmap.get(getServletContext());
  if (ac == null) {
    ac=new AjaxApplicationContext(getServletContext());
    acmap.put(getServletContext(),ac);
  }
  return ac;
}

{
  boolean success=true;
  String changes=getRequestPayload(request);
  if (changes != null) {
    final String[] bursts=changes.split(String.valueOf(VAR_BURST_SEPARATOR));
    if (isXSRFEnabled(application2)) {
      if (bursts.length == 1 && "init".equals(bursts[0])) {
        request.setAttribute(WRITE_SECURITY_TOKEN_FLAG,true);
        return true;
      }
 else {
        String sessId=(String)request.getSessionAttribute(ApplicationConnection.UIDL_SECURITY_TOKEN_ID);
        if (sessId == null || !sessId.equals(bursts[0])) {
          throw new InvalidUIDLSecurityKeyException("Security key mismatch");
        }
      }
    }
    for (int bi=1; bi < bursts.length; bi++) {
      final String burst=unescapeBurst(bursts[bi]);
      success&=handleBurst(request,root,burst);
      if (bi < bursts.length - 1) {
        final PrintWriter outWriter=new PrintWriter(new CharArrayWriter());
        paintAfterVariableChanges(request,response,callback,true,outWriter,root,false);
      }
    }
  }
  return success;
}

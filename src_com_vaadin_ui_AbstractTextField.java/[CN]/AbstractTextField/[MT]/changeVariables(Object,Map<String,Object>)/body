{
  super.changeVariables(source,variables);
  if (variables.containsKey("text") && !isReadOnly()) {
    String newValue=(String)variables.get("text");
    if (getMaxLength() != -1 && newValue.length() > getMaxLength()) {
      newValue=newValue.substring(0,getMaxLength());
    }
    final String oldValue=getFormattedValue();
    if (newValue != null && (oldValue == null || isNullSettingAllowed()) && newValue.equals(getNullRepresentation())) {
      newValue=null;
    }
    if (newValue != oldValue && (newValue == null || !newValue.equals(oldValue))) {
      boolean wasModified=isModified();
      setValue(newValue,true);
      if (format != null || wasModified != isModified()) {
        requestRepaint();
      }
    }
  }
  if (variables.containsKey(FocusEvent.EVENT_ID)) {
    fireEvent(new FocusEvent(this));
  }
  if (variables.containsKey(BlurEvent.EVENT_ID)) {
    fireEvent(new BlurEvent(this));
  }
}

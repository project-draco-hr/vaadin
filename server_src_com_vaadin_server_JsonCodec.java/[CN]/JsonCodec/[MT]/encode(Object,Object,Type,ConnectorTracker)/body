{
  if (null == value) {
    return ENCODE_RESULT_NULL;
  }
  Object toReturn;
  if (value instanceof String || value instanceof Boolean || value instanceof Number|| value instanceof Character|| value instanceof JSONArray|| value instanceof JSONObject) {
    toReturn=value;
  }
 else   if (value instanceof String[]) {
    toReturn=toJsonArray((String[])value);
  }
 else   if (value instanceof Collection) {
    toReturn=encodeCollection(valueType,(Collection<?>)value,connectorTracker);
  }
 else   if (value instanceof Map) {
    toReturn=encodeMap(valueType,(Map<?,?>)value,connectorTracker);
  }
 else   if (value instanceof Connector) {
    if (value instanceof Component && !(LegacyCommunicationManager.isComponentVisibleToClient((Component)value))) {
      return ENCODE_RESULT_NULL;
    }
    toReturn=((Connector)value).getConnectorId();
  }
 else   if (value instanceof Enum) {
    toReturn=((Enum<?>)value).name();
  }
 else   if (customSerializers.containsKey(value.getClass())) {
    toReturn=serializeJson(value,connectorTracker);
  }
 else   if (valueType instanceof GenericArrayType) {
    toReturn=encodeArrayContents(((GenericArrayType)valueType).getGenericComponentType(),value,connectorTracker);
  }
 else   if (valueType instanceof Class<?>) {
    if (((Class<?>)valueType).isArray()) {
      toReturn=encodeArrayContents(((Class<?>)valueType).getComponentType(),value,connectorTracker);
    }
 else {
      return encodeObject(value,(Class<?>)valueType,(JSONObject)diffState,connectorTracker);
    }
  }
 else {
    throw new JSONException("Can not encode type " + valueType);
  }
  return new EncodeResult(toReturn);
}

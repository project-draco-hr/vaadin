{
  if (valueType == null) {
    throw new IllegalArgumentException("type must be defined");
  }
  if (valueType instanceof WildcardType) {
    throw new IllegalStateException("Can not serialize type with wildcard: " + valueType);
  }
  if (null == value) {
    return ENCODE_RESULT_NULL;
  }
  if (value instanceof String[]) {
    String[] array=(String[])value;
    JSONArray jsonArray=new JSONArray();
    for (int i=0; i < array.length; ++i) {
      jsonArray.put(array[i]);
    }
    return new EncodeResult(jsonArray);
  }
 else   if (value instanceof String) {
    return new EncodeResult(value);
  }
 else   if (value instanceof Boolean) {
    return new EncodeResult(value);
  }
 else   if (value instanceof Number) {
    return new EncodeResult(value);
  }
 else   if (value instanceof Character) {
    return new EncodeResult(value);
  }
 else   if (value instanceof Collection) {
    Collection<?> collection=(Collection<?>)value;
    JSONArray jsonArray=encodeCollection(valueType,collection,connectorTracker);
    return new EncodeResult(jsonArray);
  }
 else   if (valueType instanceof Class<?> && ((Class<?>)valueType).isArray()) {
    JSONArray jsonArray=encodeArrayContents(((Class<?>)valueType).getComponentType(),value,connectorTracker);
    return new EncodeResult(jsonArray);
  }
 else   if (valueType instanceof GenericArrayType) {
    Type componentType=((GenericArrayType)valueType).getGenericComponentType();
    JSONArray jsonArray=encodeArrayContents(componentType,value,connectorTracker);
    return new EncodeResult(jsonArray);
  }
 else   if (value instanceof Map) {
    Object jsonMap=encodeMap(valueType,(Map<?,?>)value,connectorTracker);
    return new EncodeResult(jsonMap);
  }
 else   if (value instanceof Connector) {
    Connector connector=(Connector)value;
    if (value instanceof Component && !(LegacyCommunicationManager.isComponentVisibleToClient((Component)value))) {
      return ENCODE_RESULT_NULL;
    }
    return new EncodeResult(connector.getConnectorId());
  }
 else   if (value instanceof Enum) {
    return encodeEnum((Enum<?>)value,connectorTracker);
  }
 else   if (value instanceof JSONArray || value instanceof JSONObject) {
    return new EncodeResult(value);
  }
 else   if (customSerializers.containsKey(value.getClass())) {
    JSONSerializer serializer=customSerializers.get(value.getClass());
    return new EncodeResult(serializer.serialize(value,connectorTracker));
  }
 else   if (valueType instanceof Class<?>) {
    return encodeObject(value,(Class<?>)valueType,(JSONObject)diffState,connectorTracker);
  }
 else {
    throw new JSONException("Can not encode " + valueType);
  }
}

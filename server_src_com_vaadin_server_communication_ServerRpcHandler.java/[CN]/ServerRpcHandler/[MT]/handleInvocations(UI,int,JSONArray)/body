{
  LegacyCommunicationManager manager=uI.getSession().getCommunicationManager();
  try {
    Set<Connector> enabledConnectors=new HashSet<Connector>();
    List<MethodInvocation> invocations=parseInvocations(uI.getConnectorTracker(),invocationsData,lastSyncIdSeenByClient);
    for (    MethodInvocation invocation : invocations) {
      final ClientConnector connector=manager.getConnector(uI,invocation.getConnectorId());
      if (connector != null && connector.isConnectorEnabled()) {
        enabledConnectors.add(connector);
      }
    }
    for (int i=0; i < invocations.size(); i++) {
      MethodInvocation invocation=invocations.get(i);
      final ClientConnector connector=manager.getConnector(uI,invocation.getConnectorId());
      if (connector == null) {
        getLogger().log(Level.WARNING,"Received RPC call for unknown connector with id {0} (tried to invoke {1}.{2})",new Object[]{invocation.getConnectorId(),invocation.getInterfaceName(),invocation.getMethodName()});
        continue;
      }
      if (!enabledConnectors.contains(connector)) {
        if (invocation instanceof LegacyChangeVariablesInvocation) {
          LegacyChangeVariablesInvocation legacyInvocation=(LegacyChangeVariablesInvocation)invocation;
          Map<String,Object> changes=legacyInvocation.getVariableChanges();
          if (changes.size() == 1 && changes.containsKey("close") && Boolean.TRUE.equals(changes.get("close"))) {
            continue;
          }
        }
        getLogger().warning(getIgnoredDisabledError("RPC call",connector));
        continue;
      }
      if (connector.getUI() != null && connector.getUI().isClosing()) {
        String msg="Ignoring RPC call for connector " + connector.getClass().getName();
        if (connector instanceof Component) {
          String caption=((Component)connector).getCaption();
          if (caption != null) {
            msg+=", caption=" + caption;
          }
        }
        msg+=" in closed UI";
        getLogger().warning(msg);
        continue;
      }
      if (invocation instanceof ServerRpcMethodInvocation) {
        try {
          ServerRpcManager.applyInvocation(connector,(ServerRpcMethodInvocation)invocation);
        }
 catch (        RpcInvocationException e) {
          manager.handleConnectorRelatedException(connector,e);
        }
      }
 else {
        LegacyChangeVariablesInvocation legacyInvocation=(LegacyChangeVariablesInvocation)invocation;
        Map<String,Object> changes=legacyInvocation.getVariableChanges();
        try {
          if (connector instanceof VariableOwner) {
            changeVariables(null,(VariableOwner)connector,changes);
          }
 else {
            throw new IllegalStateException("Received legacy variable change for " + connector.getClass().getName() + " ("+ connector.getConnectorId()+ ") which is not a VariableOwner. The client-side connector sent these legacy varaibles: "+ changes.keySet());
          }
        }
 catch (        Exception e) {
          manager.handleConnectorRelatedException(connector,e);
        }
      }
    }
  }
 catch (  JSONException e) {
    getLogger().warning("Unable to parse RPC call from the client: " + e.getMessage());
    throw new RuntimeException(e);
  }
}

{
  ui.getSession().setLastRequestTimestamp(System.currentTimeMillis());
  String changeMessage=getMessage(reader);
  if (changeMessage == null || changeMessage.equals("")) {
    return;
  }
  RpcRequest rpcRequest=new RpcRequest(changeMessage,request);
  if (!VaadinService.isCsrfTokenValid(ui.getSession(),rpcRequest.getCsrfToken())) {
    throw new InvalidUIDLSecurityKeyException("");
  }
  handleInvocations(ui,rpcRequest.getSyncId(),rpcRequest.getRpcInvocationsData());
  ui.getConnectorTracker().cleanConcurrentlyRemovedConnectorIds(rpcRequest.getSyncId());
  if (rpcRequest.isResynchronize()) {
    ui.getSession().getCommunicationManager().repaintAll(ui);
  }
}

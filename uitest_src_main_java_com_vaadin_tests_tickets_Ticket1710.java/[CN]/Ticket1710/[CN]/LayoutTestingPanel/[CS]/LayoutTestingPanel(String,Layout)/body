{
  super(caption);
  VerticalLayout internalLayout=new VerticalLayout();
  internalLayout.setWidth("100%");
  setContent(internalLayout);
  testedLayout=layout;
  testPanelLayout.setWidth("100%");
  VerticalLayout controlWrapperLayout=new VerticalLayout();
  controlWrapperLayout.setMargin(true);
  Panel controlWrapper=new Panel(controlWrapperLayout);
  controlWrapperLayout.addComponent(controls);
  controlWrapper.setWidth("100%");
  controlWrapper.setStyleName("controls");
  internalLayout.addComponent(controlWrapper);
  Panel testPanel=new Panel(testPanelLayout);
  testPanel.setStyleName("testarea");
  testPanelLayout.addComponent(testedLayout);
  internalLayout.addComponent(testPanel);
  internalLayout.setMargin(true);
  internalLayout.setSpacing(true);
  controls.setSpacing(true);
  controls.setMargin(false);
  controls.addComponent(new Label("width"));
  controls.addComponent(new TextField(new MethodProperty<Float>(testedLayout,"width")));
  CheckBox widthPercentsCheckBox=new CheckBox("%",new MethodProperty<Boolean>(this,"widthPercents"));
  widthPercentsCheckBox.setImmediate(true);
  controls.addComponent(widthPercentsCheckBox);
  controls.addComponent(new Label("height"));
  controls.addComponent(new TextField(new MethodProperty<Float>(testedLayout,"height")));
  CheckBox heightPercentsCheckBox=new CheckBox("%",new MethodProperty<Boolean>(this,"heightPercents"));
  heightPercentsCheckBox.setImmediate(true);
  controls.addComponent(heightPercentsCheckBox);
  controls.addComponent(marginLeft);
  controls.addComponent(marginRight);
  controls.addComponent(marginTop);
  controls.addComponent(marginBottom);
  if (testedLayout instanceof Layout.SpacingHandler) {
    controls.addComponent(spacing);
  }
  Property.ValueChangeListener marginSpacingListener=new Property.ValueChangeListener(){
    @Override public void valueChange(    ValueChangeEvent event){
      updateMarginsAndSpacing();
    }
  }
;
  marginBottom.addListener(marginSpacingListener);
  marginTop.addListener(marginSpacingListener);
  marginLeft.addListener(marginSpacingListener);
  marginRight.addListener(marginSpacingListener);
  spacing.addListener(marginSpacingListener);
  updateMarginsAndSpacing();
  addAlignmentControls();
  testedLayout.setStyleName("tested-layout");
  setStyleName("layout-testing-panel");
  for (Iterator<Component> i=controls.getComponentIterator(); i.hasNext(); ) {
    ((AbstractComponent)i.next()).setImmediate(true);
  }
}

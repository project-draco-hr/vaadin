{
  setFocusedNode(this,false);
  if (!BrowserInfo.get().isOpera()) {
    focus();
  }
  ScheduledCommand command=new ScheduledCommand(){
    public void execute(){
      if (multiSelectMode == MULTISELECT_MODE_SIMPLE || !isMultiselect) {
        toggleSelection();
        lastSelection=TreeNode.this;
      }
 else       if (multiSelectMode == MULTISELECT_MODE_DEFAULT) {
        if (isMultiselect && ctrl && !shift) {
          toggleSelection();
          lastSelection=TreeNode.this;
        }
 else         if (isMultiselect && !ctrl && shift) {
          deselectAll();
          selectNodeRange(lastSelection.key,key);
          sendSelectionToServer();
        }
 else         if (isMultiselect && ctrl && shift) {
          selectNodeRange(lastSelection.key,key);
        }
 else {
          deselectAll();
          toggleSelection();
          lastSelection=TreeNode.this;
        }
      }
    }
  }
;
  if (BrowserInfo.get().isWebkit() && !treeHasFocus) {
    Scheduler.get().scheduleDeferred(command);
  }
 else {
    command.execute();
  }
  return true;
}

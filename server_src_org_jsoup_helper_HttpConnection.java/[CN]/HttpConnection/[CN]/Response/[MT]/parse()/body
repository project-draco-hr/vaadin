{
  Validate.isTrue(executed,"Request must be executed (with .execute(), .get(), or .post() before parsing response");
  if (!req.ignoreContentType() && (contentType == null || !(contentType.startsWith("text/") || contentType.startsWith("application/xml") || contentType.startsWith("application/xhtml+xml")))) {
    throw new IOException(String.format("Unhandled content type \"%s\" on URL %s. Must be text/*, application/xml, or application/xhtml+xml",contentType,url.toString()));
  }
  Document doc=DataUtil.parseByteData(byteData,charset,url.toExternalForm(),req.parser());
  byteData.rewind();
  charset=doc.outputSettings().charset().name();
  return doc;
}

{
  if ((session == null) == (this.session == null)) {
    throw new IllegalStateException("VaadinServiceSession has already been set. Old session: " + getSessionDetails(this.session) + ". New session: "+ getSessionDetails(session)+ ".");
  }
 else {
    if (session == null) {
      detach();
      setPushConnection(null);
    }
    this.session=session;
  }
  if (session != null) {
    attach();
  }
}

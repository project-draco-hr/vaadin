{
  if (pushMode == null) {
    throw new IllegalArgumentException("Push mode cannot be null");
  }
  if (this.pushMode != null) {
    throw new IllegalStateException("Push mode already set");
  }
  if (pushMode.isEnabled()) {
    VaadinSession session=getSession();
    if (session != null && !session.getService().ensurePushAvailable()) {
      throw new IllegalStateException("Push is not available. See previous log messages for more information.");
    }
  }
  this.pushMode=pushMode;
}

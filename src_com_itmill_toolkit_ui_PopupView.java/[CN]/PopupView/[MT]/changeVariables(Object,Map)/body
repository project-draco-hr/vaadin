{
  if (variables.containsKey("popupVisibility")) {
    boolean oldVisibility=popupVisible;
    popupVisible=((Boolean)variables.get("popupVisibility")).booleanValue();
    if (popupVisible) {
      if (componentList.isEmpty()) {
        Component c=content.getPopupComponent();
        if (c != null) {
          componentList.add(c);
          super.addComponent(c);
        }
 else {
          popupVisible=false;
        }
      }
    }
 else     if (!componentList.isEmpty()) {
      super.removeComponent(componentList.get(0));
      componentList.clear();
    }
    if (oldVisibility != popupVisible) {
      fireEvent(new PopupVisibilityEvent(this));
    }
    requestRepaint();
  }
}

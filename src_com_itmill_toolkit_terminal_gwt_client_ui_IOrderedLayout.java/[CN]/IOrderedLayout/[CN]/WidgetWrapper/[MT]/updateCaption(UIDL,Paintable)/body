{
  final Widget widget=(Widget)paintable;
  if (Caption.isNeeded(uidl)) {
    boolean justAdded=false;
    if (caption == null) {
      justAdded=true;
      caption=new Caption(paintable,client);
    }
    caption.updateCaption(uidl);
    final boolean after=caption.shouldBePlacedAfterComponent();
    final Element captionElement=caption.getElement();
    final Element widgetElement=widget.getElement();
    if (justAdded) {
      if (after) {
        DOM.appendChild(getElement(),captionElement);
        DOM.setElementAttribute(getElement(),"class","i-orderedlayout-w");
        caption.addStyleName("i-orderedlayout-c");
        widget.addStyleName("i-orderedlayout-w-e");
      }
 else {
        DOM.insertChild(getElement(),captionElement,0);
      }
    }
 else     if (after == (DOM.getChildIndex(getElement(),widgetElement) > DOM.getChildIndex(getElement(),captionElement))) {
      Element firstElement=DOM.getChild(getElement(),DOM.getChildCount(getElement()) - 2);
      DOM.removeChild(getElement(),firstElement);
      DOM.appendChild(getElement(),firstElement);
      DOM.setElementAttribute(getElement(),"class",after ? "i-orderedlayout-w" : "");
      if (after) {
        caption.addStyleName("i-orderedlayout-c");
        widget.addStyleName("i-orderedlayout-w-e");
      }
 else {
        widget.removeStyleName("i-orderedlayout-w-e");
        caption.removeStyleName("i-orderedlayout-w-c");
      }
    }
  }
 else {
    if (caption != null) {
      DOM.removeChild(getElement(),caption.getElement());
      caption=null;
      DOM.setElementAttribute(getElement(),"class","");
      widget.removeStyleName("i-orderedlayout-w-e");
      caption.removeStyleName("i-orderedlayout-w-c");
    }
  }
}

{
  if (Caption.isNeeded(uidl)) {
    boolean justAdded=false;
    if (caption == null) {
      justAdded=true;
      caption=new Caption(paintable,client);
    }
    caption.updateCaption(uidl);
    final boolean after=caption.shouldBePlacedAfterComponent();
    final Element captionElement=caption.getElement();
    final Element widgetElement=((Widget)paintable).getElement();
    String currentWidgetClass=DOM.getElementAttribute(widgetElement,"class");
    if (null == currentWidgetClass) {
      currentWidgetClass="";
    }
    if (justAdded) {
      if (after) {
        DOM.appendChild(getElement(),captionElement);
        DOM.setElementAttribute(getElement(),"class","i-orderedlayout-wrap");
        DOM.setElementAttribute(widgetElement,"class",currentWidgetClass + " i-orderedlayout-wrap-e");
      }
 else {
        DOM.insertChild(getElement(),captionElement,0);
      }
    }
 else     if (after == (DOM.getChildIndex(getElement(),widgetElement) > DOM.getChildIndex(getElement(),captionElement))) {
      Element firstElement=DOM.getChild(getElement(),DOM.getChildCount(getElement()) - 2);
      DOM.removeChild(getElement(),firstElement);
      DOM.appendChild(getElement(),firstElement);
      DOM.setElementAttribute(getElement(),"class",after ? "i-orderedlayout-wrap" : "");
      if (after) {
        DOM.setElementAttribute(widgetElement,"class",currentWidgetClass + " i-orderedlayout-wrap-e");
      }
 else {
        removeClass(widgetElement,"i-orderedlayout-wrap-e");
      }
    }
  }
 else {
    if (caption != null) {
      DOM.removeChild(getElement(),caption.getElement());
      caption=null;
      DOM.setElementAttribute(getElement(),"class","");
      removeClass(DOM.getFirstChild(getElement()),"i-orderedlayout-wrap-e");
    }
  }
}

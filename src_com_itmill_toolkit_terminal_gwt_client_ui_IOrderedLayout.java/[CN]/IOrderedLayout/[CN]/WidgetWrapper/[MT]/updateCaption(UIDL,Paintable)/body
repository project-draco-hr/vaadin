{
  final Widget widget=(Widget)paintable;
  if (Caption.isNeeded(uidl)) {
    boolean justAdded=false;
    if (caption == null) {
      justAdded=true;
      caption=new Caption(paintable,client);
    }
    caption.updateCaption(uidl);
    final boolean after=caption.shouldBePlacedAfterComponent();
    final Element captionElement=caption.getElement();
    final Element widgetElement=widget.getElement();
    if (justAdded) {
      if (after) {
        DOM.appendChild(getWrappingElement(),captionElement);
        DOM.setElementAttribute(getWrappingElement(),"class","i-orderedlayout-w");
        caption.addStyleName("i-orderedlayout-c");
        widget.addStyleName("i-orderedlayout-w-e");
      }
 else {
        DOM.insertChild(getWrappingElement(),captionElement,0);
      }
    }
 else     if (after == (DOM.getChildIndex(getWrappingElement(),widgetElement) > DOM.getChildIndex(getWrappingElement(),captionElement))) {
      Element firstElement=DOM.getChild(getWrappingElement(),DOM.getChildCount(getWrappingElement()) - 2);
      if (firstElement != null) {
        DOM.removeChild(getWrappingElement(),firstElement);
        DOM.appendChild(getWrappingElement(),firstElement);
      }
      DOM.setElementAttribute(getWrappingElement(),"class",after ? "i-orderedlayout-w" : "");
      if (after) {
        caption.addStyleName("i-orderedlayout-c");
        widget.addStyleName("i-orderedlayout-w-e");
      }
 else {
        widget.removeStyleName("i-orderedlayout-w-e");
        caption.removeStyleName("i-orderedlayout-w-c");
      }
    }
  }
 else {
    if (caption != null) {
      DOM.removeChild(getWrappingElement(),caption.getElement());
      caption=null;
      DOM.setElementAttribute(getWrappingElement(),"class","");
      widget.removeStyleName("i-orderedlayout-w-e");
      caption.removeStyleName("i-orderedlayout-w-c");
    }
  }
}

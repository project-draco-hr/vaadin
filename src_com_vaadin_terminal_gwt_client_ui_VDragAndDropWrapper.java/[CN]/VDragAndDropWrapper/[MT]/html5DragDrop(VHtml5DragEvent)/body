{
  if (dropHandler == null || !currentlyValid) {
    return true;
  }
  ApplicationConnection.getConsole().log("HTML 5 Drag Drop");
  VTransferable transferable=vaadinDragEvent.getTransferable();
  JsArrayString types=event.getTypes();
  ApplicationConnection.getConsole().log("Types fetched");
  for (int i=0; i < types.length(); i++) {
    String type=types.get(i);
    ApplicationConnection.getConsole().log("Type: " + type);
    if ("Text".equals(type) || "Url".equals(type) || "text/html".equals(type)) {
      String data=event.getDataAsText(type);
      if (data != null) {
        ApplicationConnection.getConsole().log(type + " : " + data);
        transferable.setData(type,data);
      }
    }
  }
  ApplicationConnection.getConsole().log("checking files");
  int fileCount=event.getFileCount();
  if (fileCount > 0) {
    transferable.setData("filecount",fileCount);
    for (int i=0; i < fileCount; i++) {
      final int fileId=filecounter++;
      final VHtml5File file=event.getFile(i);
      transferable.setData("fi" + i,"" + fileId);
      transferable.setData("fn" + i,file.getName());
      transferable.setData("ft" + i,file.getType());
      transferable.setData("fs" + i,file.getSize());
      postFile(fileId,file);
    }
  }
  ApplicationConnection.getConsole().log("Ending drag");
  VDragAndDropManager.get().endDrag();
  vaadinDragEvent=null;
  event.preventDefault();
  event.stopPropagation();
  return false;
}

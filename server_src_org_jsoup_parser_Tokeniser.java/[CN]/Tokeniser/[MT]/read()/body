{
  if (!selfClosingFlagAcknowledged) {
    error("Self closing flag not acknowledged");
    selfClosingFlagAcknowledged=true;
  }
  while (!isEmitPending) {
    state.read(this,reader);
  }
  if (charBuffer.length() > 0) {
    String str=charBuffer.toString();
    charBuffer.delete(0,charBuffer.length());
    return new Token.Character(str);
  }
 else {
    isEmitPending=false;
    return emitPending;
  }
}

{
  if (!isUIDLRequest(request)) {
    throw new RuntimeException("criticalNotification can only be used in UIDL requests");
  }
  if (caption != null) {
    caption="\"" + JsonPaintTarget.escapeJSON(caption) + "\"";
  }
  if (details != null) {
    if (message == null) {
      message=details;
    }
 else {
      message+="<br/><br/>" + details;
    }
  }
  if (message != null) {
    message="\"" + JsonPaintTarget.escapeJSON(message) + "\"";
  }
  if (url != null) {
    url="\"" + JsonPaintTarget.escapeJSON(url) + "\"";
  }
  response.setContentType("application/json; charset=UTF-8");
  final ServletOutputStream out=response.getOutputStream();
  final PrintWriter outWriter=new PrintWriter(new BufferedWriter(new OutputStreamWriter(out,"UTF-8")));
  outWriter.print("for(;;);[{\"changes\":[], \"meta\" : {" + "\"appError\": {" + "\"caption\":" + caption + ","+ "\"message\" : "+ message+ ","+ "\"url\" : "+ url+ "}}, \"resources\": {}, \"locales\":[]}]");
  outWriter.flush();
  outWriter.close();
  out.flush();
}

{
  String themeName;
  if (request.getParameter(URL_PARAMETER_THEME) != null) {
    themeName=request.getParameter(URL_PARAMETER_THEME);
  }
 else {
    themeName=window.getTheme();
  }
  if (themeName == null) {
    if (request.getAttribute(REQUEST_DEFAULT_THEME) != null) {
      themeName=(String)request.getAttribute(REQUEST_DEFAULT_THEME);
    }
 else {
      themeName=getDefaultTheme();
    }
  }
  themeName=JsonPaintTarget.escapeJSON(themeName);
  return themeName;
}

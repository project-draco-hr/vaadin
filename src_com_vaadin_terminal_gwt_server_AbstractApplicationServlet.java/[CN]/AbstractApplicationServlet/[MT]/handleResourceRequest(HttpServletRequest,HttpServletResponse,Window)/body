{
  if (resourcePath == null) {
    resourcePath=request.getContextPath() + request.getServletPath() + RESOURCE_URI;
    resourcePath=resourcePath.replaceAll("//","/");
  }
  String resourceId=request.getPathInfo();
  if (resourceId == null || !resourceId.startsWith(RESOURCE_URI)) {
    return false;
  }
  String themeName=getThemeForWindow(request,window);
  resourceId=resourceId.substring(RESOURCE_URI.length());
  InputStream data=null;
  try {
    data=getServletContext().getResourceAsStream(THEME_DIRECTORY_PATH + themeName + "/"+ resourceId);
  }
 catch (  final Exception e) {
    e.printStackTrace();
    data=null;
  }
  try {
    if (data != null) {
      response.setContentType(FileTypeResolver.getMIMEType(resourceId));
      response.setHeader("Cache-Control","max-age=" + DEFAULT_THEME_CACHETIME / 1000);
      response.setDateHeader("Expires",System.currentTimeMillis() + DEFAULT_THEME_CACHETIME);
      response.setHeader("Pragma","cache");
      final byte[] buffer=new byte[DEFAULT_BUFFER_SIZE];
      int bytesRead=0;
      final OutputStream out=response.getOutputStream();
      while ((bytesRead=data.read(buffer)) > 0) {
        out.write(buffer,0,bytesRead);
      }
      out.close();
      data.close();
    }
 else {
      response.sendError(HttpServletResponse.SC_NOT_FOUND);
    }
  }
 catch (  final java.io.IOException e) {
    System.err.println("Resource transfer failed:  " + request.getRequestURI() + ". ("+ e.getMessage()+ ")");
  }
  return true;
}

{
  if (!hasFilters) {
    setFilteredItemIds(null);
    if (filters != null) {
      filters=null;
      return true;
    }
    return false;
  }
  List<Object> originalFilteredItemIds=getFilteredItemIds();
  if (originalFilteredItemIds == null) {
    originalFilteredItemIds=Collections.emptyList();
  }
  setFilteredItemIds(new ListSet<Object>());
  boolean equal=true;
  Iterator<?> origIt=originalFilteredItemIds.iterator();
  for (final Iterator<?> i=allItemIds.iterator(); i.hasNext(); ) {
    final Object id=i.next();
    if (passesFilters(id)) {
      equal=equal && origIt.hasNext() && origIt.next() == id;
      getFilteredItemIds().add(id);
    }
  }
  return !equal || origIt.hasNext();
}

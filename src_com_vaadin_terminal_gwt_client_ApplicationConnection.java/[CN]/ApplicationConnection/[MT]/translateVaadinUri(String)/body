{
  if (uidlUri == null) {
    return null;
  }
  if (uidlUri.startsWith("theme://")) {
    final String themeUri=configuration.getThemeUri();
    if (themeUri == null) {
      VConsole.error("Theme not set: ThemeResource will not be found. (" + uidlUri + ")");
    }
    uidlUri=themeUri + uidlUri.substring(7);
  }
  if (uidlUri.startsWith(CONNECTOR_PROTOCOL_PREFIX)) {
    uidlUri=APP_PROTOCOL_PREFIX + CONNECTOR_RESOURCE_PREFIX + uidlUri.substring(CONNECTOR_PROTOCOL_PREFIX.length());
  }
  if (uidlUri.startsWith(APP_PROTOCOL_PREFIX)) {
    String relativeUrl=uidlUri.substring(APP_PROTOCOL_PREFIX.length());
    if (getConfiguration().usePortletURLs()) {
      String[] parts=relativeUrl.split("\\?",2);
      String path=parts[0];
      String url=getConfiguration().getPortletResourceUrl();
      if (parts.length > 1) {
        String appUrlParams=parts[1];
        url=addGetParameters(url,appUrlParams);
      }
      if (!path.startsWith("/")) {
        path='/' + path;
      }
      String pathParam=V_RESOURCE_PATH + "=" + URL.encodeQueryString(path);
      url=addGetParameters(url,pathParam);
      uidlUri=url;
    }
 else {
      uidlUri=getAppUri() + relativeUrl;
    }
  }
  return uidlUri;
}

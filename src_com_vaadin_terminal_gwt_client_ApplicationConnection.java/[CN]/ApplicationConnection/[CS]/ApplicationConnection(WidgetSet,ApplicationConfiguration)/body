{
  VConsole.log("Starting application " + cnf.getRootPanelId());
  VConsole.log("Vaadin application servlet version: " + cnf.getServletVersion());
  VConsole.log("Application version: " + cnf.getApplicationVersion());
  if (!cnf.getServletVersion().equals(ApplicationConfiguration.VERSION)) {
    VConsole.error("Warning: your widget set seems to be built with a different " + "version than the one used on server. Unexpected " + "behavior may occur.");
  }
  this.widgetSet=widgetSet;
  configuration=cnf;
  windowName=configuration.getInitialWindowName();
  ComponentLocator componentLocator=new ComponentLocator(this);
  String appRootPanelName=cnf.getRootPanelId();
  appRootPanelName=appRootPanelName.replaceFirst("-\\d+$","");
  initializeTestbenchHooks(componentLocator,appRootPanelName);
  initializeClientHooks();
  view=new VView();
  view.init(cnf.getRootPanelId());
  showLoadingIndicator();
  Event.addNativePreviewHandler(new NativePreviewHandler(){
    public void onPreviewNativeEvent(    NativePreviewEvent event){
      if (activeRequests <= 0) {
        return;
      }
      if (event.getTypeInt() == Event.ONKEYDOWN) {
        NativeEvent nativeEvent=event.getNativeEvent();
        if (nativeEvent.getKeyCode() == KeyCodes.KEY_ESCAPE) {
          nativeEvent.preventDefault();
        }
      }
    }
  }
);
}

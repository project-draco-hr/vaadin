{
  boolean repaintAll=(request.getParameter(GET_PARAM_REPAINT_ALL) != null) || request.getSession().isNew();
  boolean analyzeLayouts=false;
  if (repaintAll) {
    analyzeLayouts=(request.getParameter(GET_PARAM_ANALYZE_LAYOUTS) != null);
  }
  final OutputStream out=response.getOutputStream();
  final PrintWriter outWriter=new PrintWriter(new BufferedWriter(new OutputStreamWriter(out,"UTF-8")));
synchronized (application) {
    Window window=null;
    if (application.isRunning()) {
      window=getApplicationWindow(request,application,null);
      if (window == null) {
        System.err.println("Warning, could not get window for application with request URI " + request.getRequestURI());
        return;
      }
    }
 else {
      endApplication(request,response,application);
      return;
    }
    if (!handleVariables(request,response,application,window)) {
      SystemMessages ci=null;
      try {
        Method m=application.getClass().getMethod("getSystemMessages",(Class[])null);
        ci=(Application.SystemMessages)m.invoke(null,(Object[])null);
      }
 catch (      Exception e2) {
        e2.printStackTrace();
      }
      if (ci != null) {
        String msg=ci.getOutOfSyncMessage();
        String cap=ci.getOutOfSyncCaption();
        if (msg != null || cap != null) {
          applicationServlet.criticalNotification(request,response,cap,msg,ci.getOutOfSyncURL());
          return;
        }
      }
      repaintAll=true;
    }
    paintAfterVariablechanges(request,response,applicationServlet,repaintAll,outWriter,window,analyzeLayouts);
    currentlyOpenWindowsInClient.add(window.getName());
    if (closingWindowName != null) {
      currentlyOpenWindowsInClient.remove(closingWindowName);
      closingWindowName=null;
    }
  }
  out.flush();
  out.close();
}

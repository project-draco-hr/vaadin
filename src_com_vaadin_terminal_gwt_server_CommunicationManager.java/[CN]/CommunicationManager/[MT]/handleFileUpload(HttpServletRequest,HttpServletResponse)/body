{
  String pathInfo=request.getPathInfo();
  int startOfData=pathInfo.indexOf(AbstractApplicationServlet.UPLOAD_URL_PREFIX) + AbstractApplicationServlet.UPLOAD_URL_PREFIX.length();
  String uppUri=pathInfo.substring(startOfData);
  String[] parts=uppUri.split("/",3);
  String variableName=parts[1];
  String paintableId=parts[0];
  StreamVariable streamVariable=getStreamVariable(paintableId,variableName);
  String secKey=streamVariableToSeckey.get(streamVariable);
  if (secKey.equals(parts[2])) {
    VariableOwner source=getVariableOwner(paintableId);
    String contentType=request.getContentType();
    if (request.getContentType().contains("boundary")) {
      doHandleSimpleMultipartFileUpload(new HttpServletRequestWrapper(request),new HttpServletResponseWrapper(response),streamVariable,variableName,source,contentType.split("boundary=")[1]);
    }
 else {
      doHandleXhrFilePost(new HttpServletRequestWrapper(request),new HttpServletResponseWrapper(response),streamVariable,variableName,source,request.getContentLength());
    }
  }
 else {
    throw new InvalidUIDLSecurityKeyException("Security key in upload post did not match!");
  }
}

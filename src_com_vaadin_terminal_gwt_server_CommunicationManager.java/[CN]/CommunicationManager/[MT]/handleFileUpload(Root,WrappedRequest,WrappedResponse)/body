{
  String pathInfo=request.getRequestPathInfo();
  int startOfData=pathInfo.indexOf(AbstractApplicationServlet.UPLOAD_URL_PREFIX) + AbstractApplicationServlet.UPLOAD_URL_PREFIX.length();
  String uppUri=pathInfo.substring(startOfData);
  String[] parts=uppUri.split("/",3);
  String variableName=parts[1];
  String connectorId=parts[0];
  StreamVariable streamVariable=pidToNameToStreamVariable.get(connectorId).get(variableName);
  String secKey=streamVariableToSeckey.get(streamVariable);
  if (secKey.equals(parts[2])) {
    Connector source=getConnector(root,connectorId);
    String contentType=request.getContentType();
    if (contentType.contains("boundary")) {
      doHandleSimpleMultipartFileUpload(request,response,streamVariable,variableName,source,contentType.split("boundary=")[1]);
    }
 else {
      doHandleXhrFilePost(request,response,streamVariable,variableName,source,request.getContentLength());
    }
  }
 else {
    throw new InvalidUIDLSecurityKeyException("Security key in upload post did not match!");
  }
}

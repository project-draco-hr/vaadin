{
  int requestLength;
  if (request instanceof ResourceRequest) {
    requestLength=((ResourceRequest)request).getContentLength();
  }
 else {
    requestLength=((HttpServletRequest)request).getContentLength();
  }
  byte[] buffer=new byte[requestLength];
  InputStream inputStream;
  if (request instanceof ResourceRequest) {
    inputStream=((ResourceRequest)request).getPortletInputStream();
  }
 else {
    inputStream=((HttpServletRequest)request).getInputStream();
  }
  int bytesRemaining=requestLength;
  while (bytesRemaining > 0) {
    int bytesToRead=Math.min(bytesRemaining,MAX_BUFFER_SIZE);
    int bytesRead=inputStream.read(buffer,requestLength - bytesRemaining,bytesToRead);
    if (bytesRead == -1) {
      break;
    }
    bytesRemaining-=bytesRead;
  }
  String result=new String(buffer,"utf-8");
  return result;
}

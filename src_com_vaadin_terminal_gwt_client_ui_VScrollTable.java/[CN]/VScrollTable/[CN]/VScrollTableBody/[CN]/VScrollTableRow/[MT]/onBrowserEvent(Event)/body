{
  if (enabled) {
    int type=event.getTypeInt();
    Element targetTdOrTr=getEventTargetTdOrTr(event);
    if (type == Event.ONCONTEXTMENU) {
      showContextMenu(event);
      event.stopPropagation();
      return;
    }
    if (targetTdOrTr != null) {
switch (type) {
case Event.ONDBLCLICK:
        handleClickEvent(event,targetTdOrTr);
      break;
case Event.ONMOUSEUP:
    mDown=false;
  handleClickEvent(event,targetTdOrTr);
if (event.getButton() == Event.BUTTON_LEFT && isSelectable()) {
  if ((event.getCtrlKey() || event.getMetaKey()) && event.getShiftKey() && selectMode == SELECT_MODE_MULTI && multiselectmode == MULTISELECT_MODE_DEFAULT) {
    toggleShiftSelection(false);
    setRowFocus(this);
  }
 else   if ((event.getCtrlKey() || event.getMetaKey()) && selectMode == SELECT_MODE_MULTI && multiselectmode == MULTISELECT_MODE_DEFAULT) {
    boolean wasSelected=isSelected();
    toggleSelection();
    setRowFocus(this);
    selectionRangeStart=this;
    if (wasSelected) {
      removeRowFromUnsentSelectionRanges(this);
    }
  }
 else   if ((event.getCtrlKey() || event.getMetaKey() && selectMode == SELECT_MODE_SINGLE)) {
    if (!isSelected() || (isSelected() && nullSelectionAllowed)) {
      if (!isSelected()) {
        deselectAll();
      }
      toggleSelection();
      setRowFocus(this);
    }
  }
 else   if (event.getShiftKey() && selectMode == SELECT_MODE_MULTI && multiselectmode == MULTISELECT_MODE_DEFAULT) {
    toggleShiftSelection(true);
  }
 else {
    boolean currentlyJustThisRowSelected=selectedRowKeys.size() == 1 && selectedRowKeys.contains(getKey());
    if (!currentlyJustThisRowSelected) {
      if (multiselectmode == MULTISELECT_MODE_DEFAULT) {
        deselectAll();
      }
      toggleSelection();
    }
 else     if ((selectMode == SELECT_MODE_SINGLE || multiselectmode == MULTISELECT_MODE_SIMPLE) && nullSelectionAllowed) {
      toggleSelection();
    }
    selectionRangeStart=this;
    setRowFocus(this);
  }
  if (BrowserInfo.get().isIE()) {
    ((Element)event.getEventTarget().cast()).setPropertyJSO("onselectstart",null);
  }
  sendSelectedRows();
}
break;
case Event.ONMOUSEDOWN:
setRowFocus(this);
if (dragmode != 0 && event.getButton() == NativeEvent.BUTTON_LEFT) {
mDown=true;
VTransferable transferable=new VTransferable();
transferable.setDragSource(VScrollTable.this);
transferable.setData("itemId","" + rowKey);
NodeList<TableCellElement> cells=rowElement.getCells();
for (int i=0; i < cells.getLength(); i++) {
if (cells.getItem(i).isOrHasChild(targetTdOrTr)) {
HeaderCell headerCell=tHead.getHeaderCell(i);
transferable.setData("propertyId",headerCell.cid);
break;
}
}
VDragEvent ev=VDragAndDropManager.get().startDrag(transferable,event,true);
if (dragmode == DRAGMODE_MULTIROW && selectMode == SELECT_MODE_MULTI && selectedRowKeys.contains("" + rowKey)) {
ev.createDragImage((Element)scrollBody.tBodyElement.cast(),true);
Element dragImage=ev.getDragImage();
int i=0;
for (Iterator<Widget> iterator=scrollBody.iterator(); iterator.hasNext(); ) {
VScrollTableRow next=(VScrollTableRow)iterator.next();
Element child=(Element)dragImage.getChild(i++);
if (!selectedRowKeys.contains("" + next.rowKey)) {
  child.getStyle().setVisibility(Visibility.HIDDEN);
}
}
}
 else {
ev.createDragImage(getElement(),true);
}
ensureFocus();
event.preventDefault();
event.stopPropagation();
}
 else if (event.getCtrlKey() || event.getShiftKey() || event.getMetaKey() && selectMode == SELECT_MODE_MULTI && multiselectmode == MULTISELECT_MODE_DEFAULT) {
ensureFocus();
event.preventDefault();
if (BrowserInfo.get().isIE()) {
((Element)event.getEventTarget().cast()).setPropertyJSO("onselectstart",applyDisableTextSelectionIEHack());
}
event.stopPropagation();
}
break;
case Event.ONMOUSEOUT:
mDown=false;
break;
case Event.ONFOCUS:
onFocus(null);
break;
case Event.ONBLUR:
onBlur(null);
break;
default :
break;
}
}
}
super.onBrowserEvent(event);
}

{
  if (selectedRowKeys.isEmpty() || lastSelectedRowKey < 0 || selectMode == SELECT_MODE_SINGLE) {
    deselectAll();
    toggleSelection(true);
    return;
  }
  int startKey=lastSelectedRowKey;
  int endKey=rowKey;
  if (endKey < startKey) {
    startKey^=endKey;
    endKey^=startKey;
    startKey^=endKey;
  }
  if (deselectPrevious) {
    deselectAll();
  }
  VScrollTableRow startRow=getRenderedRowByKey(String.valueOf(startKey));
  VScrollTableRow endRow=getRenderedRowByKey(String.valueOf(endKey));
  if (startRow == null) {
    startRow=(VScrollTableRow)scrollBody.iterator().next();
  }
  Iterator<Widget> rows=scrollBody.iterator();
  boolean startSelection=false;
  while (rows.hasNext()) {
    VScrollTableRow row=(VScrollTableRow)rows.next();
    if (row == startRow || startSelection) {
      startSelection=true;
      row.toggleSelection(false);
      selectedRowKeys.add(row.getKey());
    }
    if (row == endRow && row != null) {
      startSelection=false;
    }
  }
  selectedRowRanges.add(new SelectionRange(startKey,endKey));
}

{
  rendering=true;
  if (uidl.hasAttribute("colfooters")) {
    showColFooters=uidl.getBooleanAttribute("colfooters");
  }
  tFoot.setVisible(showColFooters);
  if (client.updateComponent(this,uidl,true)) {
    rendering=false;
    return;
  }
  rowRequestHandler.cancel();
  enabled=!uidl.hasAttribute("disabled");
  if (BrowserInfo.get().isIE8() && !enabled) {
    scrollBodyPanel.getElement().getStyle().setPosition(Position.STATIC);
  }
 else   if (BrowserInfo.get().isIE8()) {
    scrollBodyPanel.getElement().getStyle().setPosition(Position.RELATIVE);
  }
  this.client=client;
  paintableId=uidl.getStringAttribute("id");
  immediate=uidl.getBooleanAttribute("immediate");
  final int newTotalRows=uidl.getIntAttribute("totalrows");
  if (newTotalRows != totalRows) {
    if (scrollBody != null) {
      if (totalRows == 0) {
        tHead.clear();
        tFoot.clear();
      }
      initializedAndAttached=false;
      initialContentReceived=false;
      isNewBody=true;
    }
    totalRows=newTotalRows;
  }
  dragmode=uidl.hasAttribute("dragmode") ? uidl.getIntAttribute("dragmode") : 0;
  if (BrowserInfo.get().isIE()) {
    if (dragmode > 0) {
      getElement().setPropertyJSO("onselectstart",getPreventTextSelectionIEHack());
    }
 else {
      getElement().setPropertyJSO("onselectstart",null);
    }
  }
  tabIndex=uidl.hasAttribute("tabindex") ? uidl.getIntAttribute("tabindex") : 0;
  if (!BrowserInfo.get().isTouchDevice()) {
    multiselectmode=uidl.hasAttribute("multiselectmode") ? uidl.getIntAttribute("multiselectmode") : MULTISELECT_MODE_DEFAULT;
  }
  if (uidl.hasAttribute("alb")) {
    bodyActionKeys=uidl.getStringArrayAttribute("alb");
  }
 else {
    bodyActionKeys=null;
  }
  setCacheRate(uidl.hasAttribute("cr") ? uidl.getDoubleAttribute("cr") : CACHE_RATE_DEFAULT);
  recalcWidths=uidl.hasAttribute("recalcWidths");
  if (recalcWidths) {
    tHead.clear();
    tFoot.clear();
  }
  int oldPageLength=pageLength;
  if (uidl.hasAttribute("pagelength")) {
    pageLength=uidl.getIntAttribute("pagelength");
  }
 else {
    pageLength=totalRows;
  }
  if (oldPageLength != pageLength && initializedAndAttached) {
    sizeInit();
  }
  firstvisible=uidl.hasVariable("firstvisible") ? uidl.getIntVariable("firstvisible") : 0;
  if (firstvisible != lastRequestedFirstvisible && scrollBody != null) {
    firstRowInViewPort=firstvisible;
    scrollBodyPanel.setScrollPosition((int)(firstvisible * scrollBody.getRowHeight()));
  }
  showRowHeaders=uidl.getBooleanAttribute("rowheaders");
  showColHeaders=uidl.getBooleanAttribute("colheaders");
  nullSelectionAllowed=uidl.hasAttribute("nsa") ? uidl.getBooleanAttribute("nsa") : true;
  String oldSortColumn=sortColumn;
  if (uidl.hasVariable("sortascending")) {
    sortAscending=uidl.getBooleanVariable("sortascending");
    sortColumn=uidl.getStringVariable("sortcolumn");
  }
  boolean keyboardSelectionOverRowFetchInProgress=false;
  if (uidl.hasVariable("selected")) {
    final Set<String> selectedKeys=uidl.getStringArrayVariableAsSet("selected");
    if (scrollBody != null) {
      Iterator<Widget> iterator=scrollBody.iterator();
      while (iterator.hasNext()) {
        VScrollTableRow row=(VScrollTableRow)iterator.next();
        boolean selected=selectedKeys.contains(row.getKey());
        if (!selected && unSyncedselectionsBeforeRowFetch != null && unSyncedselectionsBeforeRowFetch.contains(row.getKey())) {
          selected=true;
          keyboardSelectionOverRowFetchInProgress=true;
        }
        if (selected != row.isSelected()) {
          row.toggleSelection();
        }
      }
    }
  }
  unSyncedselectionsBeforeRowFetch=null;
  if (uidl.hasAttribute("selectmode")) {
    if (uidl.getBooleanAttribute("readonly")) {
      selectMode=Table.SELECT_MODE_NONE;
    }
 else     if (uidl.getStringAttribute("selectmode").equals("multi")) {
      selectMode=Table.SELECT_MODE_MULTI;
    }
 else     if (uidl.getStringAttribute("selectmode").equals("single")) {
      selectMode=Table.SELECT_MODE_SINGLE;
    }
 else {
      selectMode=Table.SELECT_MODE_NONE;
    }
  }
  if (uidl.hasVariable("columnorder")) {
    columnReordering=true;
    columnOrder=uidl.getStringArrayVariable("columnorder");
  }
 else {
    columnReordering=false;
    columnOrder=null;
  }
  if (uidl.hasVariable("collapsedcolumns")) {
    tHead.setColumnCollapsingAllowed(true);
    collapsedColumns=uidl.getStringArrayVariableAsSet("collapsedcolumns");
  }
 else {
    tHead.setColumnCollapsingAllowed(false);
  }
  UIDL rowData=null;
  UIDL ac=null;
  for (final Iterator<Object> it=uidl.getChildIterator(); it.hasNext(); ) {
    final UIDL c=(UIDL)it.next();
    if (c.getTag().equals("rows")) {
      rowData=c;
    }
 else     if (c.getTag().equals("actions")) {
      updateActionMap(c);
    }
 else     if (c.getTag().equals("visiblecolumns")) {
      tHead.updateCellsFromUIDL(c);
      tFoot.updateCellsFromUIDL(c);
    }
 else     if (c.getTag().equals("-ac")) {
      ac=c;
    }
  }
  if (ac == null) {
    if (dropHandler != null) {
      dropHandler=null;
    }
  }
 else {
    if (dropHandler == null) {
      dropHandler=new VScrollTableDropHandler();
    }
    dropHandler.updateAcceptRules(ac);
  }
  updateHeader(uidl.getStringArrayAttribute("vcolorder"));
  updateFooter(uidl.getStringArrayAttribute("vcolorder"));
  if (!recalcWidths && initializedAndAttached) {
    updateBody(rowData,uidl.getIntAttribute("firstrow"),uidl.getIntAttribute("rows"));
    if (headerChangedDuringUpdate) {
      lazyAdjustColumnWidths.schedule(1);
    }
 else {
      Scheduler.get().scheduleDeferred(new Command(){
        public void execute(){
          Util.runWebkitOverflowAutoFix(scrollBodyPanel.getElement());
        }
      }
);
    }
  }
 else {
    if (scrollBody != null) {
      scrollBody.removeFromParent();
      lazyUnregistryBag.add(scrollBody);
    }
    scrollBody=createScrollBody();
    scrollBody.renderInitialRows(rowData,uidl.getIntAttribute("firstrow"),uidl.getIntAttribute("rows"));
    scrollBodyPanel.add(scrollBody);
    initialContentReceived=true;
    if (isAttached()) {
      sizeInit();
    }
    scrollBody.restoreRowVisibility();
  }
  if (selectMode == Table.SELECT_MODE_NONE) {
    scrollBody.addStyleName(CLASSNAME + "-body-noselection");
  }
 else {
    scrollBody.removeStyleName(CLASSNAME + "-body-noselection");
  }
  hideScrollPositionAnnotation();
  purgeUnregistryBag();
  if (!keyboardSelectionOverRowFetchInProgress) {
    selectionChanged=false;
  }
  if (selectFirstItemInNextRender || focusFirstItemInNextRender) {
    selectFirstRenderedRowInViewPort(focusFirstItemInNextRender);
    selectFirstItemInNextRender=focusFirstItemInNextRender=false;
  }
  if (selectLastItemInNextRender || focusLastItemInNextRender) {
    selectLastRenderedRowInViewPort(focusLastItemInNextRender);
    selectLastItemInNextRender=focusLastItemInNextRender=false;
  }
  multiselectPending=false;
  if (focusedRow != null) {
    if (!focusedRow.isAttached()) {
      focusRowFromBody();
    }
  }
  setProperTabIndex();
  HeaderCell sortedHeader=tHead.getHeaderCell(sortColumn);
  if (sortedHeader != null) {
    tHead.resizeCaptionContainer(sortedHeader);
  }
  HeaderCell oldSortedHeader=tHead.getHeaderCell(oldSortColumn);
  if (oldSortedHeader != null) {
    tHead.resizeCaptionContainer(oldSortedHeader);
  }
  rendering=false;
  headerChangedDuringUpdate=false;
}

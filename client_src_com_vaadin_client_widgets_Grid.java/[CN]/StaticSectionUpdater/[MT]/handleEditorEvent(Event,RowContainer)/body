{
  final boolean closeEvent=event.getTypeInt() == Event.ONKEYDOWN && event.getKeyCode() == Editor.KEYCODE_HIDE;
  double now=Duration.currentTimeMillis();
  int currentX=WidgetUtil.getTouchOrMouseClientX(event);
  int currentY=WidgetUtil.getTouchOrMouseClientY(event);
  final boolean validTouchOpenEvent=event.getTypeInt() == Event.ONTOUCHEND && now - lastTouchEventTime < 500 && lastTouchEventRow == eventCell.getRowIndex() && Math.abs(lastTouchEventX - currentX) < 20 && Math.abs(lastTouchEventY - currentY) < 20;
  final boolean openEvent=event.getTypeInt() == Event.ONDBLCLICK || (event.getTypeInt() == Event.ONKEYDOWN && event.getKeyCode() == Editor.KEYCODE_SHOW) || validTouchOpenEvent;
  if (event.getTypeInt() == Event.ONTOUCHSTART) {
    lastTouchEventX=currentX;
    lastTouchEventY=currentY;
  }
  if (event.getTypeInt() == Event.ONTOUCHEND) {
    lastTouchEventTime=now;
    lastTouchEventRow=eventCell.getRowIndex();
  }
  if (editor.getState() != Editor.State.INACTIVE) {
    if (closeEvent) {
      editor.cancel();
      FocusUtil.setFocus(this,true);
    }
    return true;
  }
  if (container == escalator.getBody() && editor.isEnabled() && openEvent) {
    editor.editRow(eventCell.getRowIndex(),eventCell.getColumnIndexDOM());
    event.preventDefault();
    return true;
  }
  return false;
}
